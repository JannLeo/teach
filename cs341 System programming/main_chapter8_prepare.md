

---

## ç¬¬ 195 é¡µ

![ç¬¬ 195 é¡µ](main_chapter8_assets/page-195.png)

**æé—®ï¼š** å¯¹æˆªå›¾ä¸­çš„å†…å®¹é€å¥è¯¦ç»†ä½¿ç”¨ä¸­æ–‡è§£é‡Šï¼Œä¸ä»…ä»…åªæ˜¯ç¿»è¯‘ï¼Œè¿˜éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œé€‚å½“çš„è§£é‡Š,å‘Šè¯‰æˆ‘è¯¥æ€Žä¹ˆæ•™å­¦ç”Ÿå¹¶ä¸”æŒ‡å¯¼æ€Žä¹ˆåš

ä¸‹é¢æˆ‘å°†å¯¹æˆªå›¾ä¸­çš„å†…å®¹**é€å¥è¿›è¡Œè¯¦ç»†ä¸­æ–‡è§£é‡Š**ï¼Œä¸ä»…ç¿»è¯‘ï¼Œè¿˜ä¼š**åŠ å…¥æ•™å­¦æŒ‡å¯¼**ï¼Œå¸®åŠ©ä½ ç†è§£å¦‚ä½•ç»™å­¦ç”Ÿè®²è§£è¿™äº›å†…å®¹ã€‚æ•´ä½“å†…å®¹æ¥è‡ªä¸€æœ¬è®¡ç®—æœºæ“ä½œç³»ç»Ÿæ•™æç¬¬8ç« ï¼Œä¸»é¢˜æ˜¯**æ­»é”ï¼ˆDeadlockï¼‰**ã€‚

---

### ç¬¬ä¸€éƒ¨åˆ†ï¼šç« èŠ‚æ ‡é¢˜ä¸Žå¼•è¨€

> **Deadlockï¼ˆæ ‡é¢˜ï¼‰**

* **ç¿»è¯‘**ï¼šæ­»é”
* **è§£é‡Š**ï¼šè¯¥ç« ä¸»è¦è®²æ“ä½œç³»ç»Ÿä¸­ä¸€ä¸ªé‡è¦é—®é¢˜ï¼šå½“å¤šä¸ªè¿›ç¨‹äº’ç›¸ç­‰å¾…èµ„æºè€Œæ— æ³•ç»§ç»­è¿è¡Œæ—¶ï¼Œå°±å‘ç”Ÿäº†â€œæ­»é”â€ã€‚
* **æ•™å­¦æç¤º**ï¼šå…ˆè®©å­¦ç”Ÿç†è§£â€œæ­»é”â€ç›´è§‚æ¯”å–»ï¼Œä¾‹å¦‚ä¸¤è¾†è½¦åœ¨çª„æ¡¥ç›¸å¯¹è€Œè¡Œå¹¶å¡ä½ï¼Œéƒ½åœ¨ç­‰å¾…å¯¹æ–¹å…ˆèµ°ï¼Œè¿™å°±æ˜¯æ­»é”ã€‚

---

### å¼•ç”¨è¯—å¥éƒ¨åˆ†ï¼ˆæ¥è‡ªæ»šçŸ³ä¹é˜Ÿæ­Œè¯ï¼‰

> *No, you canâ€™t always get what you want
> You can't always get what you want
> You can't always get what you want
> But if you try sometimes you find
> You get what you need*
> â€”â€”The philosophers Jagger & Richards

* **ç¿»è¯‘**ï¼š

  * ä¸ï¼Œä½ ä¸èƒ½æ€»æ˜¯å¾—åˆ°ä½ æƒ³è¦çš„
  * ä½ ä¸èƒ½æ€»æ˜¯å¾—åˆ°ä½ æƒ³è¦çš„
  * ä½ ä¸èƒ½æ€»æ˜¯å¾—åˆ°ä½ æƒ³è¦çš„
  * ä½†å¦‚æžœä½ åŠªåŠ›å°è¯•ï¼Œæœ‰æ—¶å€™ä½ ä¼šå‘çŽ°
  * ä½ å¾—åˆ°ä½ æ‰€éœ€è¦çš„
* **è§£é‡Š**ï¼šè¿™é‡Œå¼•ç”¨æ­Œè¯æ˜¯ä¸ºäº†å¼•å‡ºâ€œèµ„æºæœ‰é™â€è¿™ä¸€çŽ°å®žâ€”â€”åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹æ— æ³•éšæ—¶å¾—åˆ°èµ„æºï¼Œå¿…é¡»å­¦ä¼šå¤„ç†ç­‰å¾…å’Œå†²çªï¼Œè¿™å¼•å‡ºäº†â€œæ­»é”â€é—®é¢˜ã€‚
* **æ•™å­¦æ–¹æ³•**ï¼š

  * ç”¨è½»æ¾æ–¹å¼å¼€å¤´ï¼Œå¸å¼•å­¦ç”Ÿæ³¨æ„åŠ›ï¼›
  * æé†’å­¦ç”Ÿï¼šâ€œæ“ä½œç³»ç»Ÿä¸æ˜¯é­”æ³•ï¼Œèµ„æºæœ‰é™ï¼Œæ‰€ä»¥éœ€è¦åˆç†åˆ†é…ä¸Žé¿å…æ­»é”â€ã€‚

---

### æ­£æ–‡æ®µè½é€å¥è®²è§£

> **Deadlock is defined as when a system cannot make any forward progress.**

* **ç¿»è¯‘**ï¼šæ­»é”è¢«å®šä¹‰ä¸ºç³»ç»Ÿæ— æ³•å†ç»§ç»­å‘å‰æŽ¨è¿›çš„çŠ¶æ€ã€‚
* **è§£é‡Š**ï¼šæ‰€æœ‰è¿›ç¨‹éƒ½åœä½äº†ï¼Œæ²¡äººèƒ½ç»§ç»­è¿è¡Œã€‚
* **æ•™å­¦ç¤ºä¾‹**ï¼šå¯ä»¥ç”¨â€œäº’ç›¸æ‹¿ç€å¯¹æ–¹éœ€è¦çš„é’¥åŒ™è€Œä¸æ”¾â€çš„ä¾‹å­æ¥è§£é‡Šã€‚

---

> **We define a system for the rest of the chapter as a set of rules by which a set of processes can move from one state to another, where a state is either working or waiting for a particular resource.**

* **ç¿»è¯‘**ï¼šæˆ‘ä»¬åœ¨æœ¬ç« ä¸­æŠŠâ€œç³»ç»Ÿâ€å®šä¹‰ä¸ºä¸€ç»„è§„åˆ™ï¼Œå®ƒæŽ§åˆ¶ä¸€ç»„è¿›ç¨‹ä»Žä¸€ä¸ªçŠ¶æ€åˆ‡æ¢åˆ°å¦ä¸€ä¸ªçŠ¶æ€ï¼Œè€ŒçŠ¶æ€å¯ä»¥æ˜¯â€œè¿è¡Œâ€æˆ–â€œç­‰å¾…èµ„æºâ€ã€‚
* **è§£é‡Š**ï¼šå¼•å…¥æ¨¡åž‹æ¦‚å¿µï¼Œå‘Šè¯‰å­¦ç”Ÿæˆ‘ä»¬ç”¨ç®€å•è§„åˆ™æ¥æè¿°å¤æ‚ç³»ç»Ÿã€‚
* **æ•™å­¦æŒ‡å¯¼**ï¼šè®©å­¦ç”Ÿå…ˆç†è§£â€œæ¨¡åž‹åŒ–æ€ç»´â€â€”â€”æŠ½è±¡å¤æ‚ç³»ç»Ÿæ˜¯é‡è¦æ–¹æ³•ã€‚

---

> **Forward progress is defined as if there is at least one process working or we can award a process waiting for a resource that resource.**

* **ç¿»è¯‘**ï¼šå¦‚æžœè‡³å°‘æœ‰ä¸€ä¸ªè¿›ç¨‹åœ¨è¿è¡Œï¼Œæˆ–è€…æˆ‘ä»¬èƒ½ä¸ºä¸€ä¸ªæ­£åœ¨ç­‰å¾…èµ„æºçš„è¿›ç¨‹åˆ†é…èµ„æºï¼Œé‚£ä¹ˆå°±è®¤ä¸ºç³»ç»Ÿåœ¨å‰è¿›ã€‚
* **è§£é‡Š**ï¼šåªè¦æœ‰è¿›ç¨‹èƒ½ç»§ç»­è¿è¡Œï¼Œå°±**ä¸æ˜¯æ­»é”**ã€‚
* **æ•™å­¦æç¤º**ï¼šå¼ºè°ƒâ€œæ­»é” = å®Œå…¨åœæ»žï¼Œè€Œä¸æ˜¯é€Ÿåº¦æ…¢â€ã€‚

---

> **In a lot of systems, Deadlock is avoided by ignoring the entire concept.**

* **ç¿»è¯‘**ï¼šåœ¨å¾ˆå¤šç³»ç»Ÿé‡Œï¼Œäººä»¬é¿å…æ­»é”çš„æ–¹å¼æ˜¯â€”â€”å¹²è„†å®Œå…¨å¿½ç•¥å®ƒã€‚
* **è§£é‡Š**ï¼šå¾ˆå¤šæ™®é€šç³»ç»Ÿä¸ä¸»åŠ¨å¤„ç†æ­»é”ï¼Œè€Œæ˜¯é€šè¿‡é‡å¯è§£å†³ã€‚
* **æ•™å­¦æ–¹æ³•**ï¼šå¼•å¯¼å­¦ç”Ÿæ€è€ƒï¼šâ€œä½ æ˜¯ä¸æ˜¯å¸¸å¬åˆ«äººè¯´â€˜è¯•è¯•å…³æœºé‡å¯â€™ï¼Ÿâ€

---

> **Have you heard about turn it on and off again?**

* **ç¿»è¯‘**ï¼šä½ å¬è¯´è¿‡â€œå…³æŽ‰å†å¼€â€çš„æ–¹æ³•å—ï¼Ÿ
* **è§£é‡Š**ï¼šæ•™æåœ¨å¹½é»˜è¯´æ˜Žæ™®é€šç³»ç»Ÿé‡åˆ°æ­»é”æ—¶ç®€å•ç²—æš´åœ°å¤„ç†ã€‚
* **æ•™å­¦ç¤ºä¾‹**ï¼šä¸¾æ‰‹æœºæ­»æœºå¿…é¡»å¼ºåˆ¶é‡å¯çš„çœŸå®žä¾‹å­ã€‚

---

> **For products where the stakes are low (User Operating Systems, Phones), it may be more efficient to allow deadlock.**

* **ç¿»è¯‘**ï¼šå¯¹äºŽé£Žé™©è¾ƒä½Žçš„äº§å“ï¼ˆå¦‚æ™®é€šç”¨æˆ·ç³»ç»Ÿæˆ–æ‰‹æœºï¼‰ï¼Œå…è®¸æ­»é”åè€Œå¯èƒ½æ›´é«˜æ•ˆã€‚
* **è§£é‡Š**ï¼šå› ä¸ºå¤„ç†æ­»é”çš„æˆæœ¬æ¯”é‡å¯æ›´é«˜ï¼Œä¸åˆ’ç®—ã€‚
* **æ•™å­¦å»¶ä¼¸**ï¼šè®©å­¦ç”Ÿç†è§£â€œå·¥ç¨‹æƒè¡¡â€â€”â€”ä¸æ˜¯æ‰€æœ‰é—®é¢˜éƒ½å€¼å¾—åŠ¨æ€è§£å†³ã€‚

---

> **But in the cases where â€œfailure is not an optionâ€ â€“ Apollo 13, you need a system that tracks, breaks, or prevents deadlocks.**

* **ç¿»è¯‘**ï¼šä½†åœ¨â€œå¤±è´¥ä¸æ˜¯é€‰é¡¹â€çš„åœºæ™¯ä¸‹ï¼Œæ¯”å¦‚é˜¿æ³¢ç½—13å·ä»»åŠ¡ï¼Œå°±å¿…é¡»ä½¿ç”¨èƒ½è·Ÿè¸ªã€æ‰“ç ´æˆ–é˜²æ­¢æ­»é”çš„ç³»ç»Ÿã€‚
* **è§£é‡Š**ï¼šå¼•å‡ºæ­»é”é—®é¢˜çš„é‡è¦æ€§ï¼Œåœ¨å…³é”®ä»»åŠ¡ï¼ˆèˆªå¤©ã€åŒ»ç–—ï¼‰ä¸­ä¸èƒ½å®¹å¿æ­»é”ã€‚
* **æ•™å­¦æç¤º**ï¼šå¼ºè°ƒç³»ç»Ÿè®¾è®¡æ ¹æ®åœºæ™¯ä¸åŒè€Œä¸åŒã€‚

---

> **Mission-critical operating systems need this guarantee formally because playing the odds with peopleâ€™s lives isnâ€™t a good idea.**

* **ç¿»è¯‘**ï¼šå…³é”®ä»»åŠ¡æ“ä½œç³»ç»Ÿéœ€è¦æ­£å¼ç¡®ä¿ä¸ä¼šå‡ºçŽ°æ­»é”ï¼Œå› ä¸ºæ‹¿äººçš„ç”Ÿå‘½åŽ»èµŒé£Žé™©å¹¶ä¸æ˜¯ä¸ªå¥½ä¸»æ„ã€‚
* **è§£é‡Š**ï¼šæ­£å¼æ–¹æ³•å’Œç†è®ºæ¨¡åž‹åœ¨è¿™é‡Œç‰¹åˆ«é‡è¦ã€‚
* **æ•™å­¦æŒ‡å¯¼**ï¼šè®©å­¦ç”Ÿæ„è¯†åˆ°æ“ä½œç³»ç»Ÿä¸ä»…æ˜¯æŠ€æœ¯ï¼Œä¹Ÿå…³ç³»åˆ°å®‰å…¨è´£ä»»ã€‚

---

> **We model the problem. Even though it is a common statistical phrase that all models are wrong, the more accurate the model is to the system the higher the chance the method will work.**

* **ç¿»è¯‘**ï¼šæˆ‘ä»¬é€šè¿‡å»ºç«‹æ¨¡åž‹æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è™½ç„¶ç»Ÿè®¡å­¦é‡Œè¯´â€œæ‰€æœ‰æ¨¡åž‹éƒ½æœ‰é”™è¯¯â€ï¼Œä½†æ¨¡åž‹è¶ŠæŽ¥è¿‘ç³»ç»ŸçœŸå®žæƒ…å†µï¼Œæ–¹æ³•æˆåŠŸçš„æ¦‚çŽ‡è¶Šé«˜ã€‚
* **è§£é‡Š**ï¼šå¼•å‡ºä¸‹ä¸€èŠ‚â€”â€”æž„å»ºèµ„æºåˆ†é…æ¨¡åž‹æ¥åˆ†æžæ­»é”ã€‚
* **æ•™å­¦å¼ºè°ƒ**ï¼šå‘Šè¯‰å­¦ç”Ÿå»ºæ¨¡æ˜¯å·¥ç¨‹å¸ˆåˆ†æžå¤æ‚é—®é¢˜çš„å¿…å¤‡èƒ½åŠ›ã€‚

---

### æ€»ç»“æ•™å­¦å»ºè®®

| æ•™å­¦ç›®æ ‡        | æ–¹æ³•å»ºè®®                 |
| ----------- | -------------------- |
| è®©å­¦ç”Ÿç›´è§‚ç†è§£æ­»é”   | ä½¿ç”¨ç”Ÿæ´»ä¾‹å­è®²è§£ï¼ˆè¿‡æ¡¥å µè½¦ã€äº’ç›¸ç­‰é’¥åŒ™ï¼‰ |
| è®©å­¦ç”Ÿæ˜Žç™½æ­»é”çš„é‡è¦æ€§ | åŒºåˆ†æ™®é€šç³»ç»Ÿä¸Žå…³é”®ç³»ç»Ÿä¸ºä½•è¦å¤„ç†æ­»é”   |
| å¼•å¯¼å­¦ç”Ÿå…´è¶£      | è¿ç”¨å¹½é»˜å¼•ç”¨ï¼ˆæ­Œè¯/é‡å¯ç”µè„‘ï¼‰å¸å¼•æ³¨æ„  |
| å»ºç«‹æ¨¡åž‹æ„è¯†      | è®²è§£é—®é¢˜å»ºæ¨¡æ˜¯è§£å†³å¤æ‚ç³»ç»Ÿé—®é¢˜çš„åŸºç¡€   |

---

å¦‚æžœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ç»§ç»­**é€å¥è®²è§£åŽé¢çš„é¡µé¢**ï¼Œæˆ–è€…**å¸®ä½ å‡ºä¸€ä»½æ•™å­¦è®¡åˆ’**ç”šè‡³**è¯¾å ‚è®²ä¹‰**ã€‚
ðŸ‘‰ éœ€è¦ç»§ç»­å—ï¼Ÿ


---

## ç¬¬ 196 é¡µ

![ç¬¬ 196 é¡µ](main_chapter8_assets/page-196.png)

**æé—®ï¼š** å¯¹æˆªå›¾ä¸­çš„å†…å®¹é€å¥è¯¦ç»†ä½¿ç”¨ä¸­æ–‡è§£é‡Šï¼Œä¸ä»…ä»…åªæ˜¯ç¿»è¯‘ï¼Œè¿˜éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œé€‚å½“çš„è§£é‡Š,å‘Šè¯‰æˆ‘è¯¥æ€Žä¹ˆæ•™å­¦ç”Ÿå¹¶ä¸”æŒ‡å¯¼æ€Žä¹ˆåš

ä¸‹é¢å¼€å§‹å¯¹è¿™é¡µå†…å®¹**é€å¥è¿›è¡Œè¯¦ç»†çš„ä¸­æ–‡è§£é‡Š**ï¼Œä¸ä»…ç¿»è¯‘ï¼Œè¿˜ä¼šè¡¥å……èƒŒæ™¯çŸ¥è¯†ï¼Œå¹¶ç»™å‡º**æ•™å­¦å»ºè®®**ï¼Œå‘Šè¯‰ä½ åº”è¯¥å¦‚ä½•ä¸€æ­¥æ­¥æ•™å­¦ç”Ÿç†è§£è¿™ä¸€é¡µå†…å®¹ã€‚

---

## æ ‡é¢˜éƒ¨åˆ†

### **8.1 Resource Allocation Graphs**

* **ç¿»è¯‘**ï¼š8.1 èµ„æºåˆ†é…å›¾
* **è§£é‡Š**ï¼šè¿™ä¸€å°èŠ‚å°†ä»‹ç»ç”¨â€œèµ„æºåˆ†é…å›¾â€ï¼ˆRAGï¼‰æ¥å»ºæ¨¡ç³»ç»Ÿä¸­â€œè¿›ç¨‹å’Œèµ„æºçš„å…³ç³»â€ã€‚è¿™æ˜¯ç†è§£æ­»é”çš„ç»å…¸å·¥å…·ã€‚
* **æ•™å­¦æç¤º**ï¼šå‘Šè¯‰å­¦ç”Ÿï¼š**è¿™æ˜¯æ­»é”åˆ†æžä¸­æœ€é‡è¦çš„åŸºç¡€æ¨¡åž‹ï¼Œä¸€å®šè¦æŽŒæ¡**ã€‚

---

## å›¾ç¤ºéƒ¨åˆ†ï¼šFigure 8.1

å›¾ä¸­å±•ç¤ºï¼š

* ä¸Šæ–¹ä¸‰ä¸ª**æ¤­åœ†å½¢**ä»£è¡¨è¿›ç¨‹ï¼š`Process 1ã€Process 2ã€Process 3`
* ä¸‹æ–¹ä¸¤ä¸ª**æ–¹æ¡†**ä»£è¡¨èµ„æºï¼š`Resource 1ã€Resource 2`
* ç®­å¤´è¡¨ç¤ºï¼š

  * ä»Ž**èµ„æº â†’ è¿›ç¨‹**ï¼Œè¡¨ç¤ºèµ„æºè¢«è¿›ç¨‹å æœ‰ï¼ˆallocatedï¼‰
  * ä»Ž**è¿›ç¨‹ â†’ èµ„æº**ï¼Œè¡¨ç¤ºè¿›ç¨‹è¯·æ±‚è¯¥èµ„æºï¼ˆrequestï¼‰

---

## æ­£æ–‡é€å¥è§£é‡Š

> **One such way is modeling the system with a resource allocation graph (RAG).**

* **ç¿»è¯‘**ï¼šå…¶ä¸­ä¸€ç§æ–¹æ³•æ˜¯ç”¨èµ„æºåˆ†é…å›¾ï¼ˆRAGï¼‰å¯¹ç³»ç»Ÿè¿›è¡Œå»ºæ¨¡ã€‚
* **è§£é‡Š**ï¼šç¬¬ä¸€ä¸ªä»‹ç»çš„æ­»é”å»ºæ¨¡æ–¹æ³•å°±æ˜¯èµ„æºåˆ†é…å›¾ã€‚
* **æ€Žä¹ˆæ•™**ï¼šå¼ºè°ƒä¸ºä»€ä¹ˆè¦å»ºæ¨¡â€”â€”â€œç›´è§‚çœ‹ä¸æ‡‚å¤æ‚ç³»ç»Ÿï¼Œç”¨å›¾å¸®åŠ©æˆ‘ä»¬çœ‹æ¸…ç»“æž„â€ã€‚

---

> **A resource allocation graph tracks which resource is held by which process and which process is waiting for a resource of a particular type.**

* **ç¿»è¯‘**ï¼šèµ„æºåˆ†é…å›¾ç”¨äºŽè®°å½•æ¯ä¸ªè¿›ç¨‹å æœ‰äº†ä»€ä¹ˆèµ„æºï¼Œä»¥åŠå“ªä¸ªè¿›ç¨‹æ­£åœ¨ç­‰å¾…æŸç±»èµ„æºã€‚
* **è§£é‡Š**ï¼šRAG å›¾æ ¸å¿ƒä½œç”¨æ˜¯æ˜¾ç¤º**èµ„æºå ç”¨å…³ç³»**å’Œ**èµ„æºè¯·æ±‚å…³ç³»**ã€‚
* **æ•™å­¦å»ºè®®**ï¼šå¯ä»¥ç”»å¦‚ä¸‹ç®€å•è¡¨ç¤ºï¼š

```
è¿›ç¨‹ â†’ èµ„æºï¼ˆè¯·æ±‚ï¼‰
èµ„æº â†’ è¿›ç¨‹ï¼ˆåˆ†é…ï¼‰
```

---

> **It is a simple yet powerful tool to illustrate how interacting processes can deadlock.**

* **ç¿»è¯‘**ï¼šå®ƒæ˜¯ä¸€ä¸ªç®€å•å´å¾ˆæœ‰åŠ›çš„å·¥å…·ï¼Œç”¨äºŽè¯´æ˜Žå¤šä¸ªè¿›ç¨‹å¦‚ä½•å‘ç”Ÿæ­»é”ã€‚
* **è§£é‡Š**ï¼šè™½ç„¶ç”»èµ·æ¥å¾ˆç®€å•ï¼Œä½†èƒ½å¸®åŠ©æˆ‘ä»¬åˆ†æžç³»ç»Ÿæ˜¯å¦å¯èƒ½â€œå¡æ­»â€ã€‚
* **æ•™å­¦å»ºè®®**ï¼šä¸¾ä¾‹è¯´æ˜Žï¼šåƒäº¤é€šå µå¡žå›¾ä¸€æ ·ï¼Œå›¾èƒ½çœ‹å‡ºâ€œäº’ç›¸å¡ä½â€ã€‚

---

> **If a process is using a resource, an arrow is drawn from the resource node to the process node.**

* **ç¿»è¯‘**ï¼šå¦‚æžœä¸€ä¸ªè¿›ç¨‹æ­£åœ¨ä½¿ç”¨æŸä¸ªèµ„æºï¼Œå°±ä»Žèµ„æºèŠ‚ç‚¹ç”»ä¸€æ¡ç®­å¤´æŒ‡å‘è¿›ç¨‹èŠ‚ç‚¹ã€‚
* **å¦‚ä½•æ•™å­¦ç”Ÿ**ï¼šæ•™å­¦ç”Ÿå¦‚ä½•ç”»å›¾ï¼Œå‘Šè¯‰ä»–ä»¬ç¬¬ä¸€æ¡è§„åˆ™ï¼š**èµ„æº â†’ è¿›ç¨‹ = èµ„æºè¢«è¿›ç¨‹å ç”¨**

---

> **If a process is requesting a resource, an arrow is drawn from the process node to the resource node.**

* **ç¿»è¯‘**ï¼šå¦‚æžœä¸€ä¸ªè¿›ç¨‹è¯·æ±‚æŸä¸ªèµ„æºï¼Œå°±ä»Žè¿›ç¨‹èŠ‚ç‚¹ç”»ä¸€æ¡ç®­å¤´æŒ‡å‘èµ„æºèŠ‚ç‚¹ã€‚
* **æ•™å­¦è¦ç‚¹**ï¼šç¬¬äºŒæ¡è§„åˆ™ï¼š**è¿›ç¨‹ â†’ èµ„æº = æ­£åœ¨è¯·æ±‚èµ„æº**

---

> **If there is a cycle in the Resource Allocation Graph and each resource in the cycle provides only one instance, then the processes will deadlock.**

* **ç¿»è¯‘**ï¼šå¦‚æžœèµ„æºåˆ†é…å›¾ä¸­å­˜åœ¨çŽ¯ï¼Œå¹¶ä¸”çŽ¯ä¸Šçš„æ¯ä¸ªèµ„æºéƒ½åªæœ‰ä¸€ä¸ªå®žä¾‹ï¼Œé‚£ä¹ˆç³»ç»Ÿå¿…å®šå‘ç”Ÿæ­»é”ã€‚
* **è§£é‡Š**ï¼šâ€œå­˜åœ¨çŽ¯è·¯ = æœ‰ç›¸äº’ç­‰å¾…ä¾èµ– = æ­»é”â€ã€‚
* **æ•™å­¦å»ºè®®**ï¼šè®©å­¦ç”Ÿå¯»æ‰¾å›¾ä¸­æ˜¯å¦å­˜åœ¨çŽ¯æ˜¯åˆ¤æ–­æ­»é”çš„å…³é”®æ­¥éª¤ï¼

---

> **For example, if process 1 holds resource A, process 2 holds resource B and process 1 is waiting for B and process 2 is waiting for A, then processes 1 and 2 will be deadlocked.**

* **ç¿»è¯‘**ï¼šä¾‹å¦‚ï¼šå¦‚æžœè¿›ç¨‹1å æœ‰èµ„æºAï¼Œè¿›ç¨‹2å æœ‰èµ„æºBï¼Œè€Œè¿›ç¨‹1ç­‰å¾…Bï¼Œè¿›ç¨‹2ç­‰å¾…Aï¼Œé‚£ä¹ˆå®ƒä»¬å°±æ­»é”äº†ã€‚
* **æ•™å­¦æ–¹æ³•**ï¼šå¼•å¯¼å­¦ç”Ÿç”»å‡º RAGï¼š

```
R_A â†’ P1 â†’ R_B â†’ P2 â†’ R_A ï¼ˆå½¢æˆçŽ¯ï¼‰
```

---

> **We can detect a deadlock by traversing the graph and searching for a cycle using a graph traversal algorithm, such as Depth First Search (DFS).**

* **ç¿»è¯‘**ï¼šæˆ‘ä»¬å¯ä»¥é€šè¿‡éåŽ†å›¾æ¥æ£€æµ‹æ­»é”ï¼Œä¾‹å¦‚ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰å¯»æ‰¾çŽ¯ã€‚
* **æ•™å­¦å»ºè®®**ï¼šå…ˆæ•™æ‰¾çŽ¯ï¼Œå†è¡¥å……ç®—æ³•ï¼Œä¸è¦ç›´æŽ¥è®² DFS ä¼šè®©å­¦ç”Ÿå¸æ”¶ä¸äº†ã€‚

---

> **This graph is considered as a directed graph and we can treat both the processes and resources as nodes.**

* **ç¿»è¯‘**ï¼šè¿™ä¸ªå›¾æ˜¯ä¸€ä¸ªæœ‰å‘å›¾ï¼Œæˆ‘ä»¬æŠŠè¿›ç¨‹å’Œèµ„æºéƒ½å½“ä½œå›¾ä¸­çš„èŠ‚ç‚¹ã€‚
* **æ•™å­¦æ€»ç»“**ï¼š

  * âœ… å›¾ç±»åž‹ï¼šæœ‰å‘å›¾
  * âœ… èŠ‚ç‚¹ç±»åž‹ï¼šä¸¤ç§ï¼ˆè¿›ç¨‹èŠ‚ç‚¹ã€èµ„æºèŠ‚ç‚¹ï¼‰
  * âœ… ç›®æ ‡ï¼šæ£€æµ‹çŽ¯

---

### âœ… æŽ¥ä¸‹æ¥è§£é‡Šä»£ç åŒºåŸŸå—ï¼Ÿ

æˆªå›¾ä¸‹åŠéƒ¨åˆ†å‡ºçŽ°äº†ä¸€ä¸ª C è¯­è¨€ç»“æž„ä½“ `Graph`ï¼Œè¯´æ˜ŽåŽé¢ä¼šè®²å¦‚ä½•ç”¨ç¨‹åºå®žçŽ°æ­»é”æ£€æµ‹ç®—æ³•ã€‚

---

å¦‚æžœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ç»§ç»­**é€è¡Œè®²è§£è¿™æ®µä»£ç **ï¼Œå¹¶**å‘Šè¯‰ä½ å¦‚ä½•è®²ç»™å­¦ç”Ÿå¬**ï¼Œè¿˜å¯ä»¥**å‡ºä¸€ä»½è¯¾å ‚ç¤ºèŒƒç‰ˆæ•™å­¦è®²ä¹‰**ã€‚
éœ€è¦ç»§ç»­å—ï¼Ÿâœ…

è¦ç»§ç»­è®²è¿™é¡µçš„åŽåŠéƒ¨åˆ†ä»£ç å—ï¼Ÿ ðŸ‘‡
**å›žå¤**ï¼š`ç»§ç»­è®²ä»£ç ` æˆ– `å…ˆå‡ºè®²ä¹‰`


---

## ç¬¬ 197 é¡µ

![ç¬¬ 197 é¡µ](main_chapter8_assets/page-197.png)

**æé—®ï¼š** å¯¹æˆªå›¾ä¸­çš„å†…å®¹é€å¥è¯¦ç»†ä½¿ç”¨ä¸­æ–‡è§£é‡Šï¼Œä¸ä»…ä»…åªæ˜¯ç¿»è¯‘ï¼Œè¿˜éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œé€‚å½“çš„è§£é‡Š,å‘Šè¯‰æˆ‘è¯¥æ€Žä¹ˆæ•™å­¦ç”Ÿå¹¶ä¸”æŒ‡å¯¼æ€Žä¹ˆåš

ä¸‹é¢å¼€å§‹å¯¹è¿™é¡µå†…å®¹**é€å¥è¿›è¡Œè¯¦ç»†çš„ä¸­æ–‡è§£é‡Š**ï¼Œä¸ä»…ç¿»è¯‘ï¼Œè¿˜ä¼šè¡¥å……èƒŒæ™¯çŸ¥è¯†ï¼Œå¹¶ç»™å‡º**æ•™å­¦å»ºè®®**ï¼Œå‘Šè¯‰ä½ åº”è¯¥å¦‚ä½•ä¸€æ­¥æ­¥æ•™å­¦ç”Ÿç†è§£è¿™ä¸€é¡µå†…å®¹ã€‚

---

## æ ‡é¢˜éƒ¨åˆ†

### **8.1 Resource Allocation Graphs**

* **ç¿»è¯‘**ï¼š8.1 èµ„æºåˆ†é…å›¾
* **è§£é‡Š**ï¼šè¿™ä¸€å°èŠ‚å°†ä»‹ç»ç”¨â€œèµ„æºåˆ†é…å›¾â€ï¼ˆRAGï¼‰æ¥å»ºæ¨¡ç³»ç»Ÿä¸­â€œè¿›ç¨‹å’Œèµ„æºçš„å…³ç³»â€ã€‚è¿™æ˜¯ç†è§£æ­»é”çš„ç»å…¸å·¥å…·ã€‚
* **æ•™å­¦æç¤º**ï¼šå‘Šè¯‰å­¦ç”Ÿï¼š**è¿™æ˜¯æ­»é”åˆ†æžä¸­æœ€é‡è¦çš„åŸºç¡€æ¨¡åž‹ï¼Œä¸€å®šè¦æŽŒæ¡**ã€‚

---

## å›¾ç¤ºéƒ¨åˆ†ï¼šFigure 8.1

å›¾ä¸­å±•ç¤ºï¼š

* ä¸Šæ–¹ä¸‰ä¸ª**æ¤­åœ†å½¢**ä»£è¡¨è¿›ç¨‹ï¼š`Process 1ã€Process 2ã€Process 3`
* ä¸‹æ–¹ä¸¤ä¸ª**æ–¹æ¡†**ä»£è¡¨èµ„æºï¼š`Resource 1ã€Resource 2`
* ç®­å¤´è¡¨ç¤ºï¼š

  * ä»Ž**èµ„æº â†’ è¿›ç¨‹**ï¼Œè¡¨ç¤ºèµ„æºè¢«è¿›ç¨‹å æœ‰ï¼ˆallocatedï¼‰
  * ä»Ž**è¿›ç¨‹ â†’ èµ„æº**ï¼Œè¡¨ç¤ºè¿›ç¨‹è¯·æ±‚è¯¥èµ„æºï¼ˆrequestï¼‰

---

## æ­£æ–‡é€å¥è§£é‡Š

> **One such way is modeling the system with a resource allocation graph (RAG).**

* **ç¿»è¯‘**ï¼šå…¶ä¸­ä¸€ç§æ–¹æ³•æ˜¯ç”¨èµ„æºåˆ†é…å›¾ï¼ˆRAGï¼‰å¯¹ç³»ç»Ÿè¿›è¡Œå»ºæ¨¡ã€‚
* **è§£é‡Š**ï¼šç¬¬ä¸€ä¸ªä»‹ç»çš„æ­»é”å»ºæ¨¡æ–¹æ³•å°±æ˜¯èµ„æºåˆ†é…å›¾ã€‚
* **æ€Žä¹ˆæ•™**ï¼šå¼ºè°ƒä¸ºä»€ä¹ˆè¦å»ºæ¨¡â€”â€”â€œç›´è§‚çœ‹ä¸æ‡‚å¤æ‚ç³»ç»Ÿï¼Œç”¨å›¾å¸®åŠ©æˆ‘ä»¬çœ‹æ¸…ç»“æž„â€ã€‚

---

> **A resource allocation graph tracks which resource is held by which process and which process is waiting for a resource of a particular type.**

* **ç¿»è¯‘**ï¼šèµ„æºåˆ†é…å›¾ç”¨äºŽè®°å½•æ¯ä¸ªè¿›ç¨‹å æœ‰äº†ä»€ä¹ˆèµ„æºï¼Œä»¥åŠå“ªä¸ªè¿›ç¨‹æ­£åœ¨ç­‰å¾…æŸç±»èµ„æºã€‚
* **è§£é‡Š**ï¼šRAG å›¾æ ¸å¿ƒä½œç”¨æ˜¯æ˜¾ç¤º**èµ„æºå ç”¨å…³ç³»**å’Œ**èµ„æºè¯·æ±‚å…³ç³»**ã€‚
* **æ•™å­¦å»ºè®®**ï¼šå¯ä»¥ç”»å¦‚ä¸‹ç®€å•è¡¨ç¤ºï¼š

```
è¿›ç¨‹ â†’ èµ„æºï¼ˆè¯·æ±‚ï¼‰
èµ„æº â†’ è¿›ç¨‹ï¼ˆåˆ†é…ï¼‰
```

---

> **It is a simple yet powerful tool to illustrate how interacting processes can deadlock.**

* **ç¿»è¯‘**ï¼šå®ƒæ˜¯ä¸€ä¸ªç®€å•å´å¾ˆæœ‰åŠ›çš„å·¥å…·ï¼Œç”¨äºŽè¯´æ˜Žå¤šä¸ªè¿›ç¨‹å¦‚ä½•å‘ç”Ÿæ­»é”ã€‚
* **è§£é‡Š**ï¼šè™½ç„¶ç”»èµ·æ¥å¾ˆç®€å•ï¼Œä½†èƒ½å¸®åŠ©æˆ‘ä»¬åˆ†æžç³»ç»Ÿæ˜¯å¦å¯èƒ½â€œå¡æ­»â€ã€‚
* **æ•™å­¦å»ºè®®**ï¼šä¸¾ä¾‹è¯´æ˜Žï¼šåƒäº¤é€šå µå¡žå›¾ä¸€æ ·ï¼Œå›¾èƒ½çœ‹å‡ºâ€œäº’ç›¸å¡ä½â€ã€‚

---

> **If a process is using a resource, an arrow is drawn from the resource node to the process node.**

* **ç¿»è¯‘**ï¼šå¦‚æžœä¸€ä¸ªè¿›ç¨‹æ­£åœ¨ä½¿ç”¨æŸä¸ªèµ„æºï¼Œå°±ä»Žèµ„æºèŠ‚ç‚¹ç”»ä¸€æ¡ç®­å¤´æŒ‡å‘è¿›ç¨‹èŠ‚ç‚¹ã€‚
* **å¦‚ä½•æ•™å­¦ç”Ÿ**ï¼šæ•™å­¦ç”Ÿå¦‚ä½•ç”»å›¾ï¼Œå‘Šè¯‰ä»–ä»¬ç¬¬ä¸€æ¡è§„åˆ™ï¼š**èµ„æº â†’ è¿›ç¨‹ = èµ„æºè¢«è¿›ç¨‹å ç”¨**

---

> **If a process is requesting a resource, an arrow is drawn from the process node to the resource node.**

* **ç¿»è¯‘**ï¼šå¦‚æžœä¸€ä¸ªè¿›ç¨‹è¯·æ±‚æŸä¸ªèµ„æºï¼Œå°±ä»Žè¿›ç¨‹èŠ‚ç‚¹ç”»ä¸€æ¡ç®­å¤´æŒ‡å‘èµ„æºèŠ‚ç‚¹ã€‚
* **æ•™å­¦è¦ç‚¹**ï¼šç¬¬äºŒæ¡è§„åˆ™ï¼š**è¿›ç¨‹ â†’ èµ„æº = æ­£åœ¨è¯·æ±‚èµ„æº**

---

> **If there is a cycle in the Resource Allocation Graph and each resource in the cycle provides only one instance, then the processes will deadlock.**

* **ç¿»è¯‘**ï¼šå¦‚æžœèµ„æºåˆ†é…å›¾ä¸­å­˜åœ¨çŽ¯ï¼Œå¹¶ä¸”çŽ¯ä¸Šçš„æ¯ä¸ªèµ„æºéƒ½åªæœ‰ä¸€ä¸ªå®žä¾‹ï¼Œé‚£ä¹ˆç³»ç»Ÿå¿…å®šå‘ç”Ÿæ­»é”ã€‚
* **è§£é‡Š**ï¼šâ€œå­˜åœ¨çŽ¯è·¯ = æœ‰ç›¸äº’ç­‰å¾…ä¾èµ– = æ­»é”â€ã€‚
* **æ•™å­¦å»ºè®®**ï¼šè®©å­¦ç”Ÿå¯»æ‰¾å›¾ä¸­æ˜¯å¦å­˜åœ¨çŽ¯æ˜¯åˆ¤æ–­æ­»é”çš„å…³é”®æ­¥éª¤ï¼

---

> **For example, if process 1 holds resource A, process 2 holds resource B and process 1 is waiting for B and process 2 is waiting for A, then processes 1 and 2 will be deadlocked.**

* **ç¿»è¯‘**ï¼šä¾‹å¦‚ï¼šå¦‚æžœè¿›ç¨‹1å æœ‰èµ„æºAï¼Œè¿›ç¨‹2å æœ‰èµ„æºBï¼Œè€Œè¿›ç¨‹1ç­‰å¾…Bï¼Œè¿›ç¨‹2ç­‰å¾…Aï¼Œé‚£ä¹ˆå®ƒä»¬å°±æ­»é”äº†ã€‚
* **æ•™å­¦æ–¹æ³•**ï¼šå¼•å¯¼å­¦ç”Ÿç”»å‡º RAGï¼š

```
R_A â†’ P1 â†’ R_B â†’ P2 â†’ R_A ï¼ˆå½¢æˆçŽ¯ï¼‰
```

---

> **We can detect a deadlock by traversing the graph and searching for a cycle using a graph traversal algorithm, such as Depth First Search (DFS).**

* **ç¿»è¯‘**ï¼šæˆ‘ä»¬å¯ä»¥é€šè¿‡éåŽ†å›¾æ¥æ£€æµ‹æ­»é”ï¼Œä¾‹å¦‚ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰å¯»æ‰¾çŽ¯ã€‚
* **æ•™å­¦å»ºè®®**ï¼šå…ˆæ•™æ‰¾çŽ¯ï¼Œå†è¡¥å……ç®—æ³•ï¼Œä¸è¦ç›´æŽ¥è®² DFS ä¼šè®©å­¦ç”Ÿå¸æ”¶ä¸äº†ã€‚

---

> **This graph is considered as a directed graph and we can treat both the processes and resources as nodes.**

* **ç¿»è¯‘**ï¼šè¿™ä¸ªå›¾æ˜¯ä¸€ä¸ªæœ‰å‘å›¾ï¼Œæˆ‘ä»¬æŠŠè¿›ç¨‹å’Œèµ„æºéƒ½å½“ä½œå›¾ä¸­çš„èŠ‚ç‚¹ã€‚
* **æ•™å­¦æ€»ç»“**ï¼š

  * âœ… å›¾ç±»åž‹ï¼šæœ‰å‘å›¾
  * âœ… èŠ‚ç‚¹ç±»åž‹ï¼šä¸¤ç§ï¼ˆè¿›ç¨‹èŠ‚ç‚¹ã€èµ„æºèŠ‚ç‚¹ï¼‰
  * âœ… ç›®æ ‡ï¼šæ£€æµ‹çŽ¯

---

### âœ… æŽ¥ä¸‹æ¥è§£é‡Šä»£ç åŒºåŸŸå—ï¼Ÿ

æˆªå›¾ä¸‹åŠéƒ¨åˆ†å‡ºçŽ°äº†ä¸€ä¸ª C è¯­è¨€ç»“æž„ä½“ `Graph`ï¼Œè¯´æ˜ŽåŽé¢ä¼šè®²å¦‚ä½•ç”¨ç¨‹åºå®žçŽ°æ­»é”æ£€æµ‹ç®—æ³•ã€‚

---

å¦‚æžœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ç»§ç»­**é€è¡Œè®²è§£è¿™æ®µä»£ç **ï¼Œå¹¶**å‘Šè¯‰ä½ å¦‚ä½•è®²ç»™å­¦ç”Ÿå¬**ï¼Œè¿˜å¯ä»¥**å‡ºä¸€ä»½è¯¾å ‚ç¤ºèŒƒç‰ˆæ•™å­¦è®²ä¹‰**ã€‚
éœ€è¦ç»§ç»­å—ï¼Ÿâœ…

è¦ç»§ç»­è®²è¿™é¡µçš„åŽåŠéƒ¨åˆ†ä»£ç å—ï¼Ÿ ðŸ‘‡
**å›žå¤**ï¼š`ç»§ç»­è®²ä»£ç ` æˆ– `å…ˆå‡ºè®²ä¹‰`


---

## ç¬¬ 198 é¡µ

![ç¬¬ 198 é¡µ](main_chapter8_assets/page-198.png)

**æé—®ï¼š** å¯¹æˆªå›¾ä¸­çš„å†…å®¹é€å¥è¯¦ç»†ä½¿ç”¨ä¸­æ–‡è§£é‡Šï¼Œä¸ä»…ä»…åªæ˜¯ç¿»è¯‘ï¼Œè¿˜éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œé€‚å½“çš„è§£é‡Š,å‘Šè¯‰æˆ‘è¯¥æ€Žä¹ˆæ•™å­¦ç”Ÿå¹¶ä¸”æŒ‡å¯¼æ€Žä¹ˆåš

å¤ªå¥½äº†ï¼è¿™é¡µä¸»è¦è¡¥å…¨äº† **Coffman å››æ¡ä»¶**çš„åŽä¸¤æ¡ï¼Œå¹¶ç»™å‡ºä¸€ä¸ª\*\*â€œå……è¦æ€§â€è¯æ˜Žæ€è·¯\*\*ã€‚æˆ‘ä¼šæŒ‰é¡µé¢é¡ºåº**é€å¥è§£é‡Š + è¡¥å……èƒŒæ™¯ + æ•™å­¦æŒ‡å¯¼**ï¼Œè®©ä½ å¯ä»¥ç›´æŽ¥æ‹¿åŽ»è®²ã€‚

---

# ä¸€ã€Coffman æ¡ä»¶ï¼ˆè¡¥å®ŒåŽä¸¤æ¡ï¼‰

> **â€¢ Hold and Wait: Once a resource is obtained, a process keeps the resource locked.**
> ï¼ˆä¸€æ—¦æ‹¿åˆ°æŸä¸ªèµ„æºï¼Œè¿›ç¨‹ä¼šç»§ç»­ä¿æŒ/å æœ‰è¯¥èµ„æºã€‚ï¼‰

* **æ·±å…¥è§£é‡Š**ï¼š
  è¿›ç¨‹åœ¨å·²ç»æŒæœ‰æŸèµ„æºæ—¶ï¼Œä¸ä¼šä¸»åŠ¨é‡Šæ”¾å®ƒï¼ŒåŒæ—¶è¿˜ä¼šåŽ»**è¯·æ±‚åˆ«çš„èµ„æº**ã€‚è¿™ä¼šé€ æˆâ€œæ‰‹é‡Œæ”¥ç€ Aï¼Œå†åŽ»ç­‰ Bâ€ã€‚
  ä¸€æ—¦å¤šè¿›ç¨‹éƒ½â€œå„æ”¥ä¸€æŠŠâ€ï¼Œå°±å®¹æ˜“å½¢æˆ**å¾ªçŽ¯ç­‰å¾…**ã€‚
* **æ€Žä¹ˆæ•™**ï¼š

  * ä¸¾ä¾‹ï¼šæ‰“å°ä»»åŠ¡æ¡ç€**æ‰“å°æœº**ï¼ŒåˆåŽ»ç­‰**çº¸ç›’**ï¼›å¦ä¸€ä»»åŠ¡æ¡ç€**çº¸ç›’**ï¼Œç­‰**æ‰“å°æœº**ã€‚
  * è®¨è®º**å¦‚ä½•æ‰“ç ´**ï¼šè®©è¿›ç¨‹åœ¨è¯·æ±‚æ–°èµ„æºå‰**å…ˆé‡Šæ”¾å·²æœ‰èµ„æº**ï¼›æˆ–ä½¿ç”¨**ä¸€æ¬¡æ€§è¯·æ±‚å…¨éƒ¨èµ„æº**çš„åè®®ï¼ˆä½†å¯èƒ½é™ä½Žå¹¶å‘ï¼‰ã€‚

---

> **â€¢ No pre-emption: Nothing can force the process to give up a resource.**
> ï¼ˆä¸å¯æŠ¢å ï¼šç³»ç»Ÿä¸èƒ½å¼ºè¡Œè®©è¿›ç¨‹äº¤å‡ºå·²æŒæœ‰çš„èµ„æºã€‚ï¼‰

* **æ·±å…¥è§£é‡Š**ï¼š
  å·²åˆ†é…çš„èµ„æº**åªèƒ½ç”±æŒæœ‰è€…è‡ªæ„¿é‡Šæ”¾**ã€‚å¦‚æžœç³»ç»Ÿèƒ½â€œæŠŠèµ„æºä»Žç”²æŠ¢ç»™ä¹™â€ï¼Œå°±èƒ½æ‰“æ–­çŽ¯è·¯ï¼Œæ­»é”é€šå¸¸å¯è§£ã€‚
* **æ€Žä¹ˆæ•™**ï¼š

  * ä¸¾ä¾‹ï¼šæ•°æ®åº“é”ä¸€èˆ¬**ä¸å¯è¢« OS æŠ¢èµ°**ï¼›è€Œå†…å­˜é¡µåœ¨æŸäº›åœºæ™¯**å¯æŠ¢å /å›žæ”¶**ï¼ˆæ¢å‡ºï¼‰ï¼Œå› æ­¤ä¸åŒèµ„æºçš„â€œå¯æŠ¢å æ€§â€ä¸åŒã€‚
  * å¼•å¯¼å­¦ç”Ÿæ€è€ƒ pros/consï¼šå¯æŠ¢å èƒ½æé«˜æ´»æ€§ï¼Œä½†å®žçŽ°å¤æ‚ã€å¯èƒ½ç ´åä¸€è‡´æ€§ã€‚

---

# äºŒã€è¯æ˜Žï¼ˆProofï¼‰éƒ¨åˆ†é€å¥è®²è§£

æŽ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªâ€œ**å››æ¡ä»¶ â‡” æ­»é”**â€çš„**æ€è·¯æ€§è¯æ˜Ž**ã€‚æ•™æä¸æ˜¯çº¯å½¢å¼åŒ–ï¼Œä½†è¶³å¤Ÿæ•™å­¦ã€‚

---

## ï¼ˆâ‡’ æ–¹å‘ï¼‰æ­»é” â‡’ å››æ¡ä»¶æ˜¾ç„¶éƒ½æˆç«‹

> **Deadlock can happen if and only if the four Coffman conditions are satisfied.**
> ï¼ˆå½“ä¸”ä»…å½“å››æ¡ä»¶éƒ½æ»¡è¶³æ—¶ï¼Œä¼šå‘ç”Ÿæ­»é”ã€‚ï¼‰

> **â†’ If the system is deadlocked, the four Coffman conditions are apparent.**
> ï¼ˆå¦‚æžœç³»ç»Ÿå·²æ­»é”ï¼Œé‚£ä¹ˆå››æ¡ä»¶æ˜¾ç„¶æˆç«‹ã€‚ï¼‰

* **æ€Žä¹ˆæ•™**ï¼š
  å…ˆä»Žç›´è§‰å‡ºå‘ï¼šç³»ç»Ÿå·²ç»å¡æ­»ï¼Œè¯´æ˜Ž**è°ä¹Ÿæ‹¿ä¸åˆ°æƒ³è¦çš„èµ„æº**ã€**éƒ½ä¸æ”¾æ‰‹**ã€**å­˜åœ¨äº’æ–¥èµ„æº**ã€**æž„æˆçŽ¯**ã€‚ä¸‹é¢é€æ¡åè¯è¯´æ˜Žã€‚

---

### 1ï¼‰åè¯ï¼šå‡è®¾**æ²¡æœ‰å¾ªçŽ¯ç­‰å¾…**

> **For contradiction, assume that there is no circular waitâ€¦ the graph is acyclicâ€¦ at least one process is not waitingâ€¦ the system can move forwardâ€¦ not deadlocked.**

* **è¯‘+è§£**ï¼š
  è‹¥ **RAG æ— çŽ¯**ï¼Œåˆ™æ‹“æ‰‘åºå­˜åœ¨ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªè¿›ç¨‹**ä¸å¿…ç­‰å¾…**ï¼Œç³»ç»Ÿå¯å‰è¿› â‡’ ä¸Žâ€œæ­»é”â€çŸ›ç›¾ã€‚
* **æ•™**ï¼š
  è®©å­¦ç”ŸæŠŠâ€œæ— çŽ¯ â‡’ å¯æ‹“æ‰‘æŽ’åº â‡’ æœ‰å¯è¿è¡Œç»“ç‚¹â€ç”»å‡ºæ¥ï¼Œä½“ä¼šé€»è¾‘é“¾ã€‚

---

### 2ï¼‰åè¯ï¼šå‡è®¾**æ²¡æœ‰äº’æ–¥**

> **assume that there is no mutual exclusionâ€¦ no process is waitingâ€¦ breaks circular waitâ€¦ not deadlocked.**

* **è¯‘+è§£**ï¼š
  å¦‚æžœèµ„æºéƒ½**å¯å…±äº«**ï¼ˆæ— äº’æ–¥ï¼‰ï¼Œè°ä¹Ÿä¸ç”¨ç­‰è°ï¼Œè‡ªç„¶ä¸ä¼šæœ‰å¾ªçŽ¯ç­‰å¾… â‡’ ä¸æ­»é”ã€‚
* **æ•™**ï¼š
  æç¤ºè®¾è®¡æ€ç»´ï¼šæŠŠèµ„æºâ€œå¹¶è¡ŒåŒ–/å¤åˆ¶åŒ–/åªè¯»å…±äº«â€ï¼Œç­‰äºŽä»Žæ ¹ä¸Š**å‰ªæŽ‰ä¸€æ¡æ¡ä»¶**ã€‚

---

### 3ï¼‰åè¯ï¼šå‡è®¾**æ²¡æœ‰â€œå æœ‰å¹¶ç­‰å¾…â€**ï¼ˆHold & Waitï¼‰

> **assume that processes donâ€™t hold and wait but our system still deadlocksâ€¦ from circular wait at least one process must be waitingâ€¦ if no hold-and-wait then someone must let go of a resourceâ€¦ system has moved forwardâ€¦ cannot be deadlocked.**

* **è¯‘+è§£**ï¼š
  è‹¥è¿›ç¨‹**ä¸ä¼šä¸€è¾¹å æœ‰ä¸€è¾¹å†ç­‰**ï¼Œåˆ™ä¸€æ—¦éœ€è¦æ–°èµ„æºå°±ä¼š**å…ˆé‡Šæ”¾æ—§èµ„æº**ï¼ŒçŽ¯è·¯è¢«æ‰“æ–­ï¼Œç³»ç»Ÿå¯æŽ¨è¿› â‡’ ä¸æ­»é”ã€‚
* **æ•™**ï¼š
  ç”»â€œæ¾æ‰‹å†è¦â€çš„æ—¶åºå›¾ï¼Œæ˜¾ç¤ºå¦‚ä½•**æ‹†çŽ¯**ã€‚

---

### 4ï¼‰åè¯ï¼šå‡è®¾**å¯ä»¥æŠ¢å **ï¼ˆNo Pre-emption ä¸æˆç«‹ï¼‰

> **assume that we have preemptionâ€¦ the system cannot be un-deadlockedâ€¦ have/create a process that recognizes circular waitâ€¦ break one of the linksâ€¦ we must not have deadlocked.**

* **è¯‘+è§£**ï¼š
  å¦‚æžœç³»ç»Ÿ**èƒ½æŠ¢å **ï¼Œå°±èƒ½åœ¨çŽ¯ä¸Šâ€œå‰ªæ–­ä¸€æ¡è¾¹â€ï¼ˆæŠŠæŸèµ„æºä»Ž A æŠ¢ç»™ Bï¼‰ï¼Œå¾ªçŽ¯è¢«ç ´å â‡’ ä¸æ­»é”ã€‚
* **æ•™**ï¼š
  è®©å­¦ç”Ÿå£å¤´æ¨¡æ‹Ÿâ€œè¿è¡Œç›‘æŽ§å™¨æ£€æµ‹åˆ°çŽ¯ â†’ æŠ¢å  Pk çš„èµ„æº rk â†’ ç»™ Pk+1â€ï¼ŒçŽ¯æ¶ˆå¤±ã€‚

---

## ï¼ˆâ‡ æ–¹å‘ï¼‰å››æ¡ä»¶éƒ½æˆç«‹ â‡’ å­˜åœ¨æ­»é”

> **â† If the four conditions are apparent, the system is deadlocked. We will proveâ€¦ if the system is not deadlocked, the four conditions are not apparent.**

* **æ€è·¯**ï¼š
  ç”¨**æž„é€ /å½’çº³**è¯´æ˜Žï¼šè‹¥ç³»ç»Ÿèƒ½æŒç»­æŽ¨è¿›ï¼ˆä¸æ­»é”ï¼‰ï¼Œåˆ™**è‡³å°‘ç ´å**å…¶ä¸­æŸä¸€æ¡ä»¶ï¼›è‹¥å››æ¡ä¸€ç›´éƒ½ä¿æŒæˆç«‹ï¼Œå°±ä¼šå¡ä½ã€‚

---

### å»ºæ¨¡ç¬¦å·ä¸Žè¿‡ç¨‹ï¼ˆæ•™æç»™çš„â€œåŠå½¢å¼åŒ–â€æ¡†æž¶ï¼‰

> **build a system with three requirements not including circular waitâ€¦ processes P = {p1â€¦pn}, resources R = {r1â€¦rm}â€¦ one request at a timeâ€¦ system state at time t is a tuple (h\_t, w\_t)**

* **è¯‘ä¸Žè§£é‡Š**ï¼š

  * è¿›ç¨‹é›†åˆ **P**ã€èµ„æºé›†åˆ **R**ï¼›
  * ç®€åŒ–ï¼šä¸€æ—¶åˆ»æ¯ä¸ªè¿›ç¨‹**åªæå‡ºä¸€ä¸ªè¯·æ±‚**ï¼ˆå¯æ³›åŒ–ï¼‰ï¼›
  * ç³»ç»ŸçŠ¶æ€ç”¨äºŒå…ƒç»„ **(h\_t, w\_t)**ï¼š

    * **h\_t : R â†’ P âˆª {unassigned}**ï¼ˆèµ„æºå½’å±žï¼šå“ªä¸ªèµ„æºç»™äº†å“ªä¸ªè¿›ç¨‹æˆ–å°šæœªåˆ†é…ï¼‰
    * **w\_t : P â†’ R âˆª {satisfied}**ï¼ˆè¯·æ±‚æ˜ å°„ï¼šè¿›ç¨‹æ­¤åˆ»åœ¨è¦å“ªä¸ªèµ„æºï¼Œæˆ–å·²æ»¡è¶³ï¼‰

> **Let L\_t âŠ† P Ã— R be the set of lists of requests a process uses to release a resourceâ€¦ evolution of the systemâ€¦**

* **è¯‘+è§£**ï¼š
  L\_t æè¿°â€œé‡Šæ”¾åŠ¨ä½œ/é¡ºåºâ€ï¼Œæ–¹ä¾¿å®šä¹‰çŠ¶æ€æŽ¨è¿›ã€‚æ ¸å¿ƒæ˜¯ï¼šå¦‚æžœ**æŸä¸€æ­¥æ‰¾ä¸åˆ°èƒ½è¢«æ»¡è¶³çš„è¯·æ±‚**ï¼Œä¸”å¤§å®¶éƒ½åœ¨è¯·æ±‚ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±**åœæœº**ï¼ˆæ­»é”ï¼‰ã€‚

---

### çŠ¶æ€æŽ¨è¿›è§„åˆ™ï¼ˆæ¯è½®è¿­ä»£åšä¸‹é¢å‡ ä»¶äº‹ï¼‰

> **â€¢ Release all resources in L\_t.**
> **â€¢ Find a process that is requesting a resource.**
> **â€¢ If that resource is available give it to that process, generating a new (h\_{t+1}, w\_{t+1}) and exit the current iteration.**
> **â€¢ Else find another process and try the same procedureâ€¦**

* **è¯‘+è§£**ï¼š

  1. å…ˆå¤„ç†è¿™ä¸€æ­¥è¯¥é‡Šæ”¾çš„èµ„æºï¼›
  2. æ‰¾ä¸€ä¸ªæ­£åœ¨è¯·æ±‚çš„è¿›ç¨‹ï¼›
  3. å¦‚æžœå®ƒè¦çš„èµ„æº**ç©ºé—²**ï¼Œå°±åˆ†é…ï¼ˆç³»ç»Ÿå‰è¿›ä¸€æ­¥ï¼‰ï¼›
  4. å¦åˆ™æ¢ä¸‹ä¸€ä¸ªè¿›ç¨‹è¯•ï¼›
     **å¦‚æžœæŠŠæ‰€æœ‰è¿›ç¨‹éƒ½è¯•è¿‡äº†ï¼Œä»æ²¡äººèƒ½è¢«æ»¡è¶³** â‡’ å½“å‰æ— å‰è¿›ç©ºé—´ â‡’ æ­»é”ã€‚

* **æ€Žä¹ˆæ•™**ï¼š
  æŠŠè¿™ä¸€è¿‡ç¨‹å½“ä½œâ€œ**é“¶è¡Œå®¶ç®—æ³•å‰å¥**â€æˆ–â€œè´ªå¿ƒåˆ†é…å°å¾ªçŽ¯â€ï¼Œè®©å­¦ç”ŸåŠ¨æ‰‹æ¨¡æ‹Ÿ 2â€“3 è½®ã€‚

---

### æ­»é”åˆ¤å®šçš„å£å¾„

> **If all processes have been surveyedâ€¦ none can be granted a resource, consider it deadlocked.**

* **è¯‘**ï¼š
  è‹¥ä¸€è½®ä¸‹æ¥æ‰€æœ‰è¿›ç¨‹éƒ½çœ‹è¿‡ï¼Œä¸”æ²¡äººèƒ½èŽ·æ‰¹èµ„æº â€”â€” åˆ¤ä¸ºæ­»é”ã€‚

> **Formallyâ€¦ deadlocked means if âˆƒt0, âˆ€t â‰¥ t0, âˆ€p âˆˆ P, w\_t(p) â‰  satisfied and âˆƒq, q â‰  p, h\_t(w\_t(p)) = q (which is what we need to prove).**

* **ç›´è¯‘+è§£é‡Š**ï¼š
  å­˜åœ¨æŸä¸ªæ—¶åˆ» t0ï¼Œä»¥åŽæ‰€æœ‰æ—¶åˆ» t â‰¥ t0ï¼š

  * æ¯ä¸ªè¿›ç¨‹ p çš„è¯·æ±‚ **w\_t(p)** éƒ½**æœªè¢«æ»¡è¶³**ï¼›
  * ä¸”å®ƒæƒ³è¦çš„èµ„æº **w\_t(p)** æ€»æ˜¯è¢«**å¦ä¸€ä¸ªè¿›ç¨‹ q** æŒæœ‰ï¼ˆå½¢æˆäº’ç›¸å¡ä½çš„é“¾ï¼‰ã€‚
    è¿™æ­£æ˜¯**å¾ªçŽ¯ç­‰å¾… + æŒæœ‰å¹¶ç­‰å¾… + äº’æ–¥ + ä¸å¯æŠ¢å **å…±åŒé€ æˆçš„åœæ»žã€‚

---

> **Mutual exclusion and no pre-emption are encoded into the system. Circular wait implies the second conditionâ€¦**

* **è¯‘+è§£**ï¼š
  äº’æ–¥ä¸Žä¸å¯æŠ¢å ä½œä¸º**ç³»ç»Ÿå‡è®¾**å·²å†™å…¥ï¼ˆencodedï¼‰ï¼›å¾ªçŽ¯ç­‰å¾…æ„å‘³ç€â€œæ­¤æ—¶æŸèµ„æºè¢«å¦ä¸€ä¸ªè¿›ç¨‹æŒæœ‰ï¼Œè€Œé‚£ä¸ªè¿›ç¨‹åˆè¢«å¦ä¸€ä¸ªè¿›ç¨‹æŒæœ‰èµ„æºå¡ä½â€¦â€¦â€ï¼Œä¹Ÿå°±æ˜¯æŠŠå››æ¡ä»¶è¿žæˆ**é—­çŽ¯**ã€‚

* **æ€Žä¹ˆæ•™**ï¼š
  ç”»ä¸€æ¡é“¾ï¼š
  `p1 ç­‰ r1ï¼ˆr1 åœ¨ p2 æ‰‹é‡Œï¼‰ â†’ p2 ç­‰ r2ï¼ˆr2 åœ¨ p3 æ‰‹é‡Œï¼‰ â†’ â€¦ â†’ pk ç­‰ rkï¼ˆrk åœ¨ p1 æ‰‹é‡Œï¼‰`
  ç„¶åŽå¯¹ç…§å››æ¡ä»¶é€ä¸€æ‰“é’©ã€‚

---

# ä¸‰ã€è¯¾å ‚æ•™å­¦æ€Žä¹ˆè½åœ°ï¼ˆå¯ç›´æŽ¥ä½¿ç”¨ï¼‰

## A. é»‘æ¿ä¸‰æ­¥èµ°

1. **å¤ä¹ å››æ¡ä»¶**ï¼ˆ2 åˆ†é’Ÿï¼‰

   * äº’æ–¥ / å æœ‰å¹¶ç­‰å¾… / ä¸å¯æŠ¢å  / å¾ªçŽ¯ç­‰å¾…
   * â€œæ‰“ç ´ä»»ä¸€æ¡ â‡’ ä¿è¯ä¸æ­»é”â€
2. **çŽ¯è·¯åè¯æ¼”ç¤º**ï¼ˆ5 åˆ†é’Ÿï¼‰

   * ç”»æ— çŽ¯ RAG â†’ è§£é‡Šâ€œæ‹“æ‰‘åº/å¯å‰è¿›â€ï¼›
   * ç”»æœ‰çŽ¯ RAG â†’ è¯´æ˜Žâ€œæ»¡è¶³å››æ¡ â‡’ å¯èƒ½å¡æ­»â€ã€‚
3. **çŠ¶æ€æŽ¨è¿›å°æ¸¸æˆ**ï¼ˆ8 åˆ†é’Ÿï¼‰

   * å‘ä¸€å¼ è¿›ç¨‹â€“èµ„æºå°è¡¨ï¼ˆ2â€“3 è¿›ç¨‹ã€2â€“3 èµ„æºï¼‰ï¼›
   * å­¦ç”ŸæŒ‰è§„åˆ™â€œæ‰¾èƒ½æ»¡è¶³çš„è¯·æ±‚â†’åˆ†é…â†’ä¸‹ä¸€æ­¥â€ï¼›
   * è§‚å¯Ÿâ€œæŸè½®æ²¡äººå¯è¢«æ»¡è¶³ â‡’ å®£å¸ƒæ­»é”â€ã€‚

## B. è®¨è®ºé¢˜ï¼ˆå°ç»„ 6 åˆ†é’Ÿï¼‰

* é¢˜ç›®ï¼š**åœ¨ä¸ç‰ºç‰²å¤ªå¤šåžåçš„å‰æä¸‹ï¼Œä½ ä¼šä¼˜å…ˆç ´åå“ªä¸€æ¡æ¡ä»¶ï¼Ÿ**
  å‚è€ƒï¼š

  * æ‰“ç ´â€œå¾ªçŽ¯ç­‰å¾…â€æœ€å¸¸è§ï¼ˆèµ„æºå…¨åº + åªå‡ä¸é™ï¼‰ï¼›
  * åˆ†åœºæ™¯å¼•å…¥â€œå¯æŠ¢å â€ï¼ˆå¦‚è¶…æ—¶æ”¶å›žé”ï¼‰ï¼›
  * ç”¨â€œå¯å…±äº«â€ç¼“è§£â€œäº’æ–¥â€ï¼ˆè¯»å¤šå†™å°‘åœºæ™¯ï¼‰ã€‚

## C. ä½œä¸š/å®žéªŒå»ºè®®

* **å®žçŽ° `isCyclic`ï¼ˆå¸¦ `in_stack` æ ‡è®°ï¼‰**ï¼Œè¾“å…¥è¾¹è¡¨è¾“å‡ºä¸€æ¡çŽ¯ï¼›
* **æ¨¡æ‹Ÿåˆ†é…è¿‡ç¨‹**ï¼ˆå¦‚ä¸Šâ€œçŠ¶æ€æŽ¨è¿›â€ï¼‰ï¼Œæ£€æµ‹â€œæ— äººå¯æ»¡è¶³â€çš„è½®æ¬¡ï¼Œå¹¶æ‰“å°æ­¤åˆ»çš„ç­‰å¾…é“¾ï¼›
* **è®¾è®¡ä¸€æ¡ç­–ç•¥**æ‰“ç ´æŸä¸ª Coffman æ¡ä»¶ï¼Œç»™å‡ºåˆ©å¼Šä¸Žåœºæ™¯ã€‚

---

# å››ã€æ˜“æ··ä¸Žæ˜“é”™ç‚¹æé†’

* **â€œçœ‹åˆ°çŽ¯ = ä¸€å®šæ­»é”ï¼Ÿâ€**
  ä¸ä¸€å®šï¼ˆç³»ç»Ÿå¯èƒ½æŠ¢å /å›žæ»šï¼‰ï¼›ä½†**å››æ¡ä»¶åŒæ—¶æ»¡è¶³** â‡’ **éžé›¶æ¦‚çŽ‡**åœ°ä¼šå¡ä½ã€‚è€ƒè¯•è¦è¯´æ¸…æ¥šâ€œå……è¦/å¯èƒ½æ€§â€çš„æŽªè¾žã€‚
* **Hold & Wait ä¸Ž Circular Wait çš„åŒºåˆ«**ï¼š
  å‰è€…è¯´**ä¸ªä½“è¡Œä¸º**ï¼ˆä¸€è¾¹å æœ‰ä¸€è¾¹ç­‰ï¼‰ï¼›åŽè€…è¯´**å…¨å±€ç»“æž„**ï¼ˆå½¢æˆçŽ¯ï¼‰ã€‚ä¸¤è€…å¸¸ç›¸äº’å¼ºåŒ–ï¼Œä½†ä¸æ˜¯åŒä¸€æ¦‚å¿µã€‚
* **åªç”¨ä¸€ä¸ª `visited`** å®¹æ˜“è¯¯åˆ¤çŽ¯ï¼›æ•™å­¦ç¼–ç¨‹æ—¶åŠ å…¥ `in_stack`/â€œä¸‰è‰²æ ‡è®°â€ã€‚

---

éœ€è¦çš„è¯ï¼Œæˆ‘å¯ä»¥ç»™ä½ ï¼š

* ä¸€é¡µå¼**è®²ä¹‰ PDF**ï¼ˆå››æ¡ä»¶å›¾è§£ + åè¯æµç¨‹å›¾ + çŠ¶æ€æŽ¨è¿›è§„åˆ™ï¼‰ï¼›
* **å¯è¿è¡Œ Python æ¨¡æ¿**ï¼ˆè¯»å…¥ RAGã€DFS æ‰¾çŽ¯ã€æ¨¡æ‹Ÿåˆ†é…ç›´åˆ°æ£€æµ‹æ­»é”ï¼‰ã€‚


---

## ç¬¬ 199 é¡µ

![ç¬¬ 199 é¡µ](main_chapter8_assets/page-199.png)

**æé—®ï¼š** å¯¹æˆªå›¾ä¸­çš„å†…å®¹é€å¥è¯¦ç»†ä½¿ç”¨ä¸­æ–‡è§£é‡Šï¼Œä¸ä»…ä»…åªæ˜¯ç¿»è¯‘ï¼Œè¿˜éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œé€‚å½“çš„è§£é‡Š,å‘Šè¯‰æˆ‘è¯¥æ€Žä¹ˆæ•™å­¦ç”Ÿå¹¶ä¸”æŒ‡å¯¼æ€Žä¹ˆåš

ä¸‹é¢è¿™é¡µåˆ†ä¸‰å—ï¼šâ‘ ä¸Šä¸€é¡µè¯æ˜Žé‡Œæœ€åŽçš„â€œå½¢å¼åŒ–æ¡ä»¶â€æ€»ç»“ï¼›â‘¡ç”¨â€œå­¦ç”ŸæŠ¢ç¬”å’Œçº¸â€çš„ç”Ÿæ´»åŒ–ä¾‹å­è§£é‡Šå››æ¡ä»¶ä¸Ž**æ´»é”**ï¼ˆlivelockï¼‰ï¼›â‘¢8.3 è®²â€œå¤„ç†æ´»é”ä¸Žæ­»é”çš„åŠžæ³•â€ã€‚æˆ‘æŒ‰åŽŸæ–‡**é€å¥ç¿»è¯‘+è§£é‡Š**ï¼Œå¹¶ç»™ä½ **è¯¾å ‚æ€Žä¹ˆè®²ã€æ€Žä¹ˆç»ƒ**çš„å»ºè®®ã€‚

---

# â‘  è¯æ˜Žæ”¶æŸï¼ˆå½¢å¼åŒ–æ¡ä»¶ï¼‰

> **âˆ€p âˆˆ P âˆƒq â‰  p â†’ hâ‚œ(wâ‚œ(p)) = q. Circular wait also implies that at this current state, no process is satisfied, meaning at this state âˆ€p âˆˆ P, wâ‚œ(p) â‰  satisfied. Hold and wait simply provesâ€¦ from this point onward, the system will not change, which is all the conditions we needed to show.**

* **ç¿»è¯‘**ï¼šå¯¹äºŽé›†åˆ P ä¸­çš„æ¯ä¸ªè¿›ç¨‹ pï¼Œéƒ½å­˜åœ¨å¦ä¸€ä¸ªä¸åŒçš„è¿›ç¨‹ qï¼Œä½¿å¾—åœ¨æ—¶åˆ» tï¼Œp æƒ³è¦çš„èµ„æº wâ‚œ(p) çš„æŒæœ‰è€…æ˜¯ qï¼ˆå³ hâ‚œ(wâ‚œ(p))=qï¼‰ã€‚å¾ªçŽ¯ç­‰å¾…è¿˜æ„å‘³ç€åœ¨å½“å‰çŠ¶æ€ä¸‹ï¼Œæ²¡æœ‰è¿›ç¨‹è¯·æ±‚è¢«æ»¡è¶³ï¼Œå³å¯¹æ‰€æœ‰ p éƒ½æœ‰ wâ‚œ(p)â‰ â€œå·²æ»¡è¶³â€ã€‚â€œå æœ‰å¹¶ç­‰å¾…ï¼ˆHold & Waitï¼‰â€åˆ™è¯´æ˜Žä»Žè¿™ä¸€åˆ»èµ·ç³»ç»ŸçŠ¶æ€ä¸ä¼šå†å˜åŒ–ï¼ˆè°ä¹Ÿä¸æ”¾æ‰‹ã€ä¹Ÿæ‹¿ä¸åˆ°ï¼‰ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬è¦è¯æ˜Žçš„å…¨éƒ¨æ¡ä»¶ã€‚
* **è§£é‡Š**ï¼šä¸€å¥è¯æŠŠå››æ¡ä»¶æ‹¼èµ·æ¥ï¼š

  * **äº’æ–¥**ï¼šèµ„æºåªåœ¨ hâ‚œ ä¸­è¢«å”¯ä¸€è¿›ç¨‹å ç”¨ï¼›
  * **å¾ªçŽ¯ç­‰å¾…**ï¼šæ¯ä¸ª p çš„ç›®æ ‡èµ„æºéƒ½åœ¨å¦ä¸€ä¸ª q æ‰‹é‡Œï¼Œé¦–å°¾ç›¸æŽ¥æˆçŽ¯ï¼›
  * **å æœ‰å¹¶ç­‰å¾…**ï¼šæ‰‹é‡Œæ”¥ç€ã€ä¸é‡Šæ”¾ï¼›
  * **ä¸å¯æŠ¢å **ï¼šæ²¡äººèƒ½æŠŠèµ„æºæŠ¢èµ°ï¼Œæ‰€ä»¥çŠ¶æ€åœæ»žã€‚
* **æ•™å­¦æ€Žä¹ˆè®²**ï¼šæŠŠè¿™è¡Œå¼å­ç”»æˆä¸€æ¡â€œç­‰å¾…é“¾â€ï¼š
  `p1 ç­‰ r1(åœ¨ p2) â†’ p2 ç­‰ r2(åœ¨ p3) â†’ â€¦ â†’ pk ç­‰ rk(åœ¨ p1)`
  ç„¶åŽç»™å››æ¡ä»¶é€ä¸€æ‰“å‹¾ï¼Œè®©å­¦ç”Ÿçœ‹åˆ°â€œçŽ¯ + ä¸æ”¾ + ä¸èƒ½æŠ¢ + äº’æ–¥ â‡’ ä¸€åŠ¨ä¸åŠ¨â€ã€‚

---

# â‘¡ ç”Ÿæ´»ä¾‹å­ï¼šä¸¤åå­¦ç”Ÿä¸Žä¸€æ”¯ç¬”ä¸€å¼ çº¸ï¼ˆå¼•å‡ºæ´»é”ï¼‰

> **If a system breaks any of them, it cannot have deadlock!**

* **è¯‘**ï¼šåªè¦æ‰“ç ´å››æ¡ä»¶ä¸­çš„ä»»æ„ä¸€æ¡ï¼Œå°±ä¸ä¼šæ­»é”ã€‚
* **æ•™**ï¼šæ¿ä¹¦â€œ**ç ´ä¸€æ¡=ä¿æ´»æ€§**â€ã€‚æŽ¥ç€ç”¨ä¾‹å­æ¼”ç¤ºåˆ†åˆ«æ€Žä¹ˆç ´ã€‚

> **Consider the scenario where two students need to write both pen and paper and there is only one of each.**

* **è¯‘**ï¼šè®¾æœ‰ä¸¤åå­¦ç”Ÿå†™ä½œä¸šï¼Œå„éœ€è¦â€œç¬”+çº¸â€ï¼Œè€Œç¬”åªæœ‰ä¸€æ”¯ã€çº¸åªæœ‰ä¸€å¼ ã€‚
* **è§£é‡Š**ï¼šè¿™æ˜¯æœ€å°åŒ–çš„â€œä¸¤ä¸ªè¿›ç¨‹ã€ä¸¤ä¸ªç‹¬å èµ„æºâ€çš„æ¨¡åž‹ã€‚

> **Breaking mutual exclusion means that the students share the pen and paper.**

* **è¯‘**ï¼šç ´â€œäº’æ–¥â€= è®©èµ„æºå¯å…±äº«ï¼ˆä¸¤äººä¸€èµ·ç”¨ç¬”/çº¸ï¼‰ã€‚
* **è§£é‡Š**ï¼šçŽ°å®žé‡Œä¸å¤ªå¯è¡Œï¼Œä½†æ¦‚å¿µä¸Šè¯´æ˜Žï¼š**è‹¥èƒ½å…±äº«å°±ä¸ä¼šç­‰**ã€‚

> **Breaking circular wait could be that the students agree to grab the pen then the paper.**

* **è¯‘**ï¼šç ´â€œå¾ªçŽ¯ç­‰å¾…â€= çº¦å®š**æ‹¿èµ„æºçš„é¡ºåº**ï¼ˆå…ˆç¬”åŽçº¸ï¼‰ã€‚
* **è§£é‡Š**ï¼šè¿™å°±æ˜¯â€œèµ„æºå…¨åºæ³•â€ï¼šåªå…è®¸æŒ‰åŒä¸€é€’å¢žæ¬¡åºè¯·æ±‚ï¼Œæœç»å›žå¤´æ‹¿å°å·èµ„æºï¼Œè‡ªç„¶æ— çŽ¯ã€‚

> **As proof by contradiction, say that deadlock occursâ€¦ that means a student would have to be waiting on a pen while holding the paper and the other waiting on a pen and holding the paper.**

* **è¯‘**ï¼šåè¯ï¼šè‹¥ä»æ­»é”ï¼Œåˆ™å¿…ç„¶å‡ºçŽ° A ç­‰ç¬”å´æ‹¿ç€çº¸ã€B ä¹Ÿç­‰ç¬”ä¸”æ‹¿ç€çº¸ã€‚
* **è§£é‡Š**ï¼šä¸Žâ€œå…ˆæ‹¿ç¬”åŽæ‹¿çº¸â€çš„çº¦å®šçŸ›ç›¾ï¼ˆå› ä¸ºä¸¤äººéƒ½å…ˆæ‹¿åˆ°äº†çº¸ï¼‰ã€‚

> **We have contradicted ourselves because one student grabbed the paper without grabbing the penâ€¦**

* **è¯‘**ï¼šè¿™ä¸Žç­–ç•¥å†²çªï¼Œæ•…ä¸å¯èƒ½æ­»é”ã€‚
* **æ•™**ï¼šè®©å­¦ç”Ÿç”¨**æ—¶åºå›¾**æ¼”ç»ƒâ€œç»Ÿä¸€é¡ºåºâ€çš„æ­£ç¡®æ€§ï¼šè°å…ˆæ‹¿ç¬”ã€è°åŽæ‹¿ç¬”éƒ½èƒ½æŽ¨è¿›ã€‚

> **Breaking hold and waitâ€¦ students try to get the pen then the paper and if a student fails to grab the paper then they release the pen. This introduces a new problem called livelockâ€¦**

* **è¯‘**ï¼šç ´â€œå æœ‰å¹¶ç­‰å¾…â€ï¼šè§„å®š**æ‹¿ä¸åˆ°ä¸‹ä¸€ä¸ªèµ„æºå°±é‡Šæ”¾å·²æœ‰èµ„æº**ã€‚ä½†è¿™ä¼šå¼•å…¥ä¸€ä¸ªæ–°é—®é¢˜ï¼š**æ´»é”**ã€‚
* **è§£é‡Š**ï¼šæ´»é”=å¤§å®¶éƒ½åœ¨â€œå¿™ç€è®©è·¯/é‡è¯•â€ï¼Œ**ç³»ç»Ÿæ²¡æœ‰å¡æ­»**ï¼Œå´**æ²¡æœ‰å‰è¿›**ã€‚
* **æ•™**ï¼šæ¼”ç¤ºâ€œAB åŒæ­¥ç¤¼è®©â€ï¼šA æ‹¿ç¬”â†’ç­‰çº¸â†’å¤±è´¥â†’æ”¾ç¬”ï¼›B ä¹Ÿå¦‚æ­¤ï¼›ä¸¤äºº**ä¸€ç›´ç¤¼è®©**ï¼Œè°ä¹Ÿå†™ä¸æˆä½œä¸šã€‚

> **Breaking preemption means that if the two students are in deadlock the teacher can come in and break up the deadlock by giving one of the students a held item or tell both students to put the items down.**

* **è¯‘**ï¼šç ´â€œä¸å¯æŠ¢å â€ï¼šè€å¸ˆä»‹å…¥ï¼Œ**æŠŠèµ„æºä»Žä¸€ä¸ªäººæ‰‹é‡Œæ‹¿èµ°**æˆ–è®©ä¸¤äººéƒ½æ”¾ä¸‹ã€‚
* **è§£é‡Š**ï¼šè¿™å°±æ˜¯â€œæŠ¢å /å›žæ»šâ€çš„å·¥ç¨‹æ‰‹æ®µã€‚

---

### æ´»é”å†è§£é‡Š

> **livelock relates to deadlockâ€¦ philosopher picks up the same device again and againâ€¦ no work will be done.**

* **è¯‘**ï¼šæ´»é”ä¸Žæ­»é”ç›¸å…³ï¼›æ¯”å¦‚å“²å­¦å®¶ä¸æ–­æŒ‰ç›¸åŒæ¨¡å¼æ‹¿æ”¾å‰å­ï¼Œ**ä¸€ç›´åœ¨åŠ¨ä½œ**ä½†**æ²¡æœ‰è¿›åº¦**ã€‚
* **è§£é‡Š**ï¼šæ´»é”æ˜¯â€œ**å¿™ç­‰/å¿™è®©**â€ï¼ŒCPU æœ‰åŠ¨ä½œã€ä»»åŠ¡æ²¡æŽ¨è¿›ã€‚

> **Livelock is generally harder to detect because the processes generally look like they are workingâ€¦**

* **è¯‘**ï¼šæ´»é”æ›´éš¾æ£€æµ‹ï¼Œå› ä¸ºä»Žå¤–éƒ¨çœ‹è¿›ç¨‹åœ¨â€œå¿™â€ï¼Œä¸åƒæ­»é”é‚£ä¹ˆæ˜Žæ˜¾ã€‚
* **æ•™**ï¼šå¯¹æ¯”ç›‘æŽ§æŒ‡æ ‡ï¼š**æ­»é”**â†’çº¿ç¨‹é˜»å¡žã€æ— ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼›**æ´»é”**â†’é«˜åˆ‡æ¢ã€é«˜è°ƒç”¨ã€ä½†åžåâ‰ˆ0ã€‚

> **Another problem is that there are necessary conditions for livelock (i.e. deadlock fails to occur) but not sufficient conditionsâ€¦**

* **è¯‘**ï¼šæ´»é”åªæœ‰**å¿…è¦æ¡ä»¶**ï¼ˆä¾‹å¦‚æœªæ»¡è¶³æ­»é”æ¡ä»¶ï¼‰ï¼Œä½†æ²¡æœ‰ä¸€ç»„æ˜Žç¡®çš„â€œå……è¦æ¡ä»¶â€ã€‚
* **è§£é‡Š**ï¼šæ´»é”æ¨¡å¼å¤šå˜ï¼Œéš¾ä»¥ä¸€ç»„å…¬ç†ç©·å°½ï¼Œéœ€è¦\*\*ä¸å˜å¼ï¼ˆinvariantï¼‰\*\*è¯æ˜Žã€‚

> **One has to enumerate each of the steps of a system and if each of the steps eventuallyâ€¦ leads to forward progress, the system fails to livelock.**

* **è¯‘**ï¼šè¦è¯æ˜Ž**ä¸ä¼šæ´»é”**ï¼Œå¸¸ç”¨åŠžæ³•æ˜¯å®šä¹‰ä¸å˜å¼å¹¶æžšä¸¾ç³»ç»Ÿæ­¥éª¤ï¼Œè¯æ˜Ž**æœ‰é™æ­¥å†…å¿…å‰è¿›**ï¼ˆå³**æœ‰ç•Œç­‰å¾…**ï¼‰ã€‚
* **æ•™**ï¼šå¼•å…¥â€œæœ‰ç•Œç­‰å¾…/å…¬å¹³æ€§â€æ¦‚å¿µï¼ˆbounded wait/fairnessï¼‰ã€‚

> **There are even better systems that prove bounded waits; a system can only be livelocked for at most n cyclesâ€¦ stock exchanges.**

* **è¯‘**ï¼šæ›´å¼ºçš„ç³»ç»Ÿèƒ½è¯æ˜Ž**ç­‰å¾…æœ‰ä¸Šç•Œ**ï¼šæœ€å¤šæ´»é” n æ¬¡å°±ä¼šå‰è¿›ï¼›è¿™ç§æ€§è´¨å¯¹è¯åˆ¸äº¤æ˜“æ‰€ç­‰åœºæ™¯å¾ˆé‡è¦ã€‚
* **è¯¾å ‚æ´»åŠ¨**ï¼šè®©å­¦ç”Ÿè®¾è®¡â€œéšæœºé€€é¿+ä¸Šé™â€çš„æ´»é”åŒ–è§£ç­–ç•¥ï¼ˆå¦‚ä»¥å¤ªç½‘é€€é¿ã€æŒ‡æ•°é€€é¿ï¼‰ã€‚

---

# â‘¢ 8.3 è§£å†³æ´»é”ä¸Žæ­»é”çš„æ€è·¯

> **Ignoring deadlock is the most obvious approachâ€¦ â€œostrich algorithmâ€.**

* **è¯‘**ï¼š**å¿½ç•¥æ­»é”**æ˜¯æœ€ç›´è§‚çš„æ–¹æ¡ˆï¼Œä¿—ç§°â€œ**é¸µé¸Ÿç®—æ³•**â€ï¼ˆæŠŠå¤´åŸ‹æ²™é‡Œå½“çœ‹ä¸è§ï¼‰ã€‚
* **è§£é‡Š**ï¼šå¯¹æ™®é€šæ¡Œé¢/æ‰‹æœºç³»ç»Ÿï¼Œ**å¶å‘æ­»é”**å¸¸é â€œé‡å¯/é‡è¯•/è¶…æ—¶â€è‡ªç„¶æ¶ˆé€€ã€‚
* **æ•™**ï¼šæé†’å·¥ç¨‹å–èˆï¼šæˆæœ¬ä½Žã€æ•ˆæžœå¤Ÿç”¨ï¼Œä½†**ä¸é€‚åˆå…³é”®ç³»ç»Ÿ**ã€‚

> **When the OS detects deadlock, it does nothing out of the ordinary, and any deadlock usually goes away.**

* **è¯‘**ï¼šç³»ç»Ÿå‘çŽ°æ­»é”ä¹Ÿä¸åšç‰¹åˆ«å¤„ç†ï¼Œé€šå¸¸é æ—¶é—´ç‰‡åˆ‡æ¢ã€èµ„æºé‡Šæ”¾ç­‰â€œè‡ªç„¶è§£å†»â€ã€‚

> **An operating system preempts processes when stopping them for context switchesâ€¦ potentially breaking a deadlock scenario.**

* **è¯‘**ï¼š**ä¸Šä¸‹æ–‡åˆ‡æ¢**æœ¬èº«å°±æ˜¯ä¸€ç§è½»åº¦â€œæŠ¢å â€ï¼Œèƒ½é¡ºå¸¦æ‰“ç ´ä¸€äº›æ­»é”å±€é¢ã€‚
* **è¡¥å……**ï¼šä¸æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„â€œèµ„æºæŠ¢å â€ï¼Œä½†ä¼šæ”¹å˜æ—¶åºï¼Œè®©å†²çªé¿å¼€ã€‚

> **The OS also makes some files read-only thus making the resource shareable.**

* **è¯‘**ï¼šæŠŠæŸäº›æ–‡ä»¶è®¾ä¸ºåªè¯»ï¼Œä»Žäº’æ–¥å˜å…±äº«ï¼Œä¹Ÿèƒ½å‡å°‘æ­»é”æœºä¼šã€‚

> **What the algorithm refers to is that if there is an adversaryâ€¦ crafts a programâ€¦ that the OS deadlocks.**

* **è¯‘**ï¼šä½†è‹¥é‡åˆ°â€œå¯¹æ‰‹å¼â€ç¨‹åºï¼ˆæ•…æ„åˆ¶é€ ï¼‰ï¼Œé¸µé¸Ÿæ³•å¯èƒ½è®© OS çœŸçš„å¡ä½ã€‚
* **æ•™**ï¼šåŒºåˆ†â€œæ—¥å¸¸å¤Ÿç”¨â€ä¸Žâ€œå¯¹æŠ—çŽ¯å¢ƒä¸å®‰å…¨â€ã€‚

---

> **Deadlock detection allows the system to enter a deadlocked state. After entering, the system uses the information to break deadlock.**

* **è¯‘**ï¼š**æ­»é”æ£€æµ‹**ï¼šå…è®¸ç³»ç»Ÿè¿›å…¥æ­»é”æ€ï¼Œä½†**æ£€æµ‹åˆ°åŽ**ç”¨ä¿¡æ¯æ¥**æ‰“ç ´**ã€‚
* **è§£é‡Š**ï¼šå…¸åž‹åšæ³•ï¼šå»ºå›¾â†’æ‰¾çŽ¯â†’å›žæ»š/æ€è¿›ç¨‹/æ’¤é”€äº‹åŠ¡ã€‚

> **Example: multiple processes accessing filesâ€¦ OS keeps track via file descriptorsâ€¦ detects a directed cycleâ€¦ may break one processâ€™ hold through schedulingâ€¦**

* **è¯‘**ï¼šä¾‹å­ï¼šå¤šè¿›ç¨‹è®¿é—®æ–‡ä»¶ï¼›OS é€šè¿‡æ–‡ä»¶æè¿°ç¬¦è¿½è¸ªï¼Œå‘çŽ°**æœ‰å‘çŽ¯**å°±**æ‰“æ–­**æŸè¿›ç¨‹çš„æŒæœ‰æˆ–è°ƒæ•´è°ƒåº¦è®©ç³»ç»Ÿç»§ç»­ã€‚
* **æ•™**ï¼šæŠŠâ€œæ–‡ä»¶-è¿›ç¨‹â€ç”»æˆäºŒéƒ¨å›¾ï¼Œåšä¸€æ¬¡çŽ¯æ£€æµ‹æ¼”ç¤ºã€‚

> **Why popular: there is no way of knowing which resources a program will select without running the program. This is an extension of Riceâ€™s theoremâ€¦ cannot know semantic feature without running the program.**

* **è¯‘**ï¼šå—æ¬¢è¿Žçš„åŽŸå› ï¼š**ä¸è¿è¡Œç¨‹åºå°±æ— æ³•çŸ¥é“å®ƒä¼šè¯·æ±‚å“ªäº›èµ„æº**ï¼ˆç±»ä¼¼ **Rice å®šç†**çš„æ€æƒ³ï¼šç¨‹åºè¯­ä¹‰æ€§è´¨ä¸å¯åˆ¤å®šï¼‰ã€‚æ‰€ä»¥**é™æ€å½»åº•é¿å…**ä¸çŽ°å®žï¼Œåªèƒ½**è¿è¡Œä¸­æ£€æµ‹**ã€‚
* **è¯¾å ‚æ‰©å±•**ï¼šå’Œâ€œé“¶è¡Œå®¶ç®—æ³•ï¼ˆéœ€è¦å…ˆå£°æ˜Žæœ€å¤§éœ€æ±‚ï¼‰â€å¯¹æ¯”ï¼šçŽ°ä»£é€šç”¨ç³»ç»Ÿå¾ˆå°‘èƒ½æå‰ç²¾ç¡®å£°æ˜Žå…¨éƒ¨èµ„æºï¼Œå› æ­¤å€¾å‘â€œè¿è¡Œæ—¶æ£€æµ‹+å¹²é¢„â€ã€‚

---

## è¯¾å ‚æ€Žä¹ˆæ•™ï¼ˆå¯ç›´æŽ¥ç…§åšï¼‰

1. **çƒ­èº« 3 åˆ†é’Ÿ**ï¼šå›žé¡¾å››æ¡ä»¶ï¼Œç”¨â€œç¬”ä¸Žçº¸â€ä¾‹å­æé—®ï¼šä½ ä¼šå¦‚ä½•**ç ´ä¸€æ¡**ï¼Ÿ
2. **æ´»é”æ¼”ç¤º 6 åˆ†é’Ÿ**ï¼šä¸¤åå­¦ç”Ÿè§’è‰²æ‰®æ¼”â€œæ‹¿ä¸åˆ°å°±æ”¾æ‰‹â€çš„ç­–ç•¥ï¼Œå®žæ¼” 3 è½®ï¼Œä½“ä¼šâ€œå¿™ã€ä½†æ²¡å‰è¿›â€ã€‚
3. **ä¸‰ç§å¤„ç†æ€è·¯ 10 åˆ†é’Ÿ**ï¼š

   * **é¸µé¸Ÿ**ï¼šä½•æ—¶å¯æŽ¥å—ï¼Ÿï¼ˆæ¡Œé¢/ç§»åŠ¨ç«¯ï¼‰é£Žé™©ï¼Ÿ
   * **æ£€æµ‹+æ¢å¤**ï¼šç”» RAGã€æ‰¾çŽ¯ã€é€‰æ‹©â€œç‰ºç‰²è€…â€ï¼ˆkill/rollback/æ’¤é”€é”ï¼‰ã€‚
   * **è®¾è®¡æ—¶é¢„é˜²**ï¼šèµ„æºæŽ’åºã€è¶…æ—¶+é€€é¿ã€è¯»å†™åˆ†ç¦»ã€åªè¯»å…±äº«ã€‚
4. **å°ç»ƒä¹ **ï¼šç»™ä¸€å¼ æ–‡ä»¶-è¿›ç¨‹å›¾ï¼Œå­¦ç”Ÿæ‰‹ç®—æ˜¯å¦æœ‰çŽ¯ï¼›è‹¥æœ‰ï¼Œæå‡ºä¸€ç§â€œæ¢å¤åŠ¨ä½œâ€ã€‚

---

## ä½œä¸š/å®žéªŒå»ºè®®

* **å®žçŽ°**ï¼š
  1ï¼‰RAG çš„ DFS/ä¸‰è‰²æ ‡è®°æ‰¾çŽ¯ï¼›
  2ï¼‰ä¸€ä¸ªâ€œæ´»é”æ¨¡æ‹Ÿå™¨â€ï¼ˆä¸¤ä¸ªçº¿ç¨‹åå¤è®©è·¯ï¼‰ï¼ŒåŠ å…¥**éšæœºé€€é¿**è§‚å¯Ÿæ´»é”æ¶ˆå¤±ã€‚
* **å†™ä½œ**ï¼šé€‰ä¸€ä¸ªç³»ç»Ÿï¼ˆæ•°æ®åº“/å¾®æœåŠ¡/æ“ä½œç³»ç»Ÿï¼‰åˆ†æžå®ƒå¦‚ä½•åˆ†åˆ«ï¼š**å¿½ç•¥ã€æ£€æµ‹ã€æ¢å¤**æ­»é”ã€‚

---

## æ˜“é”™ç‚¹æé†’

* **æ´»é”â‰ æ­»é”**ï¼šæ´»é”â€œå¿™ä½†æ— è¿›å±•â€ï¼Œæ­»é”â€œå¡ä¸”ä¸åŠ¨â€ï¼›æ£€æµ‹æ–¹æ³•ä¸Žä¿¡å·ä¸åŒã€‚
* **â€œçœ‹åˆ°çŽ¯=ä¸€å®šæ­»é”ï¼Ÿâ€**ï¼šä¸ä¸€å®šï¼ˆå¯èƒ½æœ‰æŠ¢å /å›žæ»š/è¶…æ—¶ï¼‰ï¼›ä½†å››æ¡ä»¶å…¨åœ¨ â‡’ å­˜åœ¨éžé›¶æ¦‚çŽ‡å¡æ­»ã€‚
* **Rice å®šç†ç±»æ¯”**ï¼šåˆ«è¯´â€œé™æ€æ–¹æ³•ä¸€å®šèƒ½æœç»æ‰€æœ‰æ­»é”â€ï¼Œåœ¨é€šç”¨çŽ¯å¢ƒå¾€å¾€åšä¸åˆ°ã€‚

éœ€è¦æˆ‘æŠŠ**ç»ƒä¹ é¢˜+ç­”æ¡ˆ**æˆ–**è¯¾å ‚è®²ä¹‰ PDF**æ•´ç†å‡ºæ¥å—ï¼Ÿæˆ‘å¯ä»¥ç›´æŽ¥ç»™ä½ å¯æ‰“å°ç‰ˆã€‚


---

## ç¬¬ 200 é¡µ

![ç¬¬ 200 é¡µ](main_chapter8_assets/page-200.png)

**æé—®ï¼š** å¯¹æˆªå›¾ä¸­çš„å†…å®¹é€å¥è¯¦ç»†ä½¿ç”¨ä¸­æ–‡è§£é‡Šï¼Œä¸ä»…ä»…åªæ˜¯ç¿»è¯‘ï¼Œè¿˜éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œé€‚å½“çš„è§£é‡Š,å‘Šè¯‰æˆ‘è¯¥æ€Žä¹ˆæ•™å­¦ç”Ÿå¹¶ä¸”æŒ‡å¯¼æ€Žä¹ˆåš

ä¸‹é¢å¼€å§‹é€å¥è®²è§£æœ¬é¡µå†…å®¹ï¼Œå¹¶ç»“åˆæ•™å­¦æ€Žä¹ˆè®²ã€æ€Žä¹ˆå¼•å¯¼å­¦ç”Ÿç†è§£ã€‚æœ¬é¡µåˆ†ä¸ºä¸¤éƒ¨åˆ†å†…å®¹ï¼š

âœ… **ï¼ˆä¸ŠåŠï¼‰ç»§ç»­è§£é‡Šæ´»é”ä¸Žé¢„é˜²**
âœ… **ï¼ˆä¸‹åŠï¼‰è¿›å…¥ç»å…¸é—®é¢˜ï¼šå“²å­¦å®¶è¿›é¤é—®é¢˜ï¼ˆDining Philosophersï¼‰** â€”â€” æ­»é”æ•™å­¦ä¸­çš„é‡å¤´æˆã€‚

---

## ðŸ”¹ ç¬¬ä¸€éƒ¨åˆ†ï¼šæ´»é”è¡¥å…… + Bankerâ€™s Algorithm å¼•å‡º

> **â€¦we could reach a livelock scenario if we preempt a set of resources again and again.**

* **ç¿»è¯‘**ï¼šå¦‚æžœæˆ‘ä»¬ä¸æ–­åœ°æŠ¢å åŒä¸€ç»„èµ„æºï¼Œç³»ç»Ÿå¯èƒ½è¿›å…¥**æ´»é”**ã€‚
* **è§£é‡Š**ï¼šåå¤æŠ¢èµ„æº â†’ æ‰€æœ‰è¿›ç¨‹éƒ½åœ¨â€œå¿™ç€é‡æ–°å°è¯•â€ â†’ æ²¡æœ‰è¿›å±•ï¼Œä½†ç³»ç»Ÿæ²¡æœ‰å®Œå…¨å¡æ­»ã€‚
* **æ•™å­¦æç¤º**ï¼šä¸¾ TCP ç½‘ç»œé€€é¿ç®—æ³•ä¾‹å­ï¼Œä¸¤ç«¯åŒæ—¶é‡è¯•å°±æ´»é”ã€‚

---

> **The operating system chooses a random resource to break hold-and-wait.**

* **ç¿»è¯‘**ï¼šæ“ä½œç³»ç»Ÿå¸¸ç”¨**éšæœºæ€§**æ¥æ‰“ç ´â€œå æœ‰å¹¶ç­‰å¾…ï¼ˆHold and Waitï¼‰â€ã€‚
* **è§£é‡Š**ï¼šè¿™æ˜¯é¿å…æ´»é”çš„å¸¸è§åšæ³•ï¼šåˆ«æ€»æŠ¢åŒä¸€ä¸ªï¼Œéšæœºé€€é¿é¿å…å¾ªçŽ¯å¡ä½ã€‚

---

> **â€¦this doesnâ€™t happen as often on machines that run programs in practice or the livelock that does happen happens for a couple of cycles.**

* **ç¿»è¯‘**ï¼šåœ¨å®žé™…ç³»ç»Ÿä¸­ï¼Œæ´»é”é€šå¸¸æŒç»­æ—¶é—´å¾ˆçŸ­ï¼ŒåªæŒç»­å‡ ä¸ªå¾ªçŽ¯åŽå°±ä¼šè§£é™¤ã€‚
* **æ•™å­¦è§£é‡Š**ï¼šéšæœºé€€é¿ã€è°ƒåº¦åˆ‡æ¢ä¼šå¸®åŠ©ç³»ç»Ÿè·³å‡ºæ´»é”ã€‚

---

> **These systems are good for products that need to maintain a non-deadlocked state but can tolerate a small chance of livelock for a short time.**

* **ç¿»è¯‘**ï¼šè¿™ç§ç³»ç»Ÿé€‚ç”¨äºŽéœ€è¦å°½é‡é¿å…æ­»é”ã€ä½†å¯ä»¥å®¹å¿**çŸ­æ—¶é—´æ´»é”**çš„äº§å“ã€‚
* **ä¾‹å­**ï¼šæ— çº¿ç½‘ç»œã€æ•°æ®åº“è‡ªæ—‹é”ã€å¹¶å‘å“ˆå¸Œè¡¨ã€‚

---

> **In addition, we have the Bankerâ€™s Algorithm. The basic premise is the bank never runs dry, which prevents livelock.**

* **ç¿»è¯‘**ï¼šè¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯**é“¶è¡Œå®¶ç®—æ³•**ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**é“¶è¡Œæ°¸è¿œä¸ä¼šæŠŠé’±å€Ÿå…‰**ï¼ˆç³»ç»Ÿæ°¸è¿œä¸è¿›å…¥ä¸å®‰å…¨çŠ¶æ€ï¼‰ï¼Œä»Žè€Œé¿å…æ­»é”ç”šè‡³æ´»é”ã€‚
* **æ•™å­¦æç¤º**ï¼šå‘Šè¯‰å­¦ç”Ÿï¼šé“¶è¡Œå®¶ç®—æ³•æ˜¯ **å®‰å…¨èµ„æºåˆ†é…ç®—æ³•**ï¼Œä¼šåœ¨è¯·æ±‚èµ„æºå‰åˆ¤æ–­**å®‰å…¨çŠ¶æ€**ã€‚

---

---

## ðŸ”¹ ç¬¬äºŒéƒ¨åˆ†ï¼š8.4 å“²å­¦å®¶è¿›é¤é—®é¢˜ï¼ˆDining Philosophers Problemï¼‰

> **The Dining Philosophers problem is a classic synchronization problem.**

* **ç¿»è¯‘**ï¼šå“²å­¦å®¶è¿›é¤é—®é¢˜æ˜¯ç»å…¸çš„åŒæ­¥é—®é¢˜ã€‚
* **è®²è§£æ–¹å‘**ï¼šæœ¬é—®é¢˜ç”¨äºŽè¯´æ˜Ž**æ­»é”ã€é¥¥é¥¿ã€å¹¶å‘å†²çª**ã€‚

---

> **Imagine we invite n (letâ€™s say 6) philosophers to a mealâ€¦**

* **ç¿»è¯‘**ï¼šå‡è®¾æœ‰ 6 ä½å“²å­¦å®¶å›´ååƒé¥­ï¼Œæ¯äººå·¦å³å„ä¸€æ ¹ç­·å­ï¼ˆèµ„æºï¼‰ã€‚

---

> **A philosopher alternates between wanting to eat or think.**

* **è§£é‡Š**ï¼šå“²å­¦å®¶ = **è¿›ç¨‹**ï¼Œç­·å­ = **èµ„æº**ã€‚

---

> **To eat the philosopher must pick up the two chopsticks either side of their positionâ€¦**

* **è§£é‡Š**ï¼šæ¯æ¬¡æƒ³åƒé¥­å¿…é¡»åŒæ—¶å¾—åˆ°**ä¸¤ä¸ªèµ„æº** â†’ å…·æœ‰**èµ„æºç«žäº‰**ï¼Œå­˜åœ¨**æ­»é”é£Žé™©**ã€‚

---

> **However, these chopsticks are shared with his neighbor.**

* **è§£é‡Š**ï¼šæ¯æ ¹ç­·å­åªèƒ½è¢«ä¸€äººç”¨ï¼ˆ**äº’æ–¥æ¡ä»¶**æ»¡è¶³ï¼‰ï¼Œæ­»é”å¯èƒ½å‘ç”Ÿã€‚

---

### âœ… å›¾è§£ï¼ˆFigure 8.3ï¼‰

å›¾ä¸­è¦è®©å­¦ç”Ÿç†è§£ï¼š

* æ¤­åœ† = å“²å­¦å®¶ï¼ˆè¿›ç¨‹ï¼‰
* æ£’çŠ¶èµ„æº = ç­·å­ï¼ˆèµ„æºï¼‰
* å…¸åž‹èµ„æºäº‰ç”¨ç»“æž„ï¼š**çŽ¯å½¢èµ„æºåˆ†é…å›¾**

---

> **Is it possible to design an efficient solution such that all philosophers get to eat? Or will some philosophers starve? Or will all of them deadlock?**

* **å¼•å¯¼æ•™å­¦é—®é¢˜**ï¼š

  * ä¼šä¸ä¼šæœ‰äºº**é¥¿æ­»**ï¼ˆStarvationï¼‰ï¼Ÿ
  * ä¼šä¸ä¼š**å…¨éƒ¨æ­»é”**ï¼Ÿ
  * æœ‰æ²¡æœ‰ç­–ç•¥è®©å¤§å®¶**å…¬å¹³è¿›é¤**ï¼Ÿ

---

> **For example, imagine each guest picks up the chopstick on their left and then waits for the chopstick on their rightâ€¦ philosophers have deadlocked!**

* **è§£é‡Š**ï¼šå…¸åž‹æ­»é”åœºæ™¯ï¼š**å¤§å®¶ä¸€èµ·å·¦æ‰‹å…ˆæ‹¿ â†’ ç­‰å¾…å³è¾¹ â†’ çŽ¯å½¢ç­‰å¾… â†’ æ­»é”**ã€‚
* **è®©å­¦ç”Ÿç”» RAG**ï¼š
  `P1 â†’ R1 â†’ P2 â†’ R2 â†’ â€¦ â†’ P6 â†’ R6 â†’ P1` âœ… **å‡ºçŽ°çŽ¯ï¼**

---

> **Each philosopher is essentially the sameâ€¦ canâ€™t tell every even philosopher to do one thing and every odd philosopher to do another thing.**

* **è§£é‡Š**ï¼šæ‰€æœ‰å“²å­¦å®¶ä»£ç ä¸€æ ·ï¼ˆç§°ä¸º**å¯¹ç§°æ€§**é—®é¢˜ï¼‰ï¼Œä¸èƒ½é ç¡¬ç¼–ç â€œè§„å®šå¥‡æ•°å…ˆæ‹¿å·¦ã€å¶æ•°å…ˆæ‹¿å³â€ï¼Œéœ€è¦**é€šç”¨è§£å†³æ–¹æ¡ˆ**ã€‚

---

---

## âœ… æ€Žä¹ˆè®²è¿™ä¸€èŠ‚ï¼ˆæ•™å­¦å»ºè®®ï¼‰

### âœ¨ è¯¾å ‚è®²è§£ç»“æž„

| æ­¥éª¤  | å†…å®¹    | æ•™å­¦æ–¹æ³•               |
| --- | ----- | ------------------ |
| ç¬¬ä¸€æ­¥ | å¼•å‡ºé—®é¢˜  | è®²å“²å­¦å®¶æ•…äº‹æ¿€å‘å…´è¶£         |
| ç¬¬äºŒæ­¥ | å»ºç«‹æ¨¡åž‹  | ç”»å‡ºè¿›ç¨‹ä¸Žèµ„æºå…³ç³»          |
| ç¬¬ä¸‰æ­¥ | å‘çŽ°é—®é¢˜  | è®©å­¦ç”Ÿæ‰¾å‡ºæ­»é”            |
| ç¬¬å››æ­¥ | å¼•å‡ºå››æ¡ä»¶ | å¯¹ç…§å››æ¡ä»¶è¯æ˜Žæ­»é”å¯å‘ç”Ÿ       |
| ç¬¬äº”æ­¥ | è¿‡æ¸¡    | è¿›å…¥ 8.4.1 â€œå¤±è´¥çš„è§£æ³•â€åˆ†æž |

---

### ðŸŽ“ å­¦ç”Ÿæ´»åŠ¨ç¤ºä¾‹

è®©å­¦ç”Ÿæ‰®æ¼”å“²å­¦å®¶ï¼š

* 6 ä¸ªå­¦ç”Ÿç»„æˆä¸€åœˆï¼Œæ¯äººç”¨ä¸¤æ”¯ç¬”æ¨¡æ‹Ÿä¸¤æ”¯ç­·å­ã€‚
* æ¨¡æ‹Ÿâ€œå…ˆæ‹¿å·¦å†æ‹¿å³â€ç­–ç•¥ â†’ å…¨ä½“åœä½ â†’ æ­»é”æ¼”ç¤ºå®Œæˆ âœ…
* è®¨è®ºï¼šæœ‰æ²¡æœ‰åŠžæ³•é¿å…ï¼Ÿ

---

âœ… å¦‚æžœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ç»§ç»­**é€å¥è§£é‡Šä¸‹ä¸€é¡µ 8.4.1 Failed Solutions**ï¼Œå¹¶å¸®ä½ åˆ†æžæºç é€»è¾‘ + æé†’è¯¾å ‚é‡ç‚¹
â€”â€”ç»§ç»­å—ï¼ŸðŸ‘¨â€ðŸ«


---

## ç¬¬ 201 é¡µ

![ç¬¬ 201 é¡µ](main_chapter8_assets/page-201.png)

**æé—®ï¼š** å¯¹æˆªå›¾ä¸­çš„å†…å®¹é€å¥è¯¦ç»†ä½¿ç”¨ä¸­æ–‡è§£é‡Šï¼Œä¸ä»…ä»…åªæ˜¯ç¿»è¯‘ï¼Œè¿˜éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œé€‚å½“çš„è§£é‡Š,å‘Šè¯‰æˆ‘è¯¥æ€Žä¹ˆæ•™å­¦ç”Ÿå¹¶ä¸”æŒ‡å¯¼æ€Žä¹ˆåš

å¤ªæ£’äº†ï¼Œè¿™ä¸€é¡µæ­£å¥½æŠŠâ€œå¤±è´¥çš„è§£æ³• â†’ ä¸ºä»€ä¹ˆä¼šæ­»é”/é¥¥é¥¿ â†’ è¯•å›¾æ‰“ç ´ Coffman æ¡ä»¶ï¼ˆHold & Waitï¼‰â†’ ä½†ä¼šå¼•å‡ºæ´»é”â€çš„æ•™å­¦é“¾æ¡ä¸²èµ·æ¥ã€‚ä¸‹é¢æˆ‘**é€å¥/é€è¡Œ**è§£é‡Šå¹¶ç»™å‡º**è¯¾å ‚è®²æ³•ä¸Žç»ƒä¹ å»ºè®®**ã€‚

---

# ä¸€ã€ç¬¬ä¸€æ®µä»£ç ï¼ˆâ€œçœ‹ä¼¼åˆç†â€çš„å¤±è´¥æ–¹æ¡ˆï¼‰

```c
pthread_mutex_t* left_fork  = phil_info->left_fork;
pthread_mutex_t* right_fork = phil_info->right_fork;
while (phil_info->simulation){
    pthread_mutex_lock(left_fork);
    pthread_mutex_lock(right_fork);
    eat(left_fork, right_fork);
    pthread_mutex_unlock(left_fork);
    pthread_mutex_unlock(right_fork);
}
```

* `left_fork/right_fork`ï¼š
  **ç¿»è¯‘**ï¼šä»Žçº¿ç¨‹ç§æœ‰çš„ `phil_info` ç»“æž„é‡Œå–å‡ºå·¦å³ä¸¤æŠŠâ€œå‰å­â€çš„äº’æ–¥é‡åœ°å€ã€‚
  **è§£é‡Š**ï¼šæ¯ä½å“²å­¦å®¶ï¼ˆçº¿ç¨‹ï¼‰çŸ¥é“è‡ªå·±å·¦å³çš„ä¸¤ä¸ªèµ„æºï¼ˆäº’æ–¥é”ï¼‰ã€‚
  **æ•™å­¦æç¤º**ï¼šå…ˆè®©å­¦ç”ŸæŠŠæ¡Œå­ç”»å‡ºæ¥ï¼Œæ ‡æ¸…â€œP\[i] å·¦é” = F\[i]ï¼Œå³é” = F\[(i+1) mod n]â€ã€‚

* `while (phil_info->simulation)`ï¼š
  **è¯‘**ï¼šåªè¦æ¨¡æ‹Ÿè¿˜åœ¨è¿è¡Œï¼Œå°±æŒç»­å°è¯•â€œåƒé¥­â€ã€‚
  **æ•™**ï¼šå¼ºè°ƒï¼šå¾ªçŽ¯é‡Œå¿…é¡»**éµå¾ªæŸç§é”é¡ºåºç­–ç•¥**ï¼Œå¦åˆ™é£Žé™©å¾ˆå¤§ã€‚

* `pthread_mutex_lock(left_fork); pthread_mutex_lock(right_fork);`
  **è¯‘**ï¼šå…ˆé”å·¦å‰ï¼Œå†é”å³å‰ã€‚
  **è§£é‡Š**ï¼šè¿™æ˜¯æœ€æœ´ç´ ã€æœ€å¸¸è§çš„å†™æ³•ï¼›**ä¸€æ—¦å¤§å®¶éƒ½å…ˆé”å·¦**ï¼Œå°±å¯èƒ½**å½¢æˆçŽ¯å½¢ç­‰å¾…**ã€‚
  **æ¿ä¹¦ RAG**ï¼š`F[i] â†’ P[i]`ï¼ˆå·²å æœ‰ï¼‰ï¼ŒåŒæ—¶ `P[i] â†’ F[i+1]`ï¼ˆè¯·æ±‚ä¸­ï¼‰â‡’ å‡ºçŽ°é•¿åº¦ä¸º n çš„æœ‰å‘çŽ¯ã€‚

* `eat(...);`
  **è¯‘**ï¼šä¸¤æŠŠéƒ½æ‹¿åˆ°æ‰è¿›é¤ã€‚
  **è§£é‡Š**ï¼šåƒé¥­æœŸé—´ä¿æŒä¸¤æŠŠé”ï¼ˆæŒæœ‰å¹¶ç­‰å¾…ä¸‹ä¸€è½®ï¼‰ã€‚

* `pthread_mutex_unlock(...)`
  **è¯‘**ï¼šæŒ‰æŸé¡ºåºé‡Šæ”¾é”ã€‚
  **è§£é‡Š**ï¼šé‡Šæ”¾é¡ºåºå¯¹**æœ¬è½®**å½±å“ä¸å¤§ï¼Œé—®é¢˜å‡ºåœ¨**åŠ é”é¡ºåº**ã€‚

---

## å›¾ä¸‹æ–‡å­—è§£é‡Š

> **This looks good but. What if everyone picks up their left fork and is waiting on their right fork? We have deadlocked the program.**

* **ç¿»è¯‘**ï¼šçœ‹èµ·æ¥æ²¡é—®é¢˜ï¼Œä½†å¦‚æžœæ¯ä¸ªäººéƒ½å…ˆæ‹¿å·¦è¾¹ã€å†ç­‰å³è¾¹ï¼Œå°±**æ­»é”**äº†ã€‚
* **æ•™å­¦åšæ³•**ï¼š6 ä¸ªå­¦ç”Ÿå›´æˆä¸€åœˆæ¼”ç¤ºï¼šç»Ÿä¸€å£ä»¤â€œæ‹¿å·¦è¾¹â€ï¼Œç«‹åˆ»å¡ä½ã€‚

> **â€¦deadlock doesnâ€™t happen all the time and the probability â€¦ goes down as the number of philosophers goes up.**

* **ç¿»è¯‘**ï¼šå¹¶éžæ¯æ¬¡éƒ½ä¼šæ­»é”ï¼›å“²å­¦å®¶äººæ•°è¶Šå¤šï¼Œâ€œå…¨éƒ¨åŒæ—¶å·¦é”æˆåŠŸâ€çš„æ¦‚çŽ‡è¶Šä½Žã€‚
* **è§£é‡Š**ï¼šå¹¶å‘çš„å…·ä½“æ—¶åºå—è°ƒåº¦ä¸Žéšæœºæ‰°åŠ¨å½±å“ï¼›äººæ•°å¤šæ—¶â€œå®Œå…¨åŒæ­¥æ’žè½¦â€çš„æœºä¼šæ›´å°ï¼ˆä½†**å¯èƒ½æ€§ä»åœ¨**ï¼‰ã€‚

> **â€¦eventually this solution will deadlock, letting threads starve which is bad.**

* **ç¿»è¯‘**ï¼šä½†**æœ€ç»ˆ**åœ¨æŸæ¬¡æ—¶åºé‡Œè¿˜æ˜¯å¯èƒ½æ­»é”ï¼Œé€ æˆ**çº¿ç¨‹é¥¥é¥¿**ï¼ˆæ— æ³•ç»§ç»­ï¼‰â€”â€”ä¸å¯æŽ¥å—ã€‚
* **æ•™å­¦ç»“è®º**ï¼š**æœ´ç´ çš„â€œå…ˆå·¦åŽå³â€æ–¹æ¡ˆä¸å®‰å…¨**ã€‚

> **Figure 8.4ï¼šLeft right dining philosopher cycle**

* **è§£è¯»**ï¼šä¸‰å¹…ç®€å›¾å±•ç¤ºä»Žâ€œé€æ­¥æŒæœ‰å·¦å‰ â†’ å…¨ä½“ç­‰å¾…å³å‰ â†’ æˆçŽ¯å¡æ­»â€çš„æ¼”åŒ–ã€‚
* **è¯¾å ‚**ï¼šè®©å­¦ç”Ÿç”¨ RAG æŠŠè¿™ä¸‰æ­¥ç”»æˆï¼š
  1ï¼‰`F[i] â†’ P[i]`ï¼›2ï¼‰å†åŠ  `P[i] â†’ F[i+1]`ï¼›3ï¼‰çœ‹åˆ°**é—­çŽ¯**ã€‚

---

# äºŒã€æ‰“ç ´ Coffman æ¡ä»¶ä¹‹ä¸€ï¼š**ç ´ â€œHold & Waitï¼ˆå æœ‰å¹¶ç­‰å¾…ï¼‰â€**

> **So now you are thinking about breaking one of the Coffman Conditions. Letâ€™s break Hold and Wait!**

* **ç¿»è¯‘**ï¼šæˆ‘ä»¬è¯•ç€**ç ´å**å››æ¡ä»¶ä¹‹ä¸€â€”â€”**å æœ‰å¹¶ç­‰å¾…**ã€‚
* **æ€è·¯**ï¼š**æ‹¿ä¸åˆ°ç¬¬äºŒæŠŠæ—¶ï¼Œå¿…é¡»æ”¾æŽ‰ç¬¬ä¸€æŠŠ**ï¼Œé¿å…â€œæ‰‹é‡Œæ”¥ç€è¿˜ç­‰â€ã€‚

---

## ç¬¬äºŒæ®µä»£ç ï¼ˆä½¿ç”¨ `trylock` + æ”¾æ‰‹é‡è¯•ï¼‰

```c
void* philosopher(void* forks){
    info phil_info = forks;
    pthread_mutex_t* left_fork  = phil_info->left_fork;
    pthread_mutex_t* right_fork = phil_info->right_fork;

    while (phil_info->simulation){
        int left_succeed = pthread_mutex_trylock(left_fork);
        if (!left_succeed) {
            sleep();
            continue;
        }

        int right_succeed = pthread_mutex_trylock(right_fork);
        if (!right_succeed) {
            pthread_mutex_unlock(left_fork);
            sleep();
            continue;
        }

        eat(left_fork, right_fork);
        pthread_mutex_unlock(left_fork);
        pthread_mutex_unlock(right_fork);
    }
}
```

* `pthread_mutex_trylock(left_fork)`ï¼š
  **è¯‘**ï¼šå°è¯•åŠ å·¦é”ï¼Œ**éžé˜»å¡ž**ï¼›å¤±è´¥å°±ç«‹åˆ»è¿”å›žã€‚
  **è§£é‡Š**ï¼šä¸é˜»å¡žå°±ä¸ä¼šâ€œå¡ç€ç­‰â€ï¼Œä»Žè€Œ**ä¸å½¢æˆçŽ¯ä¸Šçš„ç¡¬ç­‰å¾…**ã€‚
  **è¯¾å ‚**ï¼šå¯¹æ¯” `lock` vs `trylock`ï¼šé˜»å¡žç­‰å¾… vs ç«‹å³è¿”å›žã€‚

* `if (!left_succeed) { sleep(); continue; }`
  **è¯‘**ï¼šæ²¡æ‹¿åˆ°å·¦é”å°±**å°ç¡ï¼ˆé€€é¿ï¼‰**å†ä¸‹ä¸€è½®ã€‚
  **è§£é‡Š**ï¼šé€€é¿å‡å°‘**å¿™ç­‰**ï¼›åŠ ä¸€ç‚¹éšæœº sleep è¿˜èƒ½é™ä½Ž**æ´»é”**æ¦‚çŽ‡ã€‚
  **å®žè·µå»ºè®®**ï¼šç”¨ `usleep(rand()%K)` åš**éšæœºé€€é¿**æ¼”ç¤ºæ´»é”â†’æ¶ˆå¤±ã€‚

* `int right_succeed = pthread_mutex_trylock(right_fork);`
  **è¯‘**ï¼šæˆåŠŸæ‹¿åˆ°å·¦åŽï¼Œ**å°è¯•**æ‹¿å³ã€‚
  **æ•™å­¦æé†’**ï¼šè¿™ä¸€æ­¥ä»å¯èƒ½å¤±è´¥ï¼ˆå³è¾¹è¢«é‚»å±…æ‹¿ç€ï¼‰ã€‚

* `if (!right_succeed) { pthread_mutex_unlock(left_fork); sleep(); continue; }`
  **è¯‘**ï¼šè‹¥å³é”å¤±è´¥ï¼Œ**ç«‹åˆ»æ”¾æŽ‰å·¦é”**ï¼Œä¼‘çœ å¹¶é‡æ¥ã€‚
  **å…³é”®ç‚¹**ï¼šè¿™ä¸€æ­¥å°±æ˜¯åœ¨**ç ´å Hold & Wait**ï¼ˆä¸ä¸€è¾¹å æœ‰ä¸€è¾¹ç­‰å¾…ï¼‰ã€‚
  **éšæ‚£**ï¼šå¯èƒ½å‡ºçŽ°**æ´»é”**ï¼ˆå¤§å®¶éƒ½æ‹¿ä¸€ä¸‹åˆæ”¾ã€è°ä¹Ÿåƒä¸åˆ°ï¼‰ã€‚

* æœ«å°¾ `eat`/`unlock`ï¼š
  **è¯‘**ï¼šä¸¤æŠŠéƒ½æˆåŠŸåŽå†åƒï¼Œå¹¶åœ¨ç¦»å¼€å‰é‡Šæ”¾ä¸¤æŠŠã€‚
  **è§£é‡Š**ï¼šæ­¤æ–¹æ¡ˆ**ä¸ä¼šæ­»é”**ï¼›ä½†éœ€è¦**è¯„ä¼°é¥¥é¥¿/æ´»é”**é£Žé™©ã€‚

---

## è¿™ä¸€é¡µè¦ç‚¹å°ç»“ï¼ˆè®²ç»™å­¦ç”Ÿï¼‰

1. æœ´ç´ â€œå…ˆå·¦å†å³â€**å¯èƒ½æ­»é”**ã€‚
2. ç”¨ `trylock` + å¤±è´¥å°±æ”¾æ‰‹ **å¯ç ´å Hold & Wait**ï¼Œ**æœç»æ­»é”**ã€‚
3. ä½†æ˜¯ï¼š**æ´»é”/é¥¥é¥¿**å¯èƒ½å‡ºçŽ° â€”â€” éœ€è¦**é€€é¿ã€éšæœºåŒ–ã€é™æµæˆ–ä»²è£**ç­‰æ‰‹æ®µæ”¹å–„ã€‚

---

# ä¸‰ã€è¯¾å ‚æ€Žä¹ˆè®² & æŒ‡å¯¼å­¦ç”Ÿæ€Žä¹ˆåš

### A. é»‘æ¿/æŠ•å½±æ­¥éª¤ï¼ˆ10â€“12 åˆ†é’Ÿï¼‰

1. **ç”»åœ†æ¡Œ**ï¼ˆ6 äººã€6 æŠŠå‰ï¼‰â†’ æ ‡æ³¨ `P[i]`ã€`F[i]`ã€‚
2. **èµ°ä¸€éâ€œå…ˆå·¦åŽå³â€** â†’ è®© 6 ä½åŒå­¦è¡¨æ¼”ï¼ˆæ¯äººä¸¾ä¸€æ”¯é©¬å…‹ç¬”ä»£è¡¨å·¦é”ï¼Œç©ºæ‰‹ç­‰å³é”ï¼‰â†’ å…¨ä½“åœä½ â‡’ **æ­»é”å‡ºçŽ°**ã€‚
3. **æ¿ä¹¦ Figure 8.4 çš„ RAG**ï¼šæŠŠâ€œå æœ‰è¾¹/è¯·æ±‚è¾¹â€ç”»å‡ºï¼Œä¸€ä¸ªç®­åœˆå®Œæˆã€‚
4. **åˆ‡æ¢åˆ° trylock æ–¹æ¡ˆ**ï¼š

   * è®©åŒå­¦æ¼”ç¤ºâ€œæ‹¿ä¸åˆ°å³å°±æ”¾å·¦ + é€€é¿ 1 ç§’â€ï¼Œè¿žç»­æ¼”ä¸¤è½®ï¼›
   * å†åŠ å…¥**éšæœºé€€é¿**ï¼ˆæŠ½ç­¾ 200â€“700msï¼‰ï¼Œè§‚å¯Ÿé€šå¸¸å¾ˆå¿«æœ‰äººåƒåˆ°é¥­ â‡’ **æ´»é”æ¦‚çŽ‡ä¸‹é™**ã€‚

### B. å®žéªŒ/ä½œä¸šï¼ˆå¯ç›´æŽ¥å¸ƒç½®ï¼‰

* **å®žéªŒ 1**ï¼šå®žçŽ°ä¸¤ç‰ˆå“²å­¦å®¶ï¼š`lock-lock` ä¸Ž `trylock-release`ã€‚

  * ç»Ÿè®¡ **æ­»é”å‘ç”ŸçŽ‡**ï¼ˆå¡ä½è¶…è¿‡ T ç§’è§†ä¸ºæ­»é”ï¼‰ä¸Ž **åžåé‡**ï¼ˆå•ä½æ—¶é—´ `eat()` æ¬¡æ•°ï¼‰ã€‚
  * åŠ å…¥ **éšæœºé€€é¿**ï¼Œæ¯”è¾ƒåžåä¸Žæ´»æ€§å˜åŒ–ã€‚
* **å®žéªŒ 2**ï¼ˆè¿›é˜¶ï¼‰ï¼šåŠ å…¥**å…¨å±€èµ„æºæŽ’åº**æˆ–**æœåŠ¡å‘˜ï¼ˆwaiterï¼‰/ä¿¡å·é‡é™æµ**ï¼ˆæœ€å¤šå…è®¸ n-1 äººå°è¯•ï¼‰ï¼Œè¯æ˜Ž**æ— æ­»é”**ä¸”**é¥¥é¥¿å—æŽ§**ã€‚
* **å®žéªŒ 3**ï¼šæ¨¡æ‹Ÿ**æ´»é”**ï¼šæ‰€æœ‰çº¿ç¨‹åŒæ­¥ `trylock` â†’ å¤±è´¥å³åŒæ—¶æ”¾ï¼›ç„¶åŽåŠ å…¥éšæœºæŠ–åŠ¨ï¼Œçœ‹æ´»é”å¦‚ä½•æ¶ˆå¤±ã€‚

### C. è®¨è®ºé¢˜ï¼ˆ5 åˆ†é’Ÿï¼‰

* ä»…é  `trylock+é€€é¿` æ˜¯å¦å¯èƒ½**é•¿æœŸé¥¥é¥¿**ï¼Ÿå¦‚ä½•ç¼“è§£ï¼ˆéšæœºé€€é¿ã€æŒ‡æ•°é€€é¿ã€æŽ’é˜Ÿã€å…¬å¹³é”ã€ä»¤ç‰Œ/æœåŠ¡å‘˜ï¼‰ï¼Ÿ
* ä¸Ž**é“¶è¡Œå®¶ç®—æ³•**ç›¸æ¯”ï¼Œè¿™ç§å±€éƒ¨ç­–ç•¥çš„ä¼˜ç¼ºç‚¹ï¼Ÿ

---

## å››ã€å¯æ›¿ä»£çš„â€œæ›´ç¨³â€çš„æ–¹æ¡ˆï¼ˆå¯ä½œä¸ºä¸‹ä¸€é¡µé¢„å‘Šï¼‰

* **å…¨å±€é¡ºåºæ³•ï¼ˆèµ„æºå±‚çº§ï¼‰**ï¼šç»™å‰å­ç¼–å·ï¼Œ**åªå…è®¸æŒ‰ç¼–å·é€’å¢žåŠ é”** â‡’ æ‰“æŽ‰â€œå¾ªçŽ¯ç­‰å¾…â€ã€‚
* **ä»²è£è€…/æœåŠ¡å‘˜ï¼ˆWaiter/Butlerï¼‰**ï¼šä¸€ä¸ªä¸­å¤®è¿›ç¨‹æŽ§åˆ¶è®¸å¯ï¼ˆä¾‹å¦‚åªå…è®¸æœ€å¤š `n-1` ä¸ªåŒæ—¶æ‹¿èµ·å·¦å‰ï¼‰ã€‚
* **å¥‡å¶éžå¯¹ç§°**ï¼šå¥‡æ•°å…ˆæ‹¿å·¦ã€å¶æ•°å…ˆæ‹¿å³ï¼ˆ**æ‰“ç ´å¯¹ç§°æ€§**ï¼‰ï¼Œä½†è¦è®¨è®ºå…¬å¹³æ€§ä¸Žå®žçŽ°å¤æ‚åº¦ã€‚
* **Chandyâ€“Misra**ï¼šæ¶ˆæ¯ä¼ é€’åž‹è§£æ³•ï¼ˆé€‚åˆåˆ†å¸ƒå¼ç‰ˆæœ¬ï¼‰ã€‚

---

## äº”ã€æ˜“é”™/æ˜“æ··æé†’

* **â€œæ— æ­»é” â‰  æ— é¥¥é¥¿â€**ï¼štrylock æ”¾æ‰‹æ–¹æ¡ˆå¸¸è§**é¥¿æ­»/æ´»é”**ï¼›ä¸€å®šè¦è®²**é€€é¿ä¸Žå…¬å¹³**ã€‚
* **åªæ”¹é‡Šæ”¾é¡ºåºâ‰ è§£å†³**ï¼šå…³é”®æ˜¯**åŠ é”é¡ºåº**ä¸Ž**æ˜¯å¦å æœ‰å¹¶ç­‰å¾…**ã€‚
* **åŒæ­¥åŽŸè¯­çš„é€‰æ‹©**ï¼š`pthread_mutex_lock` ä¼šé˜»å¡žï¼›`trylock` ç«‹å³è¿”å›žã€‚ä¸¤è€…æ€§è´¨ä¸åŒï¼Œè¯„ä¼° CPU å ç”¨ä¸Žå“åº”æ€§ã€‚

---

å¦‚æžœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥æŠŠ**å®žéªŒéª¨æž¶ä»£ç ï¼ˆC/Pthread æˆ– Python çº¿ç¨‹ï¼‰**ã€**æ•°æ®è®°å½•è„šæœ¬**å’Œ**è®²ä¹‰ä¸€é¡µçº¸**æ•´ç†å‡ºæ¥ï¼Œç›´æŽ¥æ‹¿åŽ»ä¸Šæœº/è¯¾å ‚ç”¨ã€‚


---

## ç¬¬ 202 é¡µ

![ç¬¬ 202 é¡µ](main_chapter8_assets/page-202.png)

**æé—®ï¼š** å¯¹æˆªå›¾ä¸­çš„å†…å®¹é€å¥è¯¦ç»†ä½¿ç”¨ä¸­æ–‡è§£é‡Šï¼Œä¸ä»…ä»…åªæ˜¯ç¿»è¯‘ï¼Œè¿˜éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œé€‚å½“çš„è§£é‡Š,å‘Šè¯‰æˆ‘è¯¥æ€Žä¹ˆæ•™å­¦ç”Ÿå¹¶ä¸”æŒ‡å¯¼æ€Žä¹ˆåš

ä¸‹é¢è¿™é¡µåˆ†ä¸¤å—å†…å®¹ï¼š
A) ç»§ç»­è§£é‡Šâ€œ**trylock + æ”¾æ‰‹é‡è¯•**â€æ–¹æ¡ˆä¼šå¦‚ä½•**æ¼”åŒ–æˆæ´»é”**ï¼›
B) ç»™å‡º**å¯è¡Œè§£ï¼ˆViable Solutionsï¼‰**â€”â€”â€œä»²è£è€…/æœåŠ¡å‘˜ï¼ˆarbitrator/waiterï¼‰â€æ€è·¯ã€‚
æˆ‘ä¼šé€å¥è¯‘è§£ + æ•™å­¦æ€Žä¹ˆè®² + å­¦ç”Ÿæ€Žä¹ˆåšã€‚

---

# A. æ´»é”æ¼”åŒ–ï¼ˆæ‰¿æŽ¥ä¸Šä¸€é¡µçš„ trylock æ–¹æ¡ˆï¼‰

> ï¼ˆä»£ç æœ«å°¾ï¼‰
>
> ```c
> eat(left_fork, right_fork);
> pthread_mutex_unlock(left_fork);
> pthread_mutex_unlock(right_fork);
> ```

* **è¯‘**ï¼šæ‹¿åˆ°ä¸¤æŠŠå°±åƒï¼Œåƒå®Œé‡Šæ”¾ä¸¤æŠŠã€‚
* **è§£é‡Š**ï¼šè¿™ä¸ªç‰ˆæœ¬**ç ´åäº† Hold & Wait**ï¼ˆæ‹¿ä¸åˆ°å³å°±æ”¾å·¦ï¼‰ï¼Œå› æ­¤**ä¸å‡ºçŽ°æ­»é”**ï¼›ä½†å¯èƒ½å‡ºçŽ°**æ´»é”**ï¼ˆå¤§å®¶åŒæ­¥æ‹¿-æ”¾-å†æ‹¿ï¼Œè°ä¹Ÿåƒä¸åˆ°ï¼‰ã€‚

> **Now our philosopher picks up the left fork and tries to grab the right. If itâ€™s available, they eat. If itâ€™s not available, they put the left fork down and try again. No deadlock!**

* **è¯‘**ï¼šå“²å­¦å®¶å…ˆæ‹¿å·¦ï¼Œå†è¯•å³ï¼›å³å¯ç”¨å°±åƒï¼Œä¸å¯ç”¨å°±æ”¾å·¦å¹¶é‡è¯•ã€‚**ä¸ä¼šæ­»é”ï¼**
* **è®²**ï¼šåœ¨ç™½æ¿ä¸Šé‡ç”³â€œç ´ Hold & Wait â‡’ æ–­çŽ¯â€ã€‚

> **Butâ€¦ What if all the philosophers pick up their left at the same time, try to grab their right, put their left down, pick up their left, try to grab their right and so on.**

* **è¯‘**ï¼šä½†å¦‚æžœ**æ‰€æœ‰äºº**å‡ ä¹ŽåŒæ—¶åšåŒæ ·åŠ¨ä½œï¼ˆæ‹¿å·¦â†’è¯•å³å¤±è´¥â†’æ”¾å·¦â†’å†æ‹¿å·¦â†’å†è¯•å³â€¦ï¼‰å‘¢ï¼Ÿ
* **è§£é‡Š**ï¼šè¿™å°±æ˜¯**æ´»é”ï¼ˆLivelockï¼‰**ï¼šå¤§å®¶éƒ½åœ¨åŠ¨ä½œï¼Œä½†ç³»ç»Ÿ**æ²¡å‰è¿›**ã€‚

> **Here is what a time evolution of the system would look like. (Figure 8.5: Livelock Failure)**

* **è¯‘/è§£**ï¼šå›¾ 8.5 å±•ç¤ºæ—¶é—´æ¼”åŒ–ï¼šå‡ è½®åŒæ­¥â€œæ‹¿-æ”¾-æ‹¿-æ”¾â€¦â€åŽï¼Œä»æ— ä¸€äººåƒåˆ°ã€‚çº¢è‰²å¾ªçŽ¯æ ‡å¿—å¼ºè°ƒ**é™·å…¥æ´»é”**ã€‚
* **è¯¾å ‚æ¼”ç¤º**ï¼šè¯· 6 ååŒå­¦å›´åœˆï¼ŒæŒ‰å£ä»¤åŒæ—¶â€œè¯•æ‹¿å·¦ï¼›è‹¥å³ä¸å¯ç”¨å°±æ”¾å·¦ï¼›åŽŸåœ°æ•° 1 å†è¯•â€ã€‚ä½ ä¼šçœ‹åˆ°**å…¨ä½“èŠ‚æ‹ä¸€è‡´**åœ°åå¤å°è¯•â€”â€”è¿™å°±æ˜¯æ´»é”ã€‚

> **We have now livelocked our solution! Our poor philosophers are still starving, so letâ€™s give them some proper solutions.**

* **è¯‘**ï¼šæ–¹æ¡ˆè½å…¥æ´»é”ï¼Œå“²å­¦å®¶ä»åœ¨**æŒ¨é¥¿**ã€‚éœ€è¦æ›´é è°±çš„è§£æ³•ã€‚
* **è®²**ï¼šæ€»ç»“â€”â€”â€œ**æ— æ­»é” â‰  æœ‰è¿›å±•**â€ã€‚ä¸‹ä¸€èŠ‚ç»™â€œæ­£ç»è§£â€ã€‚

---

# B. 8.5 Viable Solutionsï¼ˆå¯è¡Œè§£ï¼‰

> **The naive arbitrator solution has one arbitrator a mutex for example. Have each of the philosophers ask the arbitrator for permission to eat or trylock an arbitrator mutex. This solution allows one philosopher to eat at a time.**

* **è¯‘**ï¼š**æœ´ç´ ä»²è£è€…**ï¼šè®¾ä¸€ä¸ªâ€œæœåŠ¡å‘˜/ä»²è£è€…â€ï¼Œç”¨ä¸€ä¸ªäº’æ–¥é‡è¡¨ç¤ºè®¸å¯ã€‚æ¯ä½å“²å­¦å®¶åƒé¥­å‰**å…ˆå‘ä»²è£è€…ç”³è¯·**ï¼ˆé”ä½è¿™ä¸ªäº’æ–¥é‡ï¼‰ï¼ŒèŽ·å¾—è®¸å¯è€…è¿›é¤ï¼›åƒå®Œ**é‡Šæ”¾è®¸å¯**ã€‚
* **è§£é‡Š**ï¼šç›¸å½“äºŽ**ä¸²è¡ŒåŒ–**ï¼šä¸€æ¬¡åªå…è®¸ä¸€ä¸ªäººåƒã€‚**å½»åº•æ¶ˆç­å¾ªçŽ¯ç­‰å¾…**ï¼Œå› æ­¤**ä¸æ­»é”**ã€‚
* **è¯¾å ‚æ¿ä¹¦**ï¼š

  * åŽŸæ¥æ˜¯â€œè¿›ç¨‹â†”èµ„æºâ€çŽ¯ï¼›
  * çŽ°åœ¨åŠ ä¸€ä¸ª**ä¸­å¿ƒç‚¹**ï¼ˆArbï¼‰ï¼šæ¯ä¸ªå“²å­¦å®¶å…ˆå‘ Arb ç”³è¯·ï¼Œæ‹¿åˆ°è®¸å¯åŽå†åŽ»æ‹¿å·¦å³å‰ã€‚

> **This prevents deadlock because there is no circular wait! No philosopher has to wait for any other philosopher.**

* **è¯‘/è§£**ï¼šæ²¡æœ‰çŽ¯å½¢ç­‰å¾…ï¼ˆæ‰€æœ‰ç­‰å¾…éƒ½å¯¹**åŒä¸€ä¸ªä»²è£è€…**ï¼‰ï¼Œæ‰€ä»¥ä¸æ­»é”ã€‚
* **è®²**ï¼šæŠŠ Coffman çš„â€œå¾ªçŽ¯ç­‰å¾…â€æ‰“å‰ï¼Œå¼ºè°ƒâ€œç ´ä¸€æ¡å³ä¸æ­»é”â€ã€‚

> **The advanced arbitrator solution is to implement a class that determines if the philosopherâ€™s forks are in the arbitratorâ€™s possession. If they are, they give them to the philosopher, let him eat, and take the forks back. This has the bonus of being able to have multiple philosophers eat at the same time.**

* **è¯‘**ï¼š**è¿›é˜¶ä»²è£è€…**ï¼šä»²è£è€…ç»´æŠ¤**ä¸¤æŠŠå‰æ˜¯å¦éƒ½å¯åˆ†é…**ï¼›è‹¥å¯ç”¨ï¼Œå°±ä¸€æ¬¡æ€§æŠŠä¸¤æŠŠéƒ½â€œäº¤ä»˜â€ç»™å“²å­¦å®¶ï¼›åƒå®Œæ”¶å›žã€‚è¿™æ ·**å¯åŒæ—¶å…è®¸å¤šä¸ª**ä¸å†²çªçš„å“²å­¦å®¶è¿›é¤ï¼ˆä¾‹å¦‚ç›¸éš”çš„äººï¼‰ã€‚
* **è§£é‡Š**ï¼šè¿™ç­‰ä»·äºŽ**é›†ä¸­å¼ä¸¤é˜¶æ®µåˆ†é…**ï¼šå…ˆæ ¸éªŒâ€œå·¦å³å‰å‡ç©ºé—²â€ï¼Œå†åŽŸå­åœ°äº¤ä»˜ã€‚å¸¸è§å®žçŽ°ï¼š**æœåŠ¡å‘˜ + å‰å­æ‹¥æœ‰æƒè¡¨**ã€‚
* **è¯¾å ‚æ¼”ç¤º**ï¼šå®‰æŽ’â€œæœåŠ¡å‘˜â€åŒå­¦ï¼Œæ‰‹æŒä¸€å¼ è¡¨ï¼ˆF1..Fn æ˜¯å¦ç©ºé—²ï¼‰ã€‚åªæœ‰å½“æŸäººçš„ä¸¤æŠŠå‰éƒ½ç©ºé—²æ—¶ï¼ŒæœåŠ¡å‘˜æ‰è¯´â€œå¯ä»¥åƒâ€ï¼Œå¹¶æŠŠè¿™ä¸¤æŠŠæ ‡è®°å¿™ï¼›åƒå®Œå†æ ‡ç©ºã€‚

> **There are a lot of problems with these solutions. One is that they are slow and have a single point of solutions.**

* **åº”ä¸º**ï¼šsingle point of **failure**ï¼ˆæ•™ææ‰“å­—å°ç‘•ç–µï¼‰ã€‚
* **è¯‘**ï¼šè¿™äº›æ–¹æ¡ˆçš„é—®é¢˜ï¼š**æ…¢**ï¼ˆé›†ä¸­ä»²è£å¸¦æ¥ç“¶é¢ˆï¼‰ä¸”å­˜åœ¨**å•ç‚¹å¤±æ•ˆ**ï¼ˆä»²è£è€…æŒ‚äº†ï¼Œç³»ç»Ÿåœæ‘†ï¼‰ã€‚
* **å»¶ä¼¸**ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¼šæ‹…å¿ƒ**å¯ç”¨æ€§**ä¸Ž**å…¬å¹³æ€§**ï¼›éœ€è¦å†—ä½™æˆ–åŽ»ä¸­å¿ƒåŒ–æ”¹é€ ï¼ˆå¦‚ä»¤ç‰ŒçŽ¯ã€åˆ†åŒºä»²è£ç­‰ï¼‰ã€‚

---

## è¯¾å ‚æ€Žä¹ˆè®²ï¼ˆä¸€æ­¥æ­¥è½åœ°ï¼‰

### 1) æ´»é”â†’å¯è¡Œè§£è¿‡æ¸¡ï¼ˆ5 åˆ†é’Ÿï¼‰

* é‡çŽ°æ´»é”æ¼”ç¤ºï¼ˆåŒæ­¥â€œæ‹¿-æ”¾â€ï¼‰ã€‚
* æé—®ï¼š**å¦‚ä½•è®©ä»–ä»¬â€œåˆ«åŒæ—¶åŠ¨ä½œâ€ï¼Ÿ** å¼•å‡ºâ€œæ‰¾ä¸ª**æœåŠ¡å‘˜**æŽ’é˜Ÿå‘è®¸å¯â€ã€‚

### 2) æœ´ç´ ä»²è£è€…ï¼ˆ5â€“7 åˆ†é’Ÿï¼‰

* **æ‰‹åŠ¿æ¨¡æ‹Ÿ**ï¼šåªæœ‰æ‹¿åˆ°â€œæœåŠ¡å‘˜ä»¤ç‰Œâ€çš„äººæ‰èƒ½å°è¯•æ‹¿å‰ï¼›åƒå®ŒæŠŠä»¤ç‰Œç»™ä¸‹ä¸€ä¸ªã€‚
* æ¿ä¹¦ RAGï¼šæ‰€æœ‰è¯·æ±‚ç®­å¤´å…ˆæŒ‡å‘ Arbï¼Œå†ä»Ž Arb æŒ‡å‘ç›¸åº”çš„ä¸¤æŠŠå‰ï¼ˆâ€œè®¸å¯â€å±‚ï¼‰ã€‚
* æŒ‡å‡ºç¼ºç‚¹ï¼šä¸€æ¬¡åªèƒ½ä¸€ä¸ªï¼Œ**åžåä½Ž**ã€‚

### 3) è¿›é˜¶ä»²è£è€…ï¼ˆ7â€“10 åˆ†é’Ÿï¼‰

* **è¡¨æ ¼æ¼”ç¤º**ï¼š`fork_owner[1..n]` å…¨ç©ºæ—¶ï¼Œå¯åŒæ—¶æ‰¹å‡† `P1` ä¸Ž `P4` ç­‰ä¸ç›¸é‚»è€…ã€‚
* å¼ºè°ƒâ€œ**ä¸€æ¬¡æ€§æŽˆäºˆä¸¤æŠŠ**â€é¿å…ä¸­é€”ç­‰å¾…ã€‚
* æé†’ï¼šè¦è€ƒè™‘**å…¬å¹³**ï¼ˆæŽ’é˜Ÿ/è½®è½¬ï¼‰ï¼Œé¿å…é¥¥é¥¿ã€‚

### 4) ä¸Žå…¶å®ƒå¸¸è§â€œå¯è¡Œè§£â€å¯¹æ¯”ï¼ˆ3â€“5 åˆ†é’Ÿï¼‰

* **èµ„æºå…¨åºæ³•**ï¼šç»™å‰ç¼–å·ï¼Œåªèƒ½æŒ‰ç¼–å·é€’å¢žæ‹¿ â†’ ç ´â€œå¾ªçŽ¯ç­‰å¾…â€ï¼Œå®žçŽ°ç®€å•ã€åŽ»ä¸­å¿ƒã€åžåè¾ƒå¥½ã€‚
* **N-1 é™æµæ³•**ï¼šæœ€å¤šå…è®¸ `n-1` äººåŒæ—¶â€œæ‹¿ç¬¬ä¸€æŠŠâ€ â†’ å¿…æœ‰ä¸€äººèƒ½æ‹¿åˆ°ä¸¤æŠŠï¼Œä¸ä¼šå…¨çŽ¯ç­‰ã€‚
* **éšæœºé€€é¿/æŠ–åŠ¨**ï¼šç¼“è§£æ´»é”ä¸Žé¥¥é¥¿ã€‚

---

## å­¦ç”Ÿæ€Žä¹ˆåšï¼ˆå¯ç›´æŽ¥å¸ƒç½®ï¼‰

### å®žéªŒ Aï¼šæ´»é”å¤çŽ°ä¸Žè§£é™¤

1. å®žçŽ° trylock æ”¾æ‰‹æ–¹æ¡ˆï¼ˆæ— éšæœºé€€é¿ï¼‰ã€‚
2. ç»™çº¿ç¨‹è®¾ç½®**ç›¸åŒèŠ‚æ‹**ï¼ˆå¦‚ `usleep(5000)`ï¼‰ï¼Œè§‚å¯Ÿæ´»é”å‘ç”Ÿï¼ˆåžåâ‰ˆ0ï¼‰ã€‚
3. åŠ å…¥**éšæœºé€€é¿**ï¼ˆ0â€“5ms æŠ–åŠ¨ï¼‰ï¼Œè§‚å¯Ÿåžåæ¢å¤ã€‚

### å®žéªŒ Bï¼šæœ´ç´ ä»²è£è€…ï¼ˆå•è®¸å¯ï¼‰

* ç”¨ä¸€ä¸ª `mutex`/`semaphore(1)` ä½œä¸ºæœåŠ¡å‘˜è®¸å¯ã€‚
* åº¦é‡åžåï¼ˆå•ä½æ—¶é—´ `eat()` æ¬¡æ•°ï¼‰ä¸Žå¹³å‡ç­‰å¾…æ—¶é—´ã€‚

### å®žéªŒ Cï¼šè¿›é˜¶ä»²è£è€…ï¼ˆåŒå‰åŽŸå­æŽˆäºˆï¼‰

* ç»´æŠ¤ `available[1..n]`ï¼›åªæœ‰å½“ `available[left] && available[right]` æ—¶æ‰ä¸€æ¬¡æ€§æŽˆäºˆã€‚
* æ”¯æŒ**å¤šä½åŒæ—¶åƒ**ï¼ˆéžç›¸é‚»ï¼‰ã€‚
* åŠ ä¸€ä¸ª**å…¬å¹³é˜Ÿåˆ—**ï¼ˆFIFOï¼‰é¿å…é¥¥é¥¿ï¼Œæˆ–è½®è½¬å‘ç‰Œã€‚

### å®žéªŒ Dï¼ˆå¯¹ç…§ç»„ï¼‰ï¼šèµ„æºå…¨åºæ³•

* å‰å­å…¨å±€ç¼–å·ï¼›å“²å­¦å®¶æ€»æ˜¯å…ˆæ‹¿è¾ƒå°ç¼–å·å†æ‹¿è¾ƒå¤§ç¼–å·ã€‚
* æ¯”è¾ƒåžåã€ç­‰å¾…æ—¶é—´ä¸Žå®žçŽ°å¤æ‚åº¦ã€‚

---

## ä¼ªä»£ç å‚è€ƒï¼ˆä¸Šè¯¾å¯æŠ•å½±ï¼‰

**æœåŠ¡å‘˜ï¼ˆè¿›é˜¶ï¼‰**

```pseudo
waiter_loop:
  while true:
    p = next_request_from_queue()
    if forks_free[left(p)] and forks_free[right(p)]:
       forks_free[left(p)]  = false
       forks_free[right(p)] = false
       grant(p)   // å…è®¸è¿›é¤
    else:
       requeue(p) // æ”¾å›žé˜Ÿå°¾æˆ–éšæœºé€€é¿
```

**å“²å­¦å®¶**

```pseudo
loop:
  request(waiter)
  eat()
  return_forks_to(waiter)
  think()
```

**N-1 é™æµ**

```pseudo
semaphore slots = n-1
loop:
  P(slots)           // è¿›å…¥â€œå°è¯•åŒºâ€çš„åé¢
  lock(min(left,right))
  lock(max(left,right))
  eat()
  unlock(...)
  V(slots)
```

---

## æ˜“é”™ç‚¹ä¸Žè®²è¯„æç¤º

* **å•ç‚¹å¤±æ•ˆ**ï¼šä»²è£è€…æ˜¯ç“¶é¢ˆä¸Ž SPOFï¼Œå¯ç”¨å¤‡ç”¨/ä¸»å¤‡åˆ‡æ¢æˆ–åˆ†ç‰‡ä»²è£ç¼“è§£ã€‚
* **å…¬å¹³æ€§**ï¼šæ²¡æœ‰æŽ’é˜Ÿä¼šå¯¼è‡´é¥¥é¥¿ï¼›åŠ¡å¿…åŠ å…¥ FIFO æˆ–è½®è½¬ã€‚
* **â€œæ— æ­»é”â‰ é«˜åžåâ€**ï¼šæœ´ç´ ä»²è£è€…è™½ç„¶å®‰å…¨ï¼Œä½†åžåå·®ï¼›è¦ç»“åˆåœºæ™¯æƒè¡¡ã€‚
* **æ´»é”ä¸Žé¥¥é¥¿**ï¼štrylock æ”¾æ‰‹æœ¬èº«ä¸æ­»é”ï¼Œä½†è‹¥æ— é€€é¿/éšæœºåŒ–/å…¬å¹³é˜Ÿåˆ—ï¼Œå®¹æ˜“æ´»é”æˆ–é¥¿æ­»ã€‚

---

éœ€è¦çš„è¯ï¼Œæˆ‘å¯ä»¥æŠŠ**å››ç§æ–¹æ¡ˆçš„æ¨¡æ¿ä»£ç ï¼ˆC/Pthreads æˆ– Pythonï¼‰**å’Œ**å®žéªŒè®°å½•è¡¨**æ‰“åŒ…ç»™ä½ ï¼Œç›´æŽ¥ç”¨äºŽè¯¾å ‚/ä¸Šæœºã€‚


---

## ç¬¬ 203 é¡µ

![ç¬¬ 203 é¡µ](main_chapter8_assets/page-203.png)

**æé—®ï¼š** å¯¹æˆªå›¾ä¸­çš„å†…å®¹é€å¥è¯¦ç»†ä½¿ç”¨ä¸­æ–‡è§£é‡Šï¼Œä¸ä»…ä»…åªæ˜¯ç¿»è¯‘ï¼Œè¿˜éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œé€‚å½“çš„è§£é‡Š,å‘Šè¯‰æˆ‘è¯¥æ€Žä¹ˆæ•™å­¦ç”Ÿå¹¶ä¸”æŒ‡å¯¼æ€Žä¹ˆåš

ä¸‹é¢è¿™é¡µåˆ†ä¸‰å—å†…å®¹ï¼š
A) ä»²è£è€…ï¼ˆarbitrator/æœåŠ¡å‘˜ï¼‰æ–¹æ¡ˆçš„æ³¨æ„ç‚¹ä¸Žå…¬å¹³æ€§/æ¶æ„è¿›ç¨‹ï¼›
B) ä¸€ä¸ªç®€çŸ­çš„æ­£ç¡®æ€§è¯æ˜Žï¼ˆä»²è£è€…æ–¹æ¡ˆä¸æ­»é”ï¼‰ï¼›
C) 8.5.1 Stallings çš„â€œç¦»æ¡Œæ³•â€ï¼ˆLeaving the Tableï¼‰æ€è·¯ã€‚
æˆ‘æŒ‰åŽŸæ–‡**é€å¥è§£é‡Š**ï¼Œå¹¶é…ä¸Š**æ€Žä¹ˆè®²ç»™å­¦ç”Ÿå¬**ä¸Ž**è¯¾å ‚å¯åšä»€ä¹ˆ**ã€‚

---

# A. ä»²è£è€…æ–¹æ¡ˆçš„çŽ°å®žé—®é¢˜

> **failure. Assuming that all the philosophers are good-willed, the arbitrator needs to be fair.**

* **è¯‘**ï¼šå³ä¾¿ï¼ˆå•ç‚¹ï¼‰æ•…éšœé—®é¢˜å­˜åœ¨ï¼Œå¦‚æžœå‡è®¾æ‰€æœ‰å“²å­¦å®¶éƒ½â€œå–„æ„â€ï¼Œä»²è£è€…è¿˜éœ€è¦**å…¬å¹³**ã€‚
* **è§£**ï¼šä¸ä»…è¦å®‰å…¨ï¼ˆä¸æ­»é”ï¼‰ï¼Œè¿˜è¦**å…¬å¹³**ï¼Œé¿å…æœ‰äººé•¿æœŸæ‹¿ä¸åˆ°è®¸å¯ï¼ˆé¥¥é¥¿ï¼‰ã€‚
* **æ•™**ï¼šæ¿ä¹¦â€œç›®æ ‡ï¼šå®‰å…¨ + æ´»æ€§ + å…¬å¹³â€ï¼Œæé†’â€œä»²è£è€…=æŽ’é˜Ÿå™¨â€ã€‚

> **In practical systems, the arbitrator tends to give forks to the same processes because of scheduling or pseudo-randomness.**

* **è¯‘**ï¼šåœ¨çœŸå®žç³»ç»Ÿé‡Œï¼Œå—è°ƒåº¦æˆ–ä¼ªéšæœºå½±å“ï¼Œä»²è£è€…å¯èƒ½åå‘**æ€»æ˜¯ç»™åŒä¸€æ‰¹è¿›ç¨‹**ã€‚
* **è§£**ï¼šä¸å…¬å¹³çš„éšæœº/è°ƒåº¦ä¼šé€ æˆ**é¥¥é¥¿**ã€‚
* **æ•™**ï¼šå¼•å…¥**å…¬å¹³é˜Ÿåˆ—ï¼ˆFIFOï¼‰**æˆ–**è½®è½¬**ä½œä¸ºæ”¹è¿›ã€‚

> **Another important thing to note is that this prevents deadlock for the entire system.**

* **è¯‘**ï¼šéœ€è¦å¼ºè°ƒï¼šä»²è£è€…æ–¹æ¡ˆèƒ½è®©**æ•´ä¸ªç³»ç»Ÿæ— æ­»é”**ã€‚
* **è§£**ï¼šå› ä¸ºæ‰€æœ‰ç­‰å¾…éƒ½å¯¹**ä¸€ä¸ªä¸­å¿ƒç‚¹**ï¼ŒçŽ¯è¢«æ‰“ç ´ã€‚
* **æ•™**ï¼šè®©å­¦ç”ŸæŠŠ RAG ç”»æˆâ€œæ˜Ÿå½¢â€ï¼Œè¯´æ˜Žâ€œæ— çŽ¯â€ã€‚

> **But in our model of dining philosophers, the philosopher has to release the lock themselves.**

* **è¯‘**ï¼šä½†åœ¨æœ¬é—®é¢˜é‡Œï¼Œ**é‡Šæ”¾**ä»éœ€å“²å­¦å®¶**è‡ªæ„¿**å®Œæˆã€‚
* **è§£**ï¼šå¦‚æžœè¿›ç¨‹ä¸é‡Šæ”¾/å¡ä½ï¼Œä»²è£è€…ä¹Ÿä¼šè¢«â€œå ç€â€ã€‚
* **æ•™**ï¼šæé†’â€œä¸å¯æŠ¢å â€çš„å½±å“ï¼šéœ€è¦**è¶…æ—¶/å›žæ”¶**æœºåˆ¶ã€‚

> **Then, you can consider the case of the malicious philosopher (letâ€™s say Descartes because of his Evil Demons) could hold on to the arbitrator forever.**

* **è¯‘**ï¼šè®¾æƒ³æœ‰ä¸ª**æ¶æ„å“²å­¦å®¶**ï¼ˆçŽ©ç¬‘ç§°â€œç¬›å¡å°”â€çš„æ¶é­”ï¼‰ï¼Œä¸€ç›´**éœ¸å ä»²è£è€…**è®¸å¯ã€‚
* **è§£**ï¼šè¿™ä¼šå¯¼è‡´**å…¶ä»–äººéƒ½é¥¿æ­»**ï¼Œå°½ç®¡æ²¡æœ‰æ­»é”ã€‚
* **æ•™**ï¼šæå‡º**ç§Ÿçº¦/è¶…æ—¶**ï¼šè®¸å¯åˆ°æœŸå¼ºåˆ¶å›žæ”¶ã€‚

> **He would make forward progress and the system would make forward progress but there is no way of ensuring that each process makes forward progress withoutâ€¦ true preemptionâ€¦**

* **è¯‘**ï¼šæ¶æ„è€…å’Œç³»ç»Ÿéƒ½åœ¨â€œå‰è¿›â€ï¼Œä½†**æ— æ³•ä¿è¯æ¯ä¸ªè¿›ç¨‹**éƒ½æœ‰è¿›å±•ï¼Œé™¤éžå¼•å…¥**çœŸæ­£çš„æŠ¢å **æˆ–å¤–éƒ¨å¼ºåˆ¶ã€‚
* **è§£**ï¼šè¿™åœ¨åˆ†å¸ƒå¼/æ“ä½œç³»ç»Ÿé‡Œå¾ˆå¸¸è§ï¼šç³»ç»Ÿåžåæœ‰ï¼Œä½†**ä¸ªä½“é¥¥é¥¿**ã€‚
* **æ•™**ï¼šè®²**å…¬å¹³æ€§æŒ‡æ ‡**ï¼ˆæœ‰ç•Œç­‰å¾…ã€æœ€å¤§ç­‰å¾…æ—¶é—´ï¼‰ã€‚

> **â€¦meaning that a higher authority (letâ€™s say Steve Jobs) tells them to stop eating forcibly.**

* **è¯‘**ï¼šæ¯”å–»ï¼šéœ€è¦æ›´é«˜çš„æƒå¨ï¼ˆæ¯”å¦‚â€œä¹”å¸ƒæ–¯â€ï¼‰**å¼ºåˆ¶**è®©ä»–åœã€‚
* **æ•™**ï¼šæŠŠâ€œé«˜æƒå¨â€æ˜ å°„ä¸º**å†…æ ¸/ç®¡ç†æœåŠ¡**çš„æŠ¢å ã€killã€è¶…æ—¶å›žæ»šã€‚

---

# B. è¯æ˜Žï¼šä»²è£è€…æ–¹æ¡ˆä¸æ­»é”ï¼ˆProof æ¡†ï¼‰

> **The arbitrator solution doesnâ€™t deadlock.**

* **è¯‘**ï¼šç»“è®ºï¼šä»²è£è€…æ–¹æ¡ˆ**ä¸ä¼šæ­»é”**ã€‚

> **The proof is about as simple as it gets. Only one philosopher can request resources at a time.**

* **è¯‘**ï¼šè¯æ˜Žå¾ˆç®€å•ï¼šä»»ä½•æ—¶åˆ»**åªæœ‰ä¸€ä¸ªå“²å­¦å®¶**è¢«å…è®¸è¯·æ±‚èµ„æºã€‚
* **è§£**ï¼šæŠŠç«žäº‰çº¿æ€§åŒ–ï¼ˆä¸€æ¬¡ä¸€ä¸ªï¼‰ï¼ŒçŽ¯è·¯ä¸å¯èƒ½å½¢æˆã€‚

> **There is no way to make a cycle in the resource allocation graph with only one philosopher acting in pickup the left then the right forkâ€¦**

* **è¯‘**ï¼šèµ„æºåˆ†é…å›¾é‡Œ**åªæœ‰ä¸€ä¸ªæ´»åŠ¨çš„è¯·æ±‚è€…**ï¼Œå°±æ— æ³•å½¢æˆâ€œå·¦â†’å³â†’åˆ«äººâ†’â€¦â†’å›žåˆ°æˆ‘â€çš„**çŽ¯**ã€‚
* **æ•™**ï¼šè®©å­¦ç”ŸæŠŠ RAG ç”»æˆä¸€ä¸ªè¿›ç¨‹ä¸Žä¸¤æŠŠå‰çš„**å°ä¸‰è§’**ï¼Œæ²¡æœ‰å…¶ä»–èŠ‚ç‚¹å‚ä¸Žï¼Œè‡ªç„¶æ— çŽ¯ã€‚
* **å›¾ 8.6**ï¼šå·¦ä¾§â€œè®¸å¤šäººåŒæ—¶æŒ‡å‘ä¸­å¿ƒé”â€â†’å³ä¾§â€œç”±ä»²è£è€…å‘æ”¾è®¸å¯â€çš„ç¤ºæ„ã€‚

---

# C. 8.5.1 Leaving the Tableï¼ˆStallingsâ€™ è§£æ³•ï¼‰

> **Why does the first solution deadlock? Well, there are n philosophers and n chopsticks. What if there is only 1 philosopher at the table? Can we deadlock? No. How about 2â€¦ 3?**

* **è¯‘**ï¼šä¸ºä»€ä¹ˆæœ€åˆçš„æ–¹æ¡ˆä¼šæ­»é”ï¼Ÿå› ä¸ºæ¡Œä¸Š**n äººã€n æŠŠå‰**ã€‚è‹¥æ¡Œä¸Š**åªæœ‰ 1 äºº**ï¼Œä¼šæ­»é”å—ï¼Ÿä¸ä¼šã€‚é‚£ **2 äººã€3 äºº**å‘¢ï¼Ÿ
* **è§£**ï¼šåœ¨æŸäº›äººæ•°ä¸‹ï¼Œä¸ä¼šå½¢æˆâ€œå…¨çŽ¯ç­‰å¾…â€ã€‚
* **æ•™**ï¼šå¼•å¯¼æŽ¨æµ‹â€œ**åŒæ—¶æ”¾è¡Œçš„äººæ•°**ä¸Žæ˜¯å¦å¯èƒ½æˆçŽ¯ç›¸å…³â€ã€‚

> **Stallingsâ€™ solution removes philosophers from the table until deadlock is not possible â€“ think about what the magic number of philosophers at the table.**

* **è¯‘**ï¼šStallings çš„æ€è·¯ï¼š**å‡å°‘åœ¨æ¡Œäººæ•°**ï¼Œç›´åˆ°**ä¸å¯èƒ½æ­»é”**ã€‚é—®ï¼šæ¡Œä¸Šå…è®¸çš„â€œ**é­”æ³•äººæ•°**â€æ˜¯å¤šå°‘ï¼Ÿ
* **è§£**ï¼šå¸¸è§åšæ³•ï¼š**åªå…è®¸æœ€å¤š nâˆ’1 äºº**åŒæ—¶å‚ä¸Žç«žäº‰ï¼ˆæˆ–æ›´å°çš„é˜ˆå€¼ï¼‰ã€‚è¿™æ ·è‡³å°‘æœ‰ä¸€æŠŠå‰ä¸è¢«å ï¼Œèƒ½æ‰“ç ´çŽ¯ã€‚
* **æ•™**ï¼šæ¿ä¹¦ç»“è®ºï¼š**Limit concurrent contenders â‰¤ nâˆ’1 â‡’ æ— å…¨çŽ¯**ã€‚

> **The way to do this in the actual system is through semaphores and letting a certain number of philosophers through.**

* **è¯‘**ï¼šå®žçŽ°æ–¹å¼ï¼šç”¨**ä¿¡å·é‡**æŽ§åˆ¶ï¼Œæœ€å¤šå…è®¸ **k** äººè¿›å…¥â€œå–å‰åŒºåŸŸâ€ã€‚
* **æ•™**ï¼šä¼ªä»£ç ï¼š`sem slots = n-1; P(slots); pick forks; eat; V(slots);`

> **This has the benefit that multiple philosophers can be eating.**

* **è¯‘**ï¼šä¼˜ç‚¹ï¼š**å¯å¹¶å‘**ï¼Œå¤šä¸ªå“²å­¦å®¶åŒæ—¶åƒã€‚
* **è§£**ï¼šä¸åŒäºŽâ€œå•ä»²è£è®¸å¯â€çš„ä¸²è¡ŒåŒ–ã€‚

> **In the case that the philosophers arenâ€™t evil, this solution requires a lot of time-consuming context switching.**

* **è¯‘**ï¼šè‹¥å“²å­¦å®¶ä¸æ˜¯æ¶æ„çš„ï¼Œè¿™ä¸€æ–¹æ¡ˆï¼ˆæŽ§åˆ¶äººæ•°/ä¿¡å·é‡ï¼‰ä¼šå¸¦æ¥**é¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢**çš„å¼€é”€ã€‚
* **è§£**ï¼šè¿›å‡ºâ€œé™æµé—¨â€çš„è°ƒåº¦+é˜»å¡ž/å”¤é†’æˆæœ¬ã€‚
* **æ•™**ï¼šè®¨è®º**åžå vs å®‰å…¨**æƒè¡¡ã€‚

> **There is also no reliable way to know the number of resources beforehand.**

* **è¯‘**ï¼šå®žé™…ç³»ç»Ÿé‡Œï¼Œå¸¸å¸¸**ä¸çŸ¥é“**æ‰€éœ€èµ„æºçš„ç²¾ç¡®æ•°é‡ï¼ˆéš¾ä»¥è®¾ç½®æœ€ä½³ `k`ï¼‰ã€‚
* **è§£**ï¼šé€šç”¨ OS å¾ˆéš¾æå‰å£°æ˜Žå…¨éƒ¨èµ„æºéœ€æ±‚ï¼ˆå‘¼åº”å‰æ–‡ Rice å®šç†ç±»è§‚ç‚¹ï¼‰ã€‚

> **In the dining philosophers case, this is solved because everything is known butâ€¦ trying to specify an operating systemâ€¦ can lead to a faulty solution.**

* **è¯‘**ï¼šåœ¨å“²å­¦å®¶è¿™ä¸ªçŽ©å…·æ¨¡åž‹é‡Œï¼Œèµ„æºæ•°é‡å¯çŸ¥ï¼›ä½†åœ¨çœŸå®ž OS é‡Œï¼Œæƒ³é¢„å…ˆæŒ‡å®šä¼š**ä¸å¯é **ã€‚
* **æ•™**ï¼šæŠŠâ€œæ•™å­¦æ¨¡åž‹â€å’Œâ€œå·¥ä¸šçŽ°å®žâ€å¯¹æ¯”ï¼Œæé†’å­¦ç”Ÿä¸è¦ç”Ÿæ¬ç¡¬å¥—ã€‚

> **And again since semaphores are system constructs, they obey system timing clocks which means that the same processes tend to get added back into the queue again.**

* **è¯‘**ï¼šä¿¡å·é‡ä¾èµ–ç³»ç»Ÿæ—¶åºï¼Œå¯èƒ½å¯¼è‡´**ç›¸åŒè¿›ç¨‹åå¤æŽ’åˆ°å‰é¢**ï¼ˆä¸å…¬å¹³ï¼‰ã€‚
* **è§£**ï¼šéœ€è¦**å…¬å¹³é˜Ÿåˆ—/éšæœºåŒ–/ä¼˜å…ˆçº§**æ¥ç¼“è§£ã€‚
* **æ•™**ï¼šè®©å­¦ç”Ÿè®¾è®¡â€œFIFO semaphoreâ€æˆ–åœ¨è®¸å¯ä¸Šé™„å¸¦**å¹´é¾„/æƒé‡**ã€‚

> **Now if a philosopher becomes evil, then the problem becomes that there is no preemption.**

* **è¯‘**ï¼šè‹¥å‡ºçŽ°â€œæ¶æ„å“²å­¦å®¶â€ï¼Œé—®é¢˜åˆå›žåˆ°**ä¸å¯æŠ¢å **ï¼šä»–å¯èƒ½é•¿æ—¶é—´å ç€è®¸å¯/èµ„æºã€‚
* **æ•™**ï¼šåŠ å…¥**è¶…æ—¶/ç§Ÿçº¦/çœ‹é—¨ç‹—**ï¼šè¶…è¿‡ T å¼ºåˆ¶å›žæ”¶æˆ– killã€‚

---

## è¯¾å ‚æ€Žä¹ˆè®²ä¸Žæ€Žä¹ˆåšï¼ˆå¯ç›´æŽ¥ç”¨ï¼‰

### 1) å…¬å¹³ä¸Žé¥¥é¥¿æ¼”ç¤ºï¼ˆ5â€“7 åˆ†é’Ÿï¼‰

* ç”¨â€œä»²è£è€…+æ— é˜Ÿåˆ—â€çš„æ¼”ç¤ºï¼Œè®©åŒä¸€äººè¿žç»­å¤šæ¬¡èŽ·æ‰¹ï¼›å†æ”¹æˆ**FIFO é˜Ÿåˆ—**ï¼Œæ¯”è¾ƒç­‰å¾…æ—¶é—´ã€‚

### 2) Stallings é™æµå®žéªŒï¼ˆ10 åˆ†é’Ÿï¼‰

* ä»£ç å®žçŽ°ï¼š`semaphore slots = n-1`ï¼›ç»Ÿè®¡**åžå**ä¸Ž**å¹³å‡ç­‰å¾…**ã€‚
* æ”¹å˜ `k`ï¼š`k=n-2, n-1, n`ï¼Œæ¯”è¾ƒæ­»é”æ¦‚çŽ‡ä¸Žæ€§èƒ½ã€‚
* åŠ å…¥**æ¶æ„çº¿ç¨‹**ï¼ˆå»¶é•¿ `eat()` æ—¶é—´ï¼‰ï¼Œè§‚å¯Ÿç³»ç»Ÿè¡¨çŽ°ï¼›å†åŠ **è¶…æ—¶å›žæ”¶**ã€‚

### 3) æ€è€ƒé¢˜ï¼ˆ3â€“5 åˆ†é’Ÿï¼‰

* â€œæ— æ­»é”ã€æ— æ´»é”ã€æ— é¥¥é¥¿ã€åžåé«˜ã€æ— å•ç‚¹â€èƒ½å¦åŒæ—¶æ»¡è¶³ï¼ŸçŽ°å®žç³»ç»Ÿå¦‚ä½•æŠ˜ä¸­ï¼Ÿï¼ˆä¸­å¿ƒä»²è£ + å¤‡ä»½ã€èµ„æºæŽ’åº + éšæœºé€€é¿ã€è¶…æ—¶ + å›žæ»šï¼‰

---

## é»‘æ¿å°ç»“ï¼ˆç»™å­¦ç”Ÿçš„ checklistï¼‰

* ä»²è£è€…ï¼š**ç ´çŽ¯**â†’ä¸æ­»é”ï¼›éœ€**å…¬å¹³é˜Ÿåˆ—**ã€**è¶…æ—¶/ç§Ÿçº¦**ã€é¿å…**SPOF**ã€‚
* Stallingsï¼š**é™æµåˆ° nâˆ’1** â†’ ä¸æ­»é”ï¼›æ³¨æ„**è°ƒåº¦å¼€é”€**ã€**ä¸å…¬å¹³**ã€**ä¸å¯æŠ¢å **ã€‚
* å·¥ç¨‹åŒ–ï¼š**å®‰å…¨ï¼ˆSafetyï¼‰+ æ´»æ€§ï¼ˆLivenessï¼‰+ å…¬å¹³ï¼ˆFairnessï¼‰+ åžåï¼ˆThroughputï¼‰+ å®¹é”™ï¼ˆFault toleranceï¼‰**ï¼Œéœ€é’ˆå¯¹åœºæ™¯æƒè¡¡ã€‚

---

éœ€è¦çš„è¯ï¼Œæˆ‘å¯ä»¥ï¼š

* ç»™ä½ ä¸€ä»½**ä»²è£è€…ï¼ˆFIFOï¼‰**ä¸Ž**Stallingsï¼ˆnâˆ’1 é™æµï¼‰**çš„**å¯è¿è¡Œæ¨¡æ¿**ï¼ˆC/Pthreads æˆ– Python çº¿ç¨‹ï¼‰ï¼›
* é…å¥—**å®žéªŒè®°å½•è¡¨**ä¸Ž**è¯„åˆ† rubric**ï¼Œæ–¹ä¾¿è¯¾å ‚/ä½œä¸šæ‰¹æ”¹ã€‚


---

## ç¬¬ 204 é¡µ

![ç¬¬ 204 é¡µ](main_chapter8_assets/page-204.png)

**æé—®ï¼š** å¯¹æˆªå›¾ä¸­çš„å†…å®¹é€å¥è¯¦ç»†ä½¿ç”¨ä¸­æ–‡è§£é‡Šï¼Œä¸ä»…ä»…åªæ˜¯ç¿»è¯‘ï¼Œè¿˜éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œé€‚å½“çš„è§£é‡Š,å‘Šè¯‰æˆ‘è¯¥æ€Žä¹ˆæ•™å­¦ç”Ÿå¹¶ä¸”æŒ‡å¯¼æ€Žä¹ˆåš

ä¸‹é¢è¿™é¡µåˆ†æˆä¸¤å¤§å—ï¼š
A) **Stallings çš„â€œç¦»æ¡Œæ³•â€è¯æ˜Žä¸Žæœ€åæƒ…å½¢å¯è§†åŒ–**ï¼›
B) **Dijkstra çš„â€œéƒ¨åˆ†æœ‰åº/å…¨åºç¼–å·æ³•â€ï¼ˆPartial Orderingï¼‰**ã€‚
æˆ‘ä¼šæŒ‰åŽŸæ–‡**é€å¥ä¸­æ–‡è§£é‡Š**ï¼Œå†ç»™**æ€Žä¹ˆè®²ç»™å­¦ç”Ÿå¬**ä¸Ž**å¯æ“ä½œç»ƒä¹ **ã€‚

---

# A. Stallingsï¼šç¦»æ¡Œæ³•ï¼ˆnâˆ’1 é™æµï¼‰è¯æ˜Žä¸Žå›¾è§£

> **(æ‰¿ä¸Šé¡µ) â€¦ a philosopher can eat for as long as they want â€¦ fairness â€¦ bounded wait times â€¦ timeouts or forced context switches.**

* **è¯‘**ï¼šåœ¨ç¦»æ¡Œæ³•é‡Œï¼ˆé€šè¿‡ä¿¡å·é‡åªå…è®¸å°‘æ•°äººä¸Šæ¡Œï¼‰ï¼ŒæŸä¸ªå“²å­¦å®¶å¯èƒ½**åƒå¾ˆä¹…**ï¼Œç³»ç»Ÿè¿˜èƒ½ç»§ç»­è·‘ï¼Œä½†**æœ€åæƒ…å†µä¸‹å…¬å¹³æ€§å¾ˆå·®**ã€‚æœ€å¥½é…åˆ**è¶…æ—¶**æˆ–**å¼ºåˆ¶åˆ‡æ¢**æ¥ä¿è¯**æœ‰ç•Œç­‰å¾…**ã€‚
* **è§£é‡Š**ï¼šç¦»æ¡Œæ³•ä¿è¯**ä¸æ­»é”**ï¼Œä½†å¯èƒ½**é¥¥é¥¿**ï¼›éœ€è¦å·¥ç¨‹åŒ–ä¿éšœï¼ˆè¶…æ—¶/è½®è½¬ï¼‰ã€‚

---

## è¯æ˜Žæ¡†ï¼š**Stallingsâ€™ Solution Doesnâ€™t Deadlock**

> **Letâ€™s number the philosophers {pâ‚€, pâ‚, â€¦, pâ‚™â‚‹â‚} and the resources {râ‚€, râ‚, â€¦, râ‚™â‚‹â‚}. A philosopher páµ¢ needs r\_{iâˆ’1 mod n} and r\_{i+1 mod n}.**

* **è¯‘**ï¼šå“²å­¦å®¶ä¸Žå‰å­éƒ½ç¼–å·ï¼›páµ¢ éœ€è¦å·¦ r\_{iâˆ’1} ä¸Žå³ r\_{i+1}ï¼ˆæ¨¡ nï¼‰ã€‚
* **è§£é‡Š**ï¼šæ ‡å‡†åœ†æ¡Œæ¨¡åž‹ã€‚

> **Without loss of generality, let us take páµ¢ out of the picture.**

* **è¯‘**ï¼šä¸å¤±ä¸€èˆ¬æ€§ï¼Œè®¾æŸä¸ªå“²å­¦å®¶æš‚æ—¶ä¸å‚ä¸Žï¼ˆç¦»æ¡Œï¼‰ã€‚
* **è§£é‡Š**ï¼šç¦»æ¡Œæ³•çš„ç²¾é«“ï¼š**å‡å°‘å¹¶å‘ç«žäº‰è€…**ï¼Œå…¸åž‹åšæ³•æ˜¯â€œæœ€å¤šå…è®¸ nâˆ’1 äººä¸Šæ¡Œâ€ã€‚

> **Each resource had exactly two philosophers that could use it. Now resources r\_{iâˆ’1} and r\_{i+1} only have one philosopher waiting on it.**

* **è¯‘**ï¼šæ¯æŠŠå‰å­åŽŸæœ¬è¢«ä¸¤äººå…±äº«ï¼›å½“ páµ¢ ç¦»æ¡Œï¼Œpáµ¢ å·¦å³ä¸¤æŠŠå‰å­**å„åªå‰©ä¸€äºº**ä¼šåŽ»æ‹¿ã€‚
* **è§£é‡Š**ï¼šçŽ¯ä¸Šå°‘äº†ä¸€ä¸ªâ€œç­‰å¾…è€…â€ï¼Œ**æ–­çŽ¯**çš„æœºä¼šå‡ºçŽ°äº†ã€‚

> **Even if hold and wait, no preemption, and mutual exclusion are present, the resources can never enter a state where one philosopher requests them and they are held by another philosopher because only one philosopher can request them.**

* **è¯‘**ï¼šå³ä¾¿äº’æ–¥/å æœ‰å¹¶ç­‰å¾…/ä¸å¯æŠ¢å éƒ½æˆç«‹ï¼ŒæŸäº›èµ„æº**ä¸ä¼šå‡ºçŽ°â€œè¢«ç”²æŒæœ‰åŒæ—¶è¢«ä¹™è¯·æ±‚â€çš„çŽ¯å¼ç›¸äº’ç­‰å¾…**ï¼Œå› ä¸º**åªå‰©ä¸€ä¸ªè¯·æ±‚è€…**ã€‚
* **è§£é‡Š**ï¼šæ‰“æŽ‰**å¾ªçŽ¯ç­‰å¾…**è¿™æ¡ Coffman æ¡ä»¶ â‡’ **ä¸æ­»é”**ã€‚

> **Since there is no way to generate a cycle otherwise, circular wait cannot hold. Since circular wait cannot hold, deadlock cannot happen.**

* **è¯‘**ï¼šç”±äºŽæ— æ³•å½¢æˆçŽ¯ï¼Œå¾ªçŽ¯ç­‰å¾…ä¸æˆç«‹ â‡’ ä¸ä¼šæ­»é”ã€‚
* **è¯¾å ‚å¼ºè°ƒ**ï¼š\*\*â€œç ´ä¸€æ¡ â‡’ æ— æ­»é”â€\*\*çš„å…¸åž‹å®žä¾‹ã€‚

---

> **Figure 8.7: Stalling solution almost deadlock**

* **è§£è¯»**ï¼šå›¾ç¤ºâ€œæœ€åæƒ…å½¢â€ï¼šçœ‹ä¼¼è¦å…¨çŽ¯ç­‰å¾…ï¼Œä½†å› ä¸º**æœ‰äººç¦»æ¡Œ**ï¼ŒçŽ¯è¢«æ‹†ï¼›æµç¨‹ç»§ç»­ã€‚
* **æ•™å­¦**ï¼šè®©å­¦ç”Ÿåœ¨å›¾ä¸Šç”» RAGï¼šç¼ºå¸­çš„é‚£ä½å¯¹åº”çš„ä¸¤æŠŠå‰å­**ä¸ä¼šåŒæ—¶è¢«ä¸¤ç«¯å /ç­‰**ã€‚

---

### è¯¾å ‚æ€Žä¹ˆè®²ï¼ˆ5â€“7 åˆ†é’Ÿï¼‰

1. ç”»åœ†æ¡Œä¸Žç¼–å·ã€‚
2. è®© pâ‚– â€œç¦»æ¡Œâ€ï¼ˆç”¨ä¿¡å·é‡ `slots = nâˆ’1` è¡¨ç¤ºï¼‰ã€‚
3. å£è¿°ï¼š`r_{kâˆ’1}` ä¸Ž `r_{k+1}` å„åªæœ‰ä¸€ä¾§ç«žäº‰è€… â‡’ ä¸å†é—­çŽ¯ã€‚
4. å¼ºè°ƒé…å¥—ï¼š**è¶…æ—¶/è½®è½¬**ç”¨äºŽå…¬å¹³ã€‚

### å°ç»ƒä¹ ï¼ˆå¯å½“éšå ‚é¢˜ï¼‰

* ç»™å‡º `n=5` çš„æƒ…å½¢ï¼Œ`slots=4`ï¼Œè¯·ç”»å‡ºå¯èƒ½çš„ç­‰å¾…å›¾å¹¶è¯´æ˜Žä¸ºä½•ä¸èƒ½å½¢æˆé•¿åº¦ 5 çš„çŽ¯ã€‚

---

# B. 8.5.2 Dijkstraï¼šPartial Orderingï¼ˆéƒ¨åˆ†æœ‰åº/å…¨åºç¼–å·æ³•ï¼‰

> **He was the one to propose this problem on an exam. Why does the first solution deadlock?**

* **è¯‘**ï¼šDijkstra åœ¨è€ƒè¯•ä¸­æå‡ºäº†è¿™ä¸ªé—®é¢˜ã€‚ä»–é—®ï¼šä¸ºä»€ä¹ˆæœ€åˆçš„æ–¹æ¡ˆä¼šæ­»é”ï¼Ÿ
* **è§£é‡Š**ï¼šå› ä¸º**å¾ªçŽ¯ç­‰å¾…**ï¼ˆæ¯äººå…ˆå·¦åŽå³ï¼‰ã€‚

> **Dijkstra thought that the last philosopher who picks up his left fork â€¦ should pick up his right. He accomplishes it by number the forks 1..n, and tells each of the philosophers to pick up his lower number fork first.**

* **è¯‘**ï¼šDijkstra çš„æƒ³æ³•ï¼š**ç»™å‰å­ç¼–å· 1..n**ï¼Œè§„å®šæ¯ä½å“²å­¦å®¶**å¿…é¡»å…ˆæ‹¿ç¼–å·è¾ƒå°çš„é‚£æŠŠ**ï¼Œå†æ‹¿è¾ƒå¤§çš„é‚£æŠŠã€‚
* **è§£é‡Š**ï¼šè¿™å°±æ˜¯\*\*èµ„æºå…¨åºï¼ˆä¸¥æ ¼ååºï¼‰\*\*ç­–ç•¥ï¼š**åªå‡ä¸é™**çš„ç”³è¯·é¡ºåº â‡’ **æ— æ³•å½¢æˆæœ‰å‘çŽ¯**ã€‚

> **Letâ€™s run through the deadlock condition again. Everyone tries to pick up their lower number fork firstâ€¦**

* **è¯‘**ï¼šé‡æ–°æ£€æŸ¥æ­»é”å››æ¡ä»¶ï¼šæ¯ä¸ªäººéƒ½å…ˆæ‹¿**è¾ƒå°ç¼–å·**çš„å‰ã€‚
* **è¯¾å ‚æ¿æ¼”**ï¼š

  * P1 å…ˆæ‹¿ 1ï¼ŒP2 å…ˆæ‹¿ 2ï¼Œâ€¦ï¼ŒPn å…ˆæ‹¿ nï¼ˆæˆ– 1 ä¸Ž n çš„æ¯”è¾ƒï¼‰ã€‚
  * å…³é”®åœ¨**Pâ‚™ é¢å¯¹ 1 ä¸Ž n**çš„é€‰æ‹©ã€‚

> **They have to choose between fork 1 and n. fork 1 is already held up by philosopher 1, so they canâ€™t pick up that fork, meaning he wonâ€™t pick up fork n. We have broken circular wait!**

* **è¯‘**ï¼šå½“è½®åˆ°å“²å­¦å®¶ nï¼Œå¿…é¡»åœ¨å‰ 1 å’Œå‰ n ä¸­å…ˆæ‹¿è¾ƒå°ç¼–å·çš„**1**ï¼›ä½†**1 å·²è¢« P1 æ‹¿ç€**ï¼Œæ‰€ä»¥ Pn åœ¨ç¬¬ä¸€æ­¥å°±**æ‹¿ä¸åˆ°**ï¼Œå› æ­¤**ä¸ä¼šç»§ç»­æ‹¿ n**ã€‚**å¾ªçŽ¯ç­‰å¾…è¢«æ‰“ç ´**ï¼
* **è§£é‡Š**ï¼šå› ä¸ºä¸¥æ ¼çš„â€œå…ˆå°åŽå¤§â€ï¼Œåœ¨çŽ¯è·¯çš„æŸå¤„å¿…æœ‰ä¸€ä¸ªäºº**æ— æ³•å®Œæˆç¬¬ä¸€æ­¥**ï¼Œä»Žè€Œ**ä¸ä¼šå½¢æˆå…¨çŽ¯è¯·æ±‚é“¾**ã€‚

> **Meaning deadlock isnâ€™t possible.**

* **è¯‘**ï¼šå› æ­¤**ä¸å¯èƒ½æ­»é”**ã€‚

> **Some problems are that an entity either needs to know the finite set of resources in advance or be able to produce a consistent partial order such that circular wait cannot happen.**

* **è¯‘**ï¼šé—®é¢˜åœ¨äºŽï¼šç³»ç»Ÿéœ€è¦**é¢„å…ˆçŸ¥é“èµ„æºé›†åˆ**ï¼Œå¹¶ä¸ºå®ƒä»¬å»ºç«‹ä¸€ä¸ª**ä¸€è‡´çš„å…¨åº/ååº**ã€‚
* **è§£é‡Š**ï¼šè¿™åœ¨é€šç”¨ OS/åˆ†å¸ƒå¼é‡Œä¸æ€»å¯è¡Œï¼ˆèµ„æºåŠ¨æ€å‡ºçŽ°ã€ç±»åž‹å¤æ‚ï¼‰ã€‚

> **This also implies that there needs to be some entity â€¦ deciding on the number and all of the philosophers need to agree on the number as new resources come in.**

* **è¯‘**ï¼šè¿˜éœ€è¦æŸä¸ªâ€œå®žä½“â€ï¼ˆOS æˆ–ç®¡ç†è€…ï¼‰æ¥**åˆ†é…ç¼–å·å¹¶è®©å¤§å®¶è¾¾æˆä¸€è‡´**ï¼Œå½“æœ‰æ–°èµ„æºåŠ å…¥æ—¶ç»§ç»­ç»´æŠ¤è¿™ä¸ªé¡ºåºã€‚
* **è§£é‡Š**ï¼šéœ€è¦**å…¨å±€åå•†**ä¸Ž**ä¸€è‡´æ€§**ã€‚

> **As we have also seen with previous solutions, this relies on context switching. This prioritizes philosophers that have already eaten but can be made fairer by introducing random sleeps and waits.**

* **è¯‘**ï¼šè¯¥æ–¹æ¡ˆä¾èµ–è°ƒåº¦/åˆ‡æ¢ï¼›åœ¨å®žçŽ°ä¸­å¯èƒ½**ä¼˜å…ˆ**å·²åƒè¿‡çš„äººï¼ˆæˆ–é€ æˆä¸å…¬å¹³ï¼‰ï¼Œå¯é€šè¿‡**éšæœº sleep/ç­‰å¾…**æ”¹å–„å…¬å¹³ã€‚
* **è§£é‡Š**ï¼šå®žè·µé‡Œè¦åŒæ—¶è€ƒè™‘**æ´»æ€§+å…¬å¹³**ã€‚

---

## è¯¾å ‚æ€Žä¹ˆè®²ï¼ˆ8â€“10 åˆ†é’Ÿï¼‰

### æ¿ä¹¦æ­¥éª¤

1. **ç»™å‰å­ç¼–å·**ï¼š1â€¦nï¼ˆé¡ºæ—¶é’ˆï¼‰ã€‚
2. **è§„åˆ™**ï¼šå“²å­¦å®¶æ€»æ˜¯å…ˆæ‹¿**min(å·¦,å³)**ï¼Œå†æ‹¿**max**ã€‚
3. **åè¯æ‰¾çŽ¯**ï¼šè‹¥å­˜åœ¨çŽ¯ï¼Œåˆ™æ²¿çŽ¯ç¼–å·åº”**ä¸¥æ ¼é€’å¢ž**å¹¶æœ€ç»ˆ**å›žåˆ°èµ·ç‚¹**ï¼Œä¸Žâ€œä¸¥æ ¼é€’å¢žä¸å¯èƒ½å›žåˆ°åŽŸæ•°â€çŸ›ç›¾ â‡’ **æ— çŽ¯**ã€‚
4. å¼ºè°ƒå‰ç½®æ¡ä»¶ï¼š**å¿…é¡»èƒ½å¯¹æ‰€æœ‰èµ„æºå»ºç«‹å…¨çƒä¸€è‡´é¡ºåº**ã€‚

### è¯¾å ‚æ¼”ç¤º

* è®©åŒå­¦æ‰‹æŒå†™æœ‰ç¼–å·çš„â€œå‰å¡ç‰‡â€ï¼›æ¯æ¬¡åªèƒ½æŒ‰â€œå…ˆå°åŽå¤§â€åŽ»æ‹¿ã€‚
* ä½ ä¼šçœ‹åˆ°ï¼šæ°¸è¿œä¸ä¼šå…¨ä½“ä¸€èµ·å¡ä½ï¼›æ€»æœ‰äººæ‹¿ä¸åˆ°â€œç¬¬ä¸€æŠŠâ€ï¼Œä»Žè€Œè®©å‡ºæ—¶åºã€‚

---

## å®žéªŒ/ä½œä¸šå»ºè®®

1. **ç¦»æ¡Œæ³• vs å…¨åºæ³•**ï¼ˆC/Pthreads æˆ– Pythonï¼‰ï¼š

* å®žçŽ° `semaphore slots = n-1` ä¸Žâ€œå…ˆå°åŽå¤§â€ä¸¤ç‰ˆï¼›
* åº¦é‡åžåï¼ˆæ¯ç§’ `eat()` æ¬¡æ•°ï¼‰ã€å¹³å‡ç­‰å¾…ã€æœ€é•¿ç­‰å¾…ï¼›
* åŠ å…¥**æ¶æ„çº¿ç¨‹**ï¼ˆé•¿æ—¶é—´ä¸é‡Šæ”¾ï¼‰å¹¶åŠ **è¶…æ—¶**ï¼Œæ¯”è¾ƒç³»ç»Ÿè¡¨çŽ°ã€‚

2. **è¯æ˜Žé¢˜ï¼ˆä¹¦é¢ï¼‰**ï¼š

* ç”¨**åè¯æ³•/æ‹“æ‰‘åº**ï¼Œå†™å‡ºâ€œèµ„æºå…¨åº â‡’ æ— çŽ¯ â‡’ ä¸æ­»é”â€çš„ç®€æ˜Žè¯æ˜Žï¼ˆâ‰¤200 å­—ï¼‰ã€‚

3. **å¼€æ”¾é¢˜**ï¼š

* å¦‚æžœèµ„æº**åŠ¨æ€åŠ å…¥/ç¦»å¼€**ï¼Œå¦‚ä½•ç»´æŠ¤å…¨åºï¼Ÿï¼ˆæç¤ºï¼šåˆ†å±‚å‘½åã€å‘½åç©ºé—´å‰ç¼€ã€ç‰ˆæœ¬å·ã€ç§Ÿçº¦è¿‡æœŸåŽé‡ç¼–å·ï¼‰

---

## æ˜“é”™ç‚¹ä¸Žæé†’

* **æ— æ­»é” â‰  æ— é¥¥é¥¿**ï¼šç¦»æ¡Œæ³•ä¸Žç¼–å·æ³•éƒ½å¯èƒ½äº§ç”Ÿ**ä¸å…¬å¹³**ï¼›è¯·å¼•å…¥**éšæœºé€€é¿/FIFO é˜Ÿåˆ—/è€åŒ–ï¼ˆagingï¼‰**ã€‚
* **ç¼–å·æ³•çš„â€œå…¨åºä¸€è‡´æ€§â€**æ˜¯å…³é”®ï¼šå¦‚æžœä¸åŒè¿›ç¨‹ä½¿ç”¨ä¸åŒçš„ç¼–å·è§†å›¾ï¼Œåè€Œä¼š**é‡æ–°å¼•å…¥çŽ¯**ã€‚
* **è¯æ˜Žæ—¶åˆ«æ··æ·†**ï¼šç¼–å·æ³•æ˜¯**ç ´â€œå¾ªçŽ¯ç­‰å¾…â€**ï¼›ç¦»æ¡Œæ³•æ˜¯**å‡å°‘å¹¶å‘è€…**ï¼Œä½¿çŽ¯æ— æ³•é—­åˆã€‚

---

éœ€è¦çš„è¯ï¼Œæˆ‘å¯ä»¥æŠŠ**ä¸¤ç§æ–¹æ¡ˆçš„æ¨¡æ¿ä»£ç **ã€**å®žéªŒè®°å½•è¡¨ï¼ˆå«æŒ‡æ ‡å…¬å¼ï¼‰**å’Œ**é»‘æ¿è¯æ˜Žå›¾ç¤º**åšæˆä¸€é¡µè®²ä¹‰ï¼Œæ–¹ä¾¿ç›´æŽ¥ä¸Šè¯¾ç”¨ã€‚


---

## ç¬¬ 205 é¡µ

![ç¬¬ 205 é¡µ](main_chapter8_assets/page-205.png)

**æé—®ï¼š** å¯¹æˆªå›¾ä¸­çš„å†…å®¹é€å¥è¯¦ç»†ä½¿ç”¨ä¸­æ–‡è§£é‡Šï¼Œä¸ä»…ä»…åªæ˜¯ç¿»è¯‘ï¼Œè¿˜éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œé€‚å½“çš„è§£é‡Š,å‘Šè¯‰æˆ‘è¯¥æ€Žä¹ˆæ•™å­¦ç”Ÿå¹¶ä¸”æŒ‡å¯¼æ€Žä¹ˆåš

ä¸‹é¢è¿™é¡µä¸»è¦åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼š
A) **Dijkstraï¼ˆéƒ¨åˆ†æœ‰åº/å…¨åºç¼–å·æ³•ï¼‰ä¸æ­»é”çš„è¯æ˜Ž**ï¼›
B) **å›¾ 8.8 çš„æ¼”åŒ–ç¤ºæ„**ï¼›
C) **8.6 Topics å¤ç›˜æ¸…å•**ã€‚
æˆ‘ä¼š**é€å¥ä¸­æ–‡è§£é‡Š + ç‚¹è¯„**ï¼Œå¹¶ç»™å‡º**è¯¾å ‚æ€Žä¹ˆè®²/æ€Žä¹ˆç»ƒ**çš„æŒ‡å¼•ã€‚

---

# A) è¯æ˜Žæ¡†ï¼šDijkstraâ€™s Solution Doesnâ€™t Deadlock

> **The proof is similar to the previous proof. Letâ€™s number the philosophers {pâ‚€, pâ‚, â€¦, pâ‚™â‚‹â‚} and the resources {râ‚€, râ‚, â€¦, râ‚™â‚‹â‚}.**

* **è¯‘**ï¼šè¯æ˜Žä¸Žå‰é¢ç›¸ä¼¼ã€‚ç»™å“²å­¦å®¶å’Œå‰å­éƒ½ç¼–å·ã€‚
* **è®²**ï¼šé»‘æ¿å†™ä¸Šåœ†æ¡Œç¼–å·ï¼Œç»Ÿä¸€è®°æ³•ï¼ŒåŽç»­ä¾¿äºŽæŒ‡ä»£ã€‚

> **A philosopher páµ¢ needs resource r\_{iâˆ’1 mod n} and r\_{i+1 mod n}.**

* **è¯‘**ï¼špáµ¢ éœ€è¦å·¦å³ä¸¤æŠŠå‰ï¼šr\_{iâˆ’1} ä¸Ž r\_{i+1}ï¼ˆæ¨¡ nï¼‰ã€‚
* **è®²**ï¼šæ ‡å‡†æ¨¡åž‹å›žé¡¾ï¼Œç¡®ä¿å­¦ç”Ÿä¸æŽ‰é˜Ÿã€‚

> **Each philosopher will grab r\_{iâˆ’1 mod n} then r\_{i+1 mod n} but the last philosopher will grab in the reverse order.**

* **è¯‘**ï¼šæ¯ä½å“²å­¦å®¶æŒ‰ç…§â€œå…ˆæ‹¿è¾ƒå°ç¼–å·ï¼Œå†æ‹¿è¾ƒå¤§ç¼–å·â€çš„è§„åˆ™å–å‰ï¼›ç‰¹åˆ«åœ°ï¼Œâ€œæœ€åŽä¸€ä½â€åœ¨çŽ¯çš„è¡”æŽ¥å¤„ä¼šä¸Žä»–äººæ–¹å‘ç›¸åï¼ˆå½¢æˆâ€œå…ˆå°åŽå¤§â€çš„ä¸€è‡´å…¨åºï¼‰ã€‚
* **è§£**ï¼šæ•™æè¿™é‡Œç­‰ä»·äºŽ**å…¨åºæ³•**ï¼šæ‰€æœ‰äºº**å…ˆæ‹¿ç¼–å·å°çš„**é‚£æŠŠï¼Œå†æ‹¿å¤§çš„ã€‚çŽ¯ä¸Šå¿…æœ‰ä¸€å¤„è¢«â€œå…ˆå°â€å¡ä½ï¼Œä»Žè€Œç ´çŽ¯ã€‚
* **è®²**ï¼šæ¿ä¹¦è§„åˆ™ï¼š`lock(min(left,right)) â†’ lock(max(left,right))`ã€‚

> **Even if hold and wait, no preemption, and mutual exclusion are present, since the last philosopher will grab r\_{nâˆ’1} then râ‚€ there are two cases either the philosopher has the first lock or the philosopher doesnâ€™t.**

* **è¯‘**ï¼šå³ä½¿â€œå æœ‰å¹¶ç­‰å¾…/ä¸å¯æŠ¢å /äº’æ–¥â€éƒ½æˆç«‹ï¼Œè€ƒè™‘â€œæœ€åŽä¸€ä½â€é¢å¯¹ râ‚€ ä¸Ž r\_{nâˆ’1}ï¼šè¦ä¹ˆä»–å…ˆæ‹¿åˆ°â€œç¬¬ä¸€æŠŠâ€ï¼ˆè¾ƒå°ç¼–å·ï¼‰ï¼Œè¦ä¹ˆæ‹¿ä¸åˆ°ã€‚
* **è®²**ï¼šæŠŠé—®é¢˜æ‹†æˆä¸¤ç§æƒ…å†µåˆ†åˆ«è®¨è®ºï¼ˆç©·å°½æ³•ï¼‰ã€‚

> **If the last philosopher p\_{nâˆ’1} holds the first lock meaning the previous philosopher p\_{nâˆ’2} is waiting on r\_{nâˆ’1} â€¦ the philosopher previous p\_{nâˆ’3} will grab her first lock. This is now a reduction to the previous proof of stalling because we now have n resources but only nâˆ’1 philosophersâ€¦ cannot deadlock.**

* **è¯‘**ï¼šè‹¥ p\_{nâˆ’1} æ‹¿åˆ°äº†è‡ªå·±çš„â€œç¬¬ä¸€æŠŠâ€ï¼Œåˆ™ p\_{nâˆ’2} å¯èƒ½åœ¨ç­‰è¿™æŠŠï¼›æ­¤æ—¶ç›¸å½“äºŽâ€œæ¡Œä¸Šå°‘äº†ä¸€ä¸ªç«žäº‰è€…â€ï¼ˆn æŠŠå‰ã€nâˆ’1 ä¸ªæœ‰æ•ˆç«žäº‰è€…ï¼‰ï¼Œ**åŒ–çº¦**åˆ°å‰é¢â€œç¦»æ¡Œæ³•ï¼ˆStallingsï¼‰â€çš„æƒ…å½¢ â‡’ **ä¸æ­»é”**ã€‚
* **è®²**ï¼šå‘Šè¯‰å­¦ç”Ÿè¿™æ˜¯**å½’çº¦è®ºè¯**ï¼šæŠŠå¤æ‚æƒ…å½¢åŒ–çº¦ä¸ºå·²è¯å®‰å…¨çš„åœºæ™¯ã€‚

> **If the philosopher doesnâ€™t obtain that first lock, then we have a reduction to Stallingsâ€™s proof above because now have nâˆ’1 philosophers vying for n resourcesâ€¦**

* **è¯‘**ï¼šè‹¥ p\_{nâˆ’1} **æ‹¿ä¸åˆ°**ç¬¬ä¸€æŠŠï¼Œåˆ™â€œæœ‰æ•ˆç«žäº‰è€…â€ç«‹åˆ»å˜æˆ nâˆ’1 ä¸ªï¼ŒåŒæ ·å½’çº¦åˆ°â€œç¦»æ¡Œæ³•â€ï¼Œ**ä¸æ­»é”**ã€‚
* **è®²**ï¼šä¸¤ç§æƒ…å†µéƒ½å½’çº¦æˆåŠŸ â‡’ ç»“è®ºæˆç«‹ã€‚

> **â€¦we canâ€™t reach deadlock in either case, this solution cannot deadlock which is what we needed to show.**

* **è¯‘**ï¼šä¸¤ç§æƒ…å½¢éƒ½ä¸ä¼šèµ°åˆ°æ­»é”ï¼Œå› æ­¤å…¨åºæ³•**ä¸æ­»é”**ï¼Œè¯æ¯•ã€‚
* **è¯¾å ‚æç¤º**ï¼šå¼ºè°ƒ\*\*ç ´â€œå¾ªçŽ¯ç­‰å¾…â€\*\*è¿™ä¸€æ¡å°±æ˜¯å…³é”®ã€‚

---

# B) Figure 8.8ï¼šStalling solution partial deadlock

* **å›¾æ„**ï¼šå±•ç¤ºä¸€ç§â€œçœ‹ä¼¼é€æ­¥é€¼è¿‘æ­»é”â€çš„æ¼”åŒ–ï¼Œä½†ç”±äºŽ**å…¨åº/ç¦»æ¡Œ**å¸¦æ¥çš„é™åˆ¶ï¼ŒçŽ¯æœ€ç»ˆ**é—­åˆä¸äº†**ï¼Œç³»ç»Ÿç»§ç»­å‰è¿›ã€‚
* **æ€Žä¹ˆè®²**ï¼šè®©å­¦ç”Ÿåœ¨å›¾ä¸Šç»™æ¯æŠŠå‰å†™ç¼–å·ï¼Œæ²¿ç€â€œå…ˆå°åŽå¤§â€çš„è§„åˆ™è¯»ä¸€åœˆï¼Œå¿…æœ‰ä¸€å¤„â€œç¬¬ä¸€æ­¥æ‹¿ä¸åˆ°â€ï¼Œä»Žè€ŒçŽ¯æ–­ã€‚
* **è¯¾å ‚å°ç»ƒ**ï¼šè¯·ä¸€åå­¦ç”Ÿå½“â€œè®²è§£å‘˜â€ï¼Œå¸¦å¤§å®¶æŒ‰ç¼–å·é¡ºåºæ¨¡æ‹Ÿä¸€æ¬¡åŠ é”ï¼Œå…¶ä»–åŒå­¦æ£€æŸ¥æ˜¯å¦å‡ºçŽ°å›žåˆ°èµ·ç‚¹çš„å¯è¡Œè·¯å¾„ï¼ˆåº”è¯¥ä¸ä¼šï¼‰ã€‚

---

# C) 8.6 Topicsï¼ˆæœ¬ç« å¤ç›˜æ¸…å•ï¼‰

> **Coffman Conditions**

* å››æ¡ä»¶ï¼š**äº’æ–¥ã€å æœ‰å¹¶ç­‰å¾…ã€ä¸å¯æŠ¢å ã€å¾ªçŽ¯ç­‰å¾…**ã€‚**ç ´ä»»æ„ä¸€æ¡ â‡’ ä¸æ­»é”**ã€‚

> **Resource Allocation Graphs**

* RAG å»ºæ¨¡ï¼šè¿›ç¨‹/èµ„æºä¸ºèŠ‚ç‚¹ï¼Œ**èµ„æºâ†’è¿›ç¨‹**=å æœ‰ï¼›**è¿›ç¨‹â†’èµ„æº**=è¯·æ±‚ã€‚æ‰¾**æœ‰å‘çŽ¯**ã€‚

> **Dining Philosophers**

* åœ†æ¡Œæ¨¡åž‹æ˜ å°„â€œå¤šä¸ªè¿›ç¨‹ç«žäº‰ä¸¤ä¸ªé‚»æŽ¥èµ„æºâ€çš„é€šç”¨åœºæ™¯ã€‚

> **Failed DP Solutions**

* æœ´ç´ â€œå…ˆå·¦åŽå³ lock-lockâ€å¯èƒ½**æ­»é”**ï¼›`trylock+æ”¾æ‰‹`**ä¸æ­»é”ä½†å¯æ´»é”/é¥¥é¥¿**ã€‚

> **Livelocking DP Solutions**

* å±•ç¤º**æ´»é”æ¼”åŒ–**ä¸Ž**éšæœºé€€é¿**ç¼“è§£æ€è·¯ã€‚

> **Working DP Solutions: Benefits/Drawbacks**

* **ä»²è£è€…/æœåŠ¡å‘˜**ï¼šä¸æ­»é”ã€å¯åšå…¬å¹³ï¼Œä½†**ç“¶é¢ˆ/SPOF**ï¼›
* **ç¦»æ¡Œæ³•ï¼ˆnâˆ’1 é™æµï¼‰**ï¼šä¸æ­»é”ã€å¯å¹¶å‘ï¼›å¯èƒ½**ä¸å…¬å¹³**ã€ä¾èµ–è°ƒåº¦ï¼›
* **éƒ¨åˆ†æœ‰åº/å…¨åºæ³•ï¼ˆDijkstraï¼‰**ï¼šç®€å•é«˜æ•ˆã€åŽ»ä¸­å¿ƒï¼›è¦æ±‚**å…¨å±€ä¸€è‡´ç¼–å·**ã€‚

> **Ron Swanson Deadlock**

* ä¹¦åŽå½©è›‹/æ¡ˆä¾‹ï¼ˆå¯å½“è¯¾å ‚è¶£å‘³è®¨è®ºï¼‰ã€‚

---

## æ•™å­¦æ”¶å°¾æ€Žä¹ˆåšï¼ˆ15â€“20 åˆ†é’Ÿç²¾è®²ç‰ˆï¼‰

1. **é»‘æ¿æ€»ç»“ï¼ˆ5 åˆ†é’Ÿï¼‰**

   * ç”» RAGï¼›å†™ Coffman å››æ¡ä»¶ä¸Žâ€œç ´ä¸€æ¡å³å®‰å…¨â€ï¼›
   * åˆ—å‡º 3 ä¸ªå¯è¡Œæ–¹æ¡ˆåŠä¼˜ç¼ºç‚¹å¯¹ç…§è¡¨ï¼ˆå®‰å…¨/æ´»æ€§/å…¬å¹³/åžå/å¤æ‚åº¦ï¼‰ã€‚

2. **è¯æ˜Žå›žæ”¾ï¼ˆ5 åˆ†é’Ÿï¼‰**

   * ç”¨ 3 è¡Œé€»è¾‘é‡è¿°å…¨åºæ³•è¯æ˜Žï¼š
     â‘  å…¨åº â‡’ å…ˆå°åŽå¤§ï¼›â‘¡ çŽ¯éœ€è¦ä¸¥æ ¼é€’å¢žå¹¶å›žåˆ°èµ·ç‚¹ï¼›â‘¢ çŸ›ç›¾ â‡’ æ— çŽ¯ â‡’ ä¸æ­»é”ã€‚
   * å¯¹æ¯”â€œç¦»æ¡Œæ³•â€å½’çº¦å…³ç³»ã€‚

3. **å°æµ‹/æ¿æ¼”ï¼ˆ5â€“10 åˆ†é’Ÿï¼‰**

   * é¢˜ 1ï¼šç»™å‡ºä¸€å¼  RAGï¼Œåˆ¤æ–­æ˜¯å¦æ­»é”ï¼Œå¹¶è¯´æ˜Žå“ªæ¡ Coffman æ¡ä»¶å¤±æ•ˆå¯è§£ã€‚
   * é¢˜ 2ï¼šæŠŠ 5 æŠŠå‰ç¼–å·ï¼Œå†™å‡º Pâ‚„ çš„åŠ é”é¡ºåºï¼›è¯´æ˜Žä¸ºä½•å…¨ä½“ä¸å¯èƒ½åŒæ—¶é˜»å¡žã€‚
   * é¢˜ 3ï¼ˆæ€è¾¨ï¼‰ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œå¦‚ä½•ç»´æŠ¤â€œå…¨å±€èµ„æºé¡ºåºâ€ï¼Ÿï¼ˆæç¤ºï¼šå±‚çº§å‘½å/å‘½åç©ºé—´/ç§Ÿçº¦+ç‰ˆæœ¬ï¼‰

---

## ä½œä¸šä¸Žå®žè·µå»ºè®®

* **ç¼–ç¨‹**ï¼šå®žçŽ°ä¸‰ç‰ˆå“²å­¦å®¶ï¼ˆlock-lockã€trylock+é€€é¿ã€å…¨åºæ³•æˆ–æœåŠ¡å‘˜ï¼‰ï¼Œæµ‹**åžåã€å¹³å‡ç­‰å¾…ã€æœ€é•¿ç­‰å¾…**ï¼›ç”¨å›¾è¡¨å¯¹æ¯”ã€‚
* **è¯æ˜Žé¢˜**ï¼šç”¨**åè¯**æˆ–**æ‹“æ‰‘åº**å†™å‡ºâ€œå…¨åº â‡’ æ— çŽ¯â€çš„çŸ­è¯ï¼ˆâ‰¤200 å­—ï¼‰ã€‚
* **å·¥ç¨‹åŒ–æŠ¥å‘Š**ï¼šä»»é€‰æ•°æ®åº“/å¾®æœåŠ¡/OS é”ç®¡ç†ï¼Œåˆ†æžå®ƒå¦‚ä½•é¿å…æ­»é”ã€å¤„ç†æ´»é”ä¸Žé¥¥é¥¿ã€‚

---

## æ˜“é”™ç‚¹æé†’

* **æ— æ­»é” â‰  æ— é¥¥é¥¿**ï¼šä»»ä½•æ–¹æ¡ˆéƒ½è¦è€ƒè™‘å…¬å¹³ï¼ˆFIFOã€è€åŒ–ã€éšæœºé€€é¿ï¼‰ã€‚
* **ä¸€è‡´è§†å›¾**ï¼šå…¨åºæ³•çš„ç¼–å·å¿…é¡»**å…¨å±€ä¸€è‡´**ï¼›ä¸åŒè§†å›¾ä¼šé‡æ–°å¼•å…¥çŽ¯ã€‚
* **å½’çº¦é€»è¾‘**ï¼šæ³¨æ„â€œç¦»æ¡Œæ³•å½’çº¦â€ä¸Žâ€œå…¨åºæ³•ç ´çŽ¯â€çš„åŒºåˆ«ï¼šä¸€ä¸ªæ˜¯**å‡å°‘ç«žäº‰è€…**ï¼Œä¸€ä¸ªæ˜¯**é™åˆ¶è¯·æ±‚æ–¹å‘**ã€‚

éœ€è¦çš„è¯ï¼Œæˆ‘å¯ä»¥æŠŠ**å¯¹ç…§è¡¨ã€è¯æ˜Žå›¾è§£ã€éšå ‚å°æµ‹**åšæˆä¸€é¡µè®²ä¹‰æˆ–å¹»ç¯ç‰‡ï¼Œæ–¹ä¾¿ä½ ç›´æŽ¥æ‹¿åŽ»ä¸Šè¯¾ã€‚


---

## ç¬¬ 206 é¡µ

![ç¬¬ 206 é¡µ](main_chapter8_assets/page-206.png)

**æé—®ï¼š** å¯¹æˆªå›¾ä¸­çš„å†…å®¹é€å¥è¯¦ç»†ä½¿ç”¨ä¸­æ–‡è§£é‡Šï¼Œä¸ä»…ä»…åªæ˜¯ç¿»è¯‘ï¼Œè¿˜éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œé€‚å½“çš„è§£é‡Š,å‘Šè¯‰æˆ‘è¯¥æ€Žä¹ˆæ•™å­¦ç”Ÿå¹¶ä¸”æŒ‡å¯¼æ€Žä¹ˆåš

ä¸‹é¢æŠŠè¿™é¡µâ€œ8.7 Questionsâ€çš„æ¯ä¸€é¡¹éƒ½**ç¿»è¯‘ + è§£é‡Š + ç»™å‡ºç¤ºèŒƒç­”æ¡ˆ**ï¼Œå¹¶é…ä¸Š**è¯¾å ‚æ€Žä¹ˆæ•™/æ€Žä¹ˆåš**çš„æŒ‡å¼•ã€‚ä½ å¯ä»¥ç›´æŽ¥æ‹¿åŽ»å¸¦ç»ƒä¹ ã€‚

---

# é€é¢˜è®²è§£ä¸Žå‚è€ƒç­”æ¡ˆ

## 1) What are the Coffman conditions?

**é—®**ï¼šä»€ä¹ˆæ˜¯ Coffmanï¼ˆæ­»é”ï¼‰å››æ¡ä»¶ï¼Ÿ

**ç­”è¦ç‚¹ï¼ˆå®šä¹‰åè¯ï¼‰**

1. **äº’æ–¥ï¼ˆMutual Exclusionï¼‰**ï¼šæŸäº›èµ„æºä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹å æœ‰ã€‚
2. **å æœ‰å¹¶ç­‰å¾…ï¼ˆHold & Waitï¼‰**ï¼šè¿›ç¨‹å·²å æœ‰è‡³å°‘ä¸€ä¸ªèµ„æºï¼ŒåŒæ—¶åˆåœ¨è¯·æ±‚æ–°çš„èµ„æºã€‚
3. **ä¸å¯æŠ¢å ï¼ˆNo Preemptionï¼‰**ï¼šå·²åˆ†é…çš„èµ„æºä¸èƒ½è¢«å¼ºåˆ¶å¤ºèµ°ï¼Œåªèƒ½ç”±æŒæœ‰è€…ä¸»åŠ¨é‡Šæ”¾ã€‚
4. **å¾ªçŽ¯ç­‰å¾…ï¼ˆCircular Waitï¼‰**ï¼šå­˜åœ¨ä¸€ä¸ªè¿›ç¨‹â€”èµ„æºçš„æœ‰å‘çŽ¯ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½åœ¨ç­‰å¾…ä¸‹ä¸€ä¸ªè¿›ç¨‹æŒæœ‰çš„èµ„æºã€‚

**è¯¾å ‚æ€Žä¹ˆæ•™**ï¼šæŠŠå››æ¡å†™åœ¨é»‘æ¿ä¸Šå¹¶ç”»ä¸€ä¸ªå° RAG åœˆï¼Œè¾¹è®²è¾¹è®©å­¦ç”ŸæŒ‡å‡ºâ€œè¿™æ¡æ¡ä»¶åœ¨å›¾é‡Œä½“çŽ°åœ¨å“ªâ€ã€‚

---

## 2) What does each of the Coffman conditions mean? Define each one.

**é—®**ï¼šé€æ¡è§£é‡Šå››æ¡ä»¶å«ä¹‰ã€‚

**ç­”**ï¼šä¸Šé¢å·²ç»æŒ‰â€œåè¯ + å«ä¹‰â€ç»™å‡ºï¼›è¡¥å……**å·¥ç¨‹ä¾‹å­**å¸®åŠ©è®°å¿†ï¼š

* äº’æ–¥ï¼šæ‰“å°æœºã€æ‘„åƒå¤´ã€ç‹¬å æ–‡ä»¶å¥æŸ„ã€‚
* å æœ‰å¹¶ç­‰å¾…ï¼šçº¿ç¨‹æ‹¿åˆ°é”Aï¼Œå†åŽ»è¦é”Bã€‚
* ä¸å¯æŠ¢å ï¼šæ•°æ®åº“é”ä¸èƒ½è¢« OS å¼ºåˆ¶å‰¥å¤ºã€‚
* å¾ªçŽ¯ç­‰å¾…ï¼šT1 æ‹¿ A ç­‰ Bï¼›T2 æ‹¿ B ç­‰ Aã€‚

**æ•™å­¦æç¤º**ï¼šå¼ºè°ƒç»“è®ºï¼š**å››æ¡åŒæ—¶æˆç«‹ â‡’ å­˜åœ¨æ­»é”å¯èƒ½ï¼›æ‰“ç ´ä»»ä¸€æ¡ â‡’ ä¸ä¼šæ­»é”**ã€‚

---

## 3) Give a real-life example of breaking each Coffman conditionâ€¦

**é—®**ï¼šç»™å‡º**çŽ°å®žåœºæ™¯**ï¼ˆå¦‚æ²¹æ¼†å·¥ã€æ²¹æ¼†ã€åˆ·å­ï¼‰åˆ†åˆ«â€œç ´åâ€å››æ¡ä»¶çš„æ–¹æ³•ï¼Œä¿è¯å·¥ä½œå®Œæˆã€‚

**å‚è€ƒç¤ºä¾‹ï¼ˆæ²¹æ¼†å·¥åœºæ™¯ï¼‰**

* **ç ´äº’æ–¥**ï¼šä¹°å¾ˆå¤šåˆ·å­/æŠŠåˆ·å­å˜â€œåªè¯»å…±äº«â€ï¼ˆä¾‹å¦‚æ»šç­’å¯å¤šäººåŒæ—¶è˜¸åŒä¸€æ¡¶æ¼†ï¼‰ã€‚
* **ç ´å æœ‰å¹¶ç­‰å¾…**ï¼šè§„å®šâ€œæ‹¿ä¸åˆ°ä¸‹ä¸€æ ·å·¥å…·å°±å¿…é¡»æŠŠæ‰‹é‡Œçš„å…ˆæ”¾å›žâ€ï¼ˆæ‹¿ä¸åˆ°æ¢¯å­å°±æŠŠåˆ·å­å…ˆæ”¾å›žå†é‡è¯•ï¼‰ã€‚
* **ç ´ä¸å¯æŠ¢å **ï¼šå·¥é•¿è®¾å®š**è¶…æ—¶/å€Ÿç”¨æƒ**ï¼›è¶…è¿‡ 5 åˆ†é’Ÿæœªç”¨å°±æ”¶å›žåˆ·å­ç»™åˆ«äººã€‚
* **ç ´å¾ªçŽ¯ç­‰å¾…**ï¼šç»™å·¥å…·**ç¼–å·å¹¶è§„å®šé¡ºåº**ï¼ˆå…ˆæ‹¿â€œæ¡¶å·å°â€çš„æ¼†ï¼Œå†æ‹¿â€œåˆ·å·å°â€çš„åˆ·å­ï¼Œæ°¸è¿œæŒ‰ç¼–å·é€’å¢žç”³è¯·ï¼‰ï¼Œæˆ–è®©**æœåŠ¡å‘˜/åº“ç®¡**ç»Ÿä¸€å‘æ”¾ã€‚

**è¯¾å ‚æ´»åŠ¨**ï¼šåˆ† 4 ç»„ï¼Œæ¯ç»„è®¾è®¡ä¸€ç§â€œç ´ä¸€æ¡â€çš„åˆ¶åº¦å¹¶è¯´å‡º**ä¼˜ç¼ºç‚¹**ï¼ˆå…¬å¹³æ€§/æ•ˆçŽ‡/æˆæœ¬ï¼‰ã€‚

---

## 4) Which Coffman condition is unsatisfied in the following snippet?

ä»£ç ç‰‡æ®µï¼š

```c
// Get both locks or none
pthread_mutex_lock(a);
if (pthread_mutex_trylock(b)) { /* failure */
    pthread_mutex_unlock(a);
}
```

**ç­”**ï¼š**å æœ‰å¹¶ç­‰å¾…ï¼ˆHold & Waitï¼‰**è¢«**ç ´å**ã€‚

* è§£é‡Šï¼šæ‹¿åˆ° `a` åŽï¼Œå¦‚æžœ `b` èŽ·å–å¤±è´¥å°±**ç«‹åˆ»æ”¾æŽ‰ `a`**ï¼Œä¸ä¸€è¾¹å æœ‰ä¸€è¾¹ç­‰ï¼Œå› æ­¤ä¸æ»¡è¶³ï¼ˆå³ç ´åäº†ï¼‰â€œå æœ‰å¹¶ç­‰å¾…â€ã€‚

**æ•™å­¦ç‚¹**ï¼šé¡ºä¾¿æé†’ POSIX `trylock` è¿”å›ž 0 è¡¨ç¤ºæˆåŠŸï¼Œéž 0 è¡¨ç¤ºå¤±è´¥ï¼›è¿™é‡Œæ³¨é‡Šå·²è¯´æ˜Žæ˜¯â€œå¤±è´¥åˆ†æ”¯â€ã€‚

---

## 5) The following calls are made â€¦ what happens and why?

ç‰‡æ®µï¼š

```c
// Thread 1
pthread_mutex_lock(m1) // success
pthread_mutex_lock(m2) // blocks

// Thread 2
pthread_mutex_lock(m2) // success
pthread_mutex_lock(m1) // blocks
```

**ç­”**ï¼šå‡ºçŽ°**æ­»é”**ã€‚

* T1 å æœ‰ `m1` ç­‰ `m2`ï¼›T2 å æœ‰ `m2` ç­‰ `m1`ï¼Œæž„æˆ**å¾ªçŽ¯ç­‰å¾…**ï¼Œä¸”äº’æ–¥/å æœ‰å¹¶ç­‰å¾…/ä¸å¯æŠ¢å éƒ½æˆç«‹ã€‚
* **è‹¥ç¬¬ä¸‰ä¸ªçº¿ç¨‹å†è°ƒç”¨ `pthread_mutex_lock(m1)`**ï¼šå®ƒä¹Ÿä¼š**é˜»å¡ž**ï¼ˆç­‰å¾…è¢« T1 é‡Šæ”¾ï¼‰ï¼Œä½†ç”±äºŽå‰ä¸¤è€…å·²æ­»é”ï¼Œå®ƒä¼š**ä¸€ç›´å¡ç€**ã€‚

**æ•™å­¦å»¶ä¼¸**ï¼šç»™å‡ºä¸¤ç§ä¿®å¤ï¼š

* **å…¨åºåŠ é”**ï¼šæ‰€æœ‰çº¿ç¨‹æŒ‰ç›¸åŒé¡ºåºèŽ·å–ï¼ˆå…ˆ `min(m1,m2)` å† `max`ï¼‰ã€‚
* **trylock+é€€é¿**ï¼šæ‹¿ä¸åˆ°ç¬¬äºŒæŠŠå°±é‡Šæ”¾ç¬¬ä¸€æŠŠå¹¶éšæœºç­‰å¾…åŽé‡è¯•ï¼ˆæ³¨æ„æ´»é”ä¸Žå…¬å¹³ï¼‰ã€‚

---

## 6) How many processes are blocked? â€¦ Draw out the resource graph!

ç»™å®šçŠ¶æ€ï¼ˆå•å®žä¾‹èµ„æºï¼‰ï¼š

* P1 acquires R1
* P2 acquires R2
* P1 acquires R3
* P2 waits for R3
* P3 acquires R5
* P1 waits for R4
* P3 waits for R1
* P4 waits for R5
* P5 waits for R1

**å…ˆç”» RAGï¼ˆå£è¿°å³å¯ï¼‰**

* **åˆ†é…è¾¹ï¼ˆèµ„æºâ†’è¿›ç¨‹ï¼‰**ï¼šR1â†’P1ï¼ŒR3â†’P1ï¼ŒR2â†’P2ï¼ŒR5â†’P3
* **è¯·æ±‚è¾¹ï¼ˆè¿›ç¨‹â†’èµ„æºï¼‰**ï¼šP2â†’R3ï¼ŒP1â†’R4ï¼ŒP3â†’R1ï¼ŒP4â†’R5ï¼ŒP5â†’R1

**åˆ¤æ–­é˜»å¡žï¼ˆçœ‹è¯·æ±‚çš„èµ„æºå½“å‰æ˜¯å¦è¢«å ï¼‰**

* P2 ç­‰ **R3**ï¼ˆè¢« P1 å ï¼‰â†’ **é˜»å¡ž**
* P3 ç­‰ **R1**ï¼ˆè¢« P1 å ï¼‰â†’ **é˜»å¡ž**
* P4 ç­‰ **R5**ï¼ˆè¢« P3 å ï¼‰â†’ **é˜»å¡ž**
* P5 ç­‰ **R1**ï¼ˆè¢« P1 å ï¼‰â†’ **é˜»å¡ž**
* P1 ç­‰ **R4** â€”â€” **å½“å‰æ²¡äººå **ï¼ˆåˆ—è¡¨ä¸­æ²¡æœ‰â€œæŸäººå  R4â€ï¼‰ï¼ŒæŒ‰å¸¸è§„è°ƒåº¦å¯**ç«‹å³èŽ·é…** â†’ **ä¸ç®—é˜»å¡ž**

**ç­”æ¡ˆ**ï¼šè¢«é˜»å¡žçš„è¿›ç¨‹æ•° **4 ä¸ª**ï¼šP2ã€P3ã€P4ã€P5ã€‚
**è¿›ä¸€æ­¥åˆ†æž**ï¼šå½“å‰**å°šæœªå¿…ç„¶æ­»é”**ï¼Œå› ä¸ºåªè¦æŠŠ **R4 åˆ†ç»™ P1**ï¼ŒP1 å¯ç»§ç»­è¿è¡Œå¹¶é‡Šæ”¾ R1/R3ï¼ŒéšåŽ P3/P2/P4/P5 éƒ½æœ‰æœºä¼šå‰è¿›ã€‚

**è¯¾å ‚æ“ä½œ**ï¼š

* è®©å­¦ç”Ÿåœ¨çº¸ä¸Šç”»å‡º RAGï¼ˆèŠ‚ç‚¹ï¼šP1..P5, R1..R5ï¼›ç®­å¤´æŒ‰ä¸Šé¢ï¼‰ã€‚
* è®©ä»–ä»¬ç”¨â€œ**å¯ç”¨èµ„æºä¼˜å…ˆåˆ†é…**â€æ³•æ‰‹åŠ¨æŽ¨è¿› 2â€“3 æ­¥ï¼Œä½“éªŒä¸ºä½•â€œä¸æ˜¯æ‰€æœ‰çŽ¯å½¢ç»“æž„éƒ½å¿…å®šæ­»é”â€ã€‚

---

# è¯¾å ‚å¸¦ç»ƒå»ºè®®ï¼ˆå¯ç›´æŽ¥ç”¨ï¼‰

1. **åˆ†ç»„å¿«é—®å¿«ç­”ï¼ˆ5 åˆ†é’Ÿï¼‰**

   * â€œç ´å“ªä¸€æ¡ Coffman æ¡ä»¶æœ€å®¹æ˜“ï¼Ÿâ€
   * â€œä¸ºä»€ä¹ˆâ€˜çœ‹åˆ°çŽ¯â€™ä¸ä¸€å®š=æ­»é”ï¼Ÿâ€ï¼ˆå¯èƒ½æœ‰æŠ¢å /å¯ç”¨èµ„æº/è¶…æ—¶ï¼‰

2. **æ¿æ¼” RAGï¼ˆ8 åˆ†é’Ÿï¼‰**

   * æŠŠç¬¬ 6 é¢˜ç”»åœ¨é»‘æ¿ï¼›è¯·ä¸¤ååŒå­¦ä¾æ¬¡â€œæŽˆäºˆèµ„æº/é‡Šæ”¾èµ„æºâ€ï¼Œå…¨ç­åˆ¤æ–­ä¸‹ä¸€æ­¥æ˜¯å¦å¯æŽ¨è¿›ã€‚

3. **å°ä½œä¸šï¼ˆå¯å¸¦å›žï¼‰**

   * æ”¹å†™ç¬¬ 5 é¢˜ä»£ç ï¼Œé‡‡ç”¨**å…¨åºåŠ é”**ä¸Ž**trylock+éšæœºé€€é¿**ä¸¤ç‰ˆï¼Œæµ‹è¯•æ˜¯å¦è¿˜èƒ½å¤çŽ°æ­»é”/æ´»é”ã€‚
   * ä»»é€‰çŽ°å®žå›¢é˜Ÿåä½œåœºæ™¯ï¼ˆä¼šè®®å®¤/æ‰“å°æœº/å…±äº«è½¦è¾†ï¼‰ï¼Œæå‡º**ç ´å››æ¡ä»¶**çš„åˆ¶åº¦ï¼Œå¹¶è¯„ä¼°å…¬å¹³ä¸Žæ•ˆçŽ‡ã€‚

---

# é€ŸæŸ¥è¡¨ï¼ˆç»™å­¦ç”Ÿï¼‰

* å››æ¡ä»¶ï¼šäº’æ–¥ / å æœ‰å¹¶ç­‰å¾… / ä¸å¯æŠ¢å  / å¾ªçŽ¯ç­‰å¾…
* **ç ´ä¸€æ¡ â‡’ ä¸æ­»é”**ï¼š

  * å…±äº«èµ„æºï¼›
  * ä¸€æ¬¡ç”³è¯·å…¨éƒ¨ or å¤±è´¥å°±é‡Šæ”¾ï¼›
  * å¯æŠ¢å /è¶…æ—¶å›žæ”¶ï¼›
  * èµ„æºå…¨åº/æœåŠ¡å‘˜ä»²è£ã€‚
* RAGï¼šèµ„æºâ†’è¿›ç¨‹=å æœ‰ï¼›è¿›ç¨‹â†’èµ„æº=è¯·æ±‚ï¼›**æ‰¾çŽ¯**æ˜¯å…³é”®ï¼Œä½†è¦çœ‹æ˜¯å¦**æœ‰è¿›ç¨‹è¿˜èƒ½å‰è¿›**ã€‚

å¦‚æžœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥æŠŠè¿™ä»½é¢˜ç›®çš„\*\*å¯æ‰“å°è®²ä¹‰ï¼ˆå«ç©ºç™½ RAG æ¨¡æ¿å’Œæ ‡å‡†ç­”æ¡ˆï¼‰\*\*æ•´ç†å‡ºæ¥ï¼Œæ–¹ä¾¿è¯¾å ‚å‘æ”¾ã€‚


---

## ç¬¬ 207 é¡µ

![ç¬¬ 207 é¡µ](main_chapter8_assets/page-207.png)

**æé—®ï¼š** å¯¹æˆªå›¾ä¸­çš„å†…å®¹é€å¥è¯¦ç»†ä½¿ç”¨ä¸­æ–‡è§£é‡Šï¼Œä¸ä»…ä»…åªæ˜¯ç¿»è¯‘ï¼Œè¿˜éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œé€‚å½“çš„è§£é‡Š,å‘Šè¯‰æˆ‘è¯¥æ€Žä¹ˆæ•™å­¦ç”Ÿå¹¶ä¸”æŒ‡å¯¼æ€Žä¹ˆåš

ä¸‹é¢è¿™é¡µæ˜¯æœ¬ç« çš„**å‚è€ƒæ–‡çŒ®ï¼ˆBibliographyï¼‰**ã€‚æˆ‘ä¼šé€æ¡**ç¿»è¯‘+è§£é‡Š**æ¯ä¸ªæ¡ç›®çš„èƒŒæ™¯ä»·å€¼ï¼Œå¹¶ç»™å‡º**æ•™å­¦å»ºè®®ï¼šå¦‚ä½•å¸¦å­¦ç”Ÿé˜…è¯»/ä½¿ç”¨è¿™äº›æ–‡çŒ®ã€å®‰æŽ’ä½œä¸šä¸Žè®¨è®º**ã€‚

---

# å‚è€ƒæ–‡çŒ®é€æ¡è®²è§£

1. **Edward G. Coffman, Melanie Elphick, Arie Shoshani. â€œSystem deadlocks.â€ *ACM Computing Surveys (CSUR)*, 3(2):67â€“78, 1971.**

   * **è¯‘**ï¼šCoffman ç­‰äººåœ¨ 1971 å¹´å‘è¡¨çš„ç»¼è¿°è®ºæ–‡ã€Šç³»ç»Ÿæ­»é”ã€‹ã€‚
   * **ä¸ºä»€ä¹ˆé‡è¦**ï¼šé¦–æ¬¡ç³»ç»Ÿæå‡ºå¹¶æµè¡ŒåŒ–äº†**æ­»é”å››æ¡ä»¶**ï¼ˆäº’æ–¥ã€å æœ‰å¹¶ç­‰å¾…ã€ä¸å¯æŠ¢å ã€å¾ªçŽ¯ç­‰å¾…ï¼‰çš„æ¡†æž¶ï¼Œæ˜¯ä»Šå¤©æ•™æä¸Žå·¥ç¨‹å®žè·µçš„åŸºçŸ³ã€‚
   * **æ€Žä¹ˆæ•™**ï¼š

     * è®©å­¦ç”Ÿå¯¹ç…§è¯¾å ‚ç¬”è®°ï¼Œ**åœ¨æ–‡ä¸­åœˆå‡º**å››æ¡ä»¶çš„åŽŸå§‹è¡¨è¿°ä¸Žå®šä¹‰å·®å¼‚ã€‚
     * å°ä»»åŠ¡ï¼šæ‰¾ä¸€å¤„å½“å¹´çš„**ç³»ç»Ÿ/ä½œä¸šç³»ç»Ÿä¾‹å­**ï¼Œä¸Žä»Šå¤©çš„äº‘/æ•°æ®åº“åšæ¯”è¾ƒï¼ˆæŠ€æœ¯å¦‚ä½•æ¼”è¿›ã€å“ªäº›æ²¡å˜ï¼‰ã€‚

2. **Edsger W. Dijkstra. â€œHierarchical ordering of sequential processes.â€ï¼ˆEWD310 æ‰‹ç¨¿/PDFï¼‰**

   * **è¯‘**ï¼šDijkstra çš„æ‰‹ç¨¿ã€Šé¡ºåºè¿›ç¨‹çš„å±‚æ¬¡åŒ–æ¬¡åºã€‹ã€‚
   * **ä¸ºä»€ä¹ˆé‡è¦**ï¼šDijkstra æå€¡**ä¸ºèµ„æºå»ºç«‹å…¨åº/ååº**æ¥é¿å…çŽ¯è·¯ï¼ˆå³æˆ‘ä»¬è¯¾å ‚ä¸Šçš„â€œèµ„æºæœ‰åºæ³•â€ï¼‰ï¼›ä»–ä¹Ÿæ˜¯æŠŠâ€œå“²å­¦å®¶è¿›é¤â€å˜æˆç»å…¸è€ƒé¢˜çš„äººã€‚
   * **æ€Žä¹ˆæ•™**ï¼š

     * è¯¾å ‚è¯»å›¾ï¼šæŠŠâ€œå…ˆæ‹¿è¾ƒå°ç¼–å·å†æ‹¿å¤§ç¼–å·â€çš„è®ºè¯ç”»æˆ**æ‹“æ‰‘åº**ã€‚
     * ä½œä¸šï¼šç”¨**åè¯**å†™ 150â€“200 å­—å°è¯æ˜Žâ€œå…¨åº â‡’ æ— çŽ¯ â‡’ ä¸æ­»é”â€ã€‚

3. **H. G. Rice. â€œClasses of recursively enumerable sets and their decision problems.â€ *Transactions of the AMS*, 74(2):358â€“366, 1953.**

   * **è¯‘**ï¼šRice å®šç†çš„åŽŸå§‹è®ºæ–‡ã€‚
   * **ä¸ºä»€ä¹ˆé‡è¦**ï¼šæˆ‘ä»¬åœ¨â€œä¸ºä»€ä¹ˆå¾ˆéš¾é™æ€è¯æ˜Žç¨‹åºä¸ä¼šæ­»é”â€æ—¶å€Ÿç”¨äº†**Rice å®šç†å¼çš„ä¸å¯åˆ¤å®šç›´è§‰**ï¼šä¸€èˆ¬è€Œè¨€ï¼Œä¸è¿è¡Œç¨‹åºå°±æ–­è¨€å…¶è¯­ä¹‰æ€§è´¨ï¼ˆå¦‚å°†æ¥ä¼šä¸ä¼šç”³è¯·æŸèµ„æºï¼‰æ˜¯ä¸å¯è¡Œçš„ã€‚
   * **æ€Žä¹ˆæ•™**ï¼š

     * ç»™å‡º**ç›´è§‰ç‰ˆ**é™ˆè¿°ï¼šå¯¹ä»»æ„éžå¹³å‡¡è¯­ä¹‰æ€§è´¨ï¼Œæ— æ³•å†™å‡ºé€šç”¨åˆ¤å®šå™¨ã€‚
     * è®¨è®ºé¢˜ï¼šå“ªäº›çŽ°å®žç³»ç»Ÿâ€œç»•å¼€â€äº†ä¸å¯åˆ¤å®šï¼Ÿï¼ˆå¦‚é“¶è¡Œå®¶ç®—æ³•éœ€è¦**å£°æ˜Žæœ€å¤§éœ€æ±‚**ï¼Œå±žäºŽ**é™åˆ¶é—®é¢˜åŸŸ**ï¼‰ã€‚

4. **A. Silberschatz, P. B. Galvin, G. Gagne. *Operating System Principles*, 7th Ed., 2006ï¼ˆå­¦ç”Ÿç‰ˆï¼‰**

   * **è¯‘**ï¼šã€Šæ“ä½œç³»ç»Ÿæ¦‚å¿µï¼ˆä¿—ç§°é»‘çš®ä¹¦/æé¾™ä¹¦ï¼‰ã€‹ã€‚
   * **ä¸ºä»€ä¹ˆé‡è¦**ï¼šä¸»æµæ“ä½œç³»ç»Ÿæ•™æï¼Œå¯¹**æ­»é”é¢„é˜²/é¿å…/æ£€æµ‹/æ¢å¤**ã€**RAG**ã€**é“¶è¡Œå®¶ç®—æ³•**æœ‰è§„èŒƒå™è¿°ä¸Žä¹ é¢˜ã€‚
   * **æ€Žä¹ˆæ•™**ï¼š

     * æŒ‡å®š**ç« èŠ‚ç²¾è¯»**ï¼ˆæ­»é”ä¸€ç« ï¼‰+ é€‰æ‹©ä¸¤é“è¯¾åŽé¢˜è®²è§£ã€‚
     * å®‰æŽ’â€œ**å¯¹ç…§é˜…è¯»**â€ï¼šæŠŠè¯¾å ‚ç¤ºä¾‹ä¸Žä¹¦ä¸­**é“¶è¡Œå®¶ç®—æ³•**ä¼ªä»£ç å¯¹é½ï¼Œè‡ªå·±å®žçŽ°ä¸€æ¬¡ã€‚

5. **William Stallings. *Operating Systems: Internals and Design Principles*, 7th Ed., 2011ï¼ˆInternational Economy ç‰ˆï¼‰**

   * **è¯‘**ï¼šStallings çš„æ“ä½œç³»ç»Ÿæ•™æï¼ˆæˆ‘ä»¬å‰é¢è®²åˆ°çš„\*\*Stallings â€œç¦»æ¡Œæ³•ï¼ˆnâˆ’1 é™æµï¼‰â€\*\*å°±å‡ºè‡ªè¯¥ä¹¦çš„ä¸€è·¯è®²è§£ï¼‰ã€‚
   * **ä¸ºä»€ä¹ˆé‡è¦**ï¼šæ¡ˆä¾‹åŒ–å¼ºã€å·¥ç¨‹å‘³è¶³ï¼Œå¯¹**å“²å­¦å®¶è¿›é¤**ç»™å‡ºå¤šç§å¯è¡Œè§£çš„åˆ©å¼Šå¯¹æ¯”ï¼ˆä»²è£è€…ã€é™æµã€ç¼–å·æ³•ç­‰ï¼‰ã€‚
   * **æ€Žä¹ˆæ•™**ï¼š

     * è®©å­¦ç”Ÿ**æ•´ç†å¯¹ç…§è¡¨**ï¼šæ–¹æ¡ˆ â†’ æ‰“ç ´å“ªæ¡ Coffman æ¡ä»¶ â†’ æ˜¯å¦å¯èƒ½æ´»é”/é¥¥é¥¿ â†’ åžå/å…¬å¹³/å¤æ‚åº¦ã€‚
     * å°ç»„æŠ¥å‘Šï¼šä»»é€‰ä¸¤ç§æ–¹æ¡ˆåš**å®žéªŒå¯¹æ¯”**ï¼ˆåžåã€å¹³å‡ç­‰å¾…ã€æœ€é•¿ç­‰å¾…ï¼‰ï¼Œç»™å‡ºå›¾è¡¨ä¸Žç»“è®ºã€‚

---

# è¯¾å ‚ä½¿ç”¨ä¸Žä½œä¸šè®¾è®¡ï¼ˆå¯ç›´æŽ¥å¥—ç”¨ï¼‰

## 1) åˆ†å±‚é˜…è¯»è·¯çº¿ï¼ˆä¸¤å‘¨ï¼‰

* **ç¬¬ 1 æ¬¡è¯¾åŽï¼ˆ1.5â€“2 å°æ—¶ï¼‰**ï¼šè¯» Coffmanâ€™71 ä¸Žæé¾™ä¹¦å¯¹åº”ç« èŠ‚ï¼Œå†™**è¦ç‚¹æ‘˜è¦**ï¼ˆâ‰¤1 é¡µï¼‰ã€‚
* **ç¬¬ 2 æ¬¡è¯¾åŽï¼ˆ1.5 å°æ—¶ï¼‰**ï¼šè¯» Dijkstra æ‰‹ç¨¿ï¼ˆåªè¯»ä¸Žå…¨åºç›¸å…³æ®µè½ï¼‰ï¼Œå®Œæˆ**150â€“200 å­—è¯æ˜Žé¢˜**ã€‚
* **é€‰è¯»**ï¼šStallings ç›¸å…³å°èŠ‚ + ä»»é€‰ä¸€ä¸ªå®žçŽ°æ¡ˆä¾‹ï¼ˆä»²è£è€…/é™æµ/å…¨åºï¼‰åš**ä»£ç å¤çŽ°**ã€‚

## 2) æ³¨é‡Šå¼è¯»ä¹¦ï¼ˆAnnotationï¼‰è¦æ±‚

* åœ¨ PDF/æ‰“å°ç¨¿ä¸Š**æ ‡ 3 å¤„**â€œå®šä¹‰/å®šç†/ä¼ªä»£ç â€ï¼Œå„å†™ 2â€“3 å¥è‡ªå·±çš„è¯è§£é‡Šï¼›
* å„æ–‡çŒ®**æå‡º 1 ä¸ªé—®é¢˜**ï¼ˆä¸æ‡‚/æƒ³éªŒè¯/å®žè·µåŒ–ï¼‰ï¼Œè¯¾å ‚æé—®æˆ–åœ¨è®ºå›è®¨è®ºã€‚

## 3) ä»£ç /å®žéªŒï¼ˆ1â€“2 å‘¨ï¼‰

* **å®žçŽ°ä¸‰ç‰ˆå“²å­¦å®¶**ï¼š`lock-lock`ã€`trylock+éšæœºé€€é¿`ã€`èµ„æºå…¨åº`æˆ–`ä»²è£è€…ï¼ˆFIFOï¼‰`ï¼›
* **æŒ‡æ ‡**ï¼šåžåé‡ï¼ˆæ¯ç§’ `eat()` æ¬¡æ•°ï¼‰ã€å¹³å‡ç­‰å¾…ã€æœ€é•¿ç­‰å¾…ã€æ˜¯å¦å‡ºçŽ°æ­»é”/æ´»é”ï¼›
* **æŠ¥å‘Š**ï¼š1â€“2 é¡µï¼ŒåŒ…å«å›¾è¡¨ä¸Žâ€œå“ªç§åœºæ™¯æ›´é€‚åˆå“ªç§æ–¹æ¡ˆâ€çš„åˆ†æžã€‚

---

# æ•™å­¦æç¤ºä¸Žæ³¨æ„äº‹é¡¹

* **è¿žçº¿å‰åŽæ–‡**ï¼šè®©å­¦ç”Ÿçœ‹åˆ°è¿™ä»½å‚è€ƒæ–‡çŒ®å¦‚ä½•æ”¯æ’‘æ•™æé‡Œçš„æ¯ä¸ªè§‚ç‚¹ï¼ˆå››æ¡ä»¶æ¥è‡ª Coffmanï¼›å…¨åºæ¥è‡ª Dijkstraï¼›â€œé™æ€ä¸å¯æ–­è¨€â€ç±»æ¯” Riceï¼‰ã€‚
* **é¿å…â€œåªçœ‹é“¾æŽ¥â€**ï¼šé¼“åŠ±å­¦ç”Ÿ**æ‘˜æŠ„å…³é”®åŽŸæ–‡**å¹¶å°è¯•å¤è¿°ï¼Œé˜²æ­¢åªçœ‹äºŒæ‰‹è½¬è¿°ã€‚
* **ç‰ˆæœ¬å·®å¼‚**ï¼šæ•™æç‰ˆæœ¬ä¼—å¤šï¼Œé¡µç å¯èƒ½ä¸åŒã€‚æå‰ç»™å‡º**é˜…è¯»èŒƒå›´**ï¼ˆç« èŠ‚/å°èŠ‚æ ‡é¢˜ï¼‰ï¼Œé¿å…å­¦ç”Ÿè¿·è·¯ã€‚
* **å¯èŽ·å–æ€§**ï¼šè€è®ºæ–‡å¸¸å¯åœ¨**ä½œè€…ä¸»é¡µ/å­¦æ ¡åº“/JSTOR**æ‰¾åˆ°ï¼›é˜…è¯»æ—¶æ³¨æ„ç‰ˆæƒä¸Žæ ¡å›­è®¿é—®æ¸ é“ã€‚

---

éœ€è¦çš„è¯ï¼Œæˆ‘å¯ä»¥æŠŠ**é˜…è¯»æ¸…å• + æ‘˜è¦æ¨¡æ¿ + å®žéªŒè¯„åˆ† Rubric**åšæˆä¸€é¡µ PDFï¼Œæ–¹ä¾¿ä½ ç›´æŽ¥å¸ƒç½®ä¸Žæ”¶ä½œä¸šã€‚


---

## ç¬¬ 208 é¡µ

![ç¬¬ 208 é¡µ](main_chapter8_assets/page-208.png)

**æé—®ï¼š** å¯¹æˆªå›¾ä¸­çš„å†…å®¹é€å¥è¯¦ç»†ä½¿ç”¨ä¸­æ–‡è§£é‡Šï¼Œä¸ä»…ä»…åªæ˜¯ç¿»è¯‘ï¼Œè¿˜éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œé€‚å½“çš„è§£é‡Š,å‘Šè¯‰æˆ‘è¯¥æ€Žä¹ˆæ•™å­¦ç”Ÿå¹¶ä¸”æŒ‡å¯¼æ€Žä¹ˆåš

çœ‹èµ·æ¥è¿™é¡µæ˜¯ç©ºç™½é¡µï¼ˆå¤šåŠæ˜¯ç« èŠ‚ç»“å°¾æˆ–ç‰ˆé¢ç•™ç™½ï¼‰ã€‚æ²¡æœ‰å¯é€å¥è§£è¯»çš„æ­£æ–‡å†…å®¹ã€‚
ä¸è¿‡ä½ å¯ä»¥æŠŠè¿™é¡µ**åˆ©ç”¨èµ·æ¥**ï¼Œåšâ€œæ”¶å°¾ä¸Žå·©å›ºâ€ã€‚ä¸‹é¢ç»™ä½ ä¸€ä¸ª**å¯ç›´æŽ¥æ‹¿åŽ»ä¸Šè¯¾çš„ç»“æŸçŽ¯èŠ‚è„šæœ¬**ã€‚

# è¯¾å ‚æ”¶å°¾ï¼ˆ5â€“12 åˆ†é’Ÿï¼‰

1. **1 åˆ†é’Ÿå°çº¸æ¡ï¼ˆMinute Paperï¼‰**

   * è®©å­¦ç”Ÿå†™ä¸¤å¥ï¼š

     * ä»Šå¤©å­¦åˆ°çš„æœ€é‡è¦æ¦‚å¿µï¼ˆä¾‹å¦‚ï¼šRAGã€Coffman å››æ¡ä»¶ã€æ´»é” vs æ­»é”ã€å“²å­¦å®¶è§£æ³•ï¼‰ã€‚
     * ä»ç„¶å›°æƒ‘çš„ä¸€ç‚¹ï¼ˆä¾‹å¦‚ï¼šä¸ºä»€ä¹ˆâ€œçœ‹åˆ°çŽ¯â‰ ä¸€å®šæ­»é”â€ï¼‰ã€‚
   * æ”¶ä¸Šæ¥ï¼Œä¸‹ä¸€æ¬¡è¯¾â€œå¯¹ç—‡ä¸‹è¯â€ã€‚

2. **â€œæœ€æ³¥æ³žç‚¹â€ï¼ˆMuddiest Pointï¼‰**

   * è¯·å¤§å®¶ç”¨ä¸€å¥è¯å†™å‡ºæœ¬ç« æœ€æ¨¡ç³Šçš„æ¦‚å¿µï¼Œä½ çŽ°åœºé€‰ 1â€“2 ä¸ªé©¬ä¸Šæ¾„æ¸…ã€‚

3. **é»‘æ¿é€Ÿè®°å›¾ï¼ˆ3 åˆ†é’Ÿï¼‰**

   * è®©ä¸€ä½åŒå­¦åœ¨ç©ºç™½é¡µ/ç™½æ¿ä¸Šç”»**èµ„æºåˆ†é…å›¾ï¼ˆRAGï¼‰**ï¼Œå…¶ä»–åŒå­¦æ ‡å‡ºï¼š

     * å æœ‰è¾¹ï¼ˆèµ„æºâ†’è¿›ç¨‹ï¼‰ã€è¯·æ±‚è¾¹ï¼ˆè¿›ç¨‹â†’èµ„æºï¼‰
     * æ˜¯å¦å­˜åœ¨**æœ‰å‘çŽ¯**
     * å¦‚ä½•**æ‰“ç ´ä¸€æ¡ Coffman æ¡ä»¶**æ¥é¿å…æ­»é”

4. **3 é¢˜å¿«é—®å¿«ç­”ï¼ˆæ¯é¢˜ 30 ç§’ï¼‰**

   * Coffman å››æ¡ä»¶åˆ†åˆ«æ˜¯ä»€ä¹ˆã€ç ´å“ªä¸€æ¡æœ€å¸¸è§ï¼Ÿ
   * ä¸¾ä¾‹è¯´æ˜Ž**æ´»é”ä¸Žæ­»é”çš„åŒºåˆ«**ã€‚
   * å“²å­¦å®¶é—®é¢˜é‡Œï¼Œâ€œèµ„æºå…¨åºæ³•â€ä¸ºä»€ä¹ˆèƒ½é¿å…æ­»é”ï¼Ÿ

# å¯å‘çš„â€œç¦»åœºå¡â€ï¼ˆExit Ticketï¼‰

* ä½ æ›´å€¾å‘å“ªç§æ–¹æ¡ˆï¼š**ä»²è£è€…ã€nâˆ’1 é™æµã€èµ„æºå…¨åºã€trylock+é€€é¿**ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ
* ä½ èƒ½ç”»å‡ºä¸€ä¸ª**ä¸ä¼šæ­»é”ä½†æœ‰æ´»é”é£Žé™©**çš„å°ä¾‹å­å—ï¼Ÿ
* ä¸‹èŠ‚è¯¾ä½ æƒ³çœ‹å“ªç§**ä»£ç  demo**ï¼ˆC/Pthreadsã€Pythonã€å¤šè¿›ç¨‹/åˆ†å¸ƒå¼æ¶ˆæ¯ï¼‰ï¼Ÿ

# ä½œä¸šå»ºè®®ï¼ˆä»»é€‰å…¶ä¸€ï¼‰

* **å®žçŽ°å¯¹æ¯”**ï¼šå®žçŽ°â€œå…ˆå·¦åŽå³ lock-lockâ€ä¸Žâ€œèµ„æºå…¨åºæ³•â€ï¼Œç»Ÿè®¡ **åžå/å¹³å‡ç­‰å¾…/æœ€é•¿ç­‰å¾…**ï¼Œå†™ 1 é¡µå®žéªŒæŠ¥å‘Šã€‚
* **è¯æ˜Žå°ç»ƒä¹ **ï¼ˆâ‰¤200 å­—ï¼‰ï¼šç”¨åè¯æ³•å†™å‡ºâ€œèµ„æºå…¨åº â‡’ æ— å‘å›žåˆ°èµ·ç‚¹çš„çŽ¯ â‡’ ä¸æ­»é”â€ã€‚
* **æƒ…æ™¯è®¾è®¡**ï¼šæŠŠâ€œæ²¹æ¼†å·¥/åˆ·å­/æ²¹æ¼†æ¡¶â€å»ºæ¨¡æˆ RAGï¼Œåˆ†åˆ«ç»™å‡º**ç ´å››æ¡ä»¶**çš„åˆ¶åº¦ï¼Œå„å†™ä¼˜ç¼ºç‚¹ã€‚

# å¤ä¹ æ¸…å•ï¼ˆç»™å­¦ç”ŸæŠ„ï¼‰

* **RAG è§„åˆ™**ï¼šèµ„æºâ†’è¿›ç¨‹=å æœ‰ï¼›è¿›ç¨‹â†’èµ„æº=è¯·æ±‚ï¼›æ‰¾**æœ‰å‘çŽ¯**ã€‚
* **Coffman æ¡ä»¶**ï¼šäº’æ–¥ / å æœ‰å¹¶ç­‰å¾… / ä¸å¯æŠ¢å  / å¾ªçŽ¯ç­‰å¾…ï¼›**ç ´ä¸€æ¡ â‡’ ä¸æ­»é”**ã€‚
* **æ´»é”**ï¼šå¿™ä½†æ— è¿›å±•ï¼ˆå¸¸ç”¨**éšæœºé€€é¿/å…¬å¹³é˜Ÿåˆ—**ç¼“è§£ï¼‰ã€‚
* **å“²å­¦å®¶æ–¹æ¡ˆ**ï¼š

  * ä»²è£è€…ï¼ˆå®‰å…¨ã€å¯èƒ½ç“¶é¢ˆ/SPOFï¼‰ï¼›
  * nâˆ’1 é™æµï¼ˆä¸æ­»é”ã€å¯èƒ½ä¸å…¬å¹³ï¼‰ï¼›
  * èµ„æºå…¨åºï¼ˆç®€æ´é«˜æ•ˆï¼Œéœ€å…¨å±€ä¸€è‡´ç¼–å·ï¼‰ï¼›
  * trylock+é€€é¿ï¼ˆä¸æ­»é”ï¼Œéœ€é˜²æ´»é”/é¥¥é¥¿ï¼‰ã€‚

éœ€è¦çš„è¯ï¼Œæˆ‘å¯ä»¥æŠŠ**å¤ä¹ æ¸…å• + Exit Ticket æ¨¡æ¿**åšæˆä¸€é¡µå¯æ‰“å° PDFï¼Œæ–¹ä¾¿ä½ ç›´æŽ¥å‘ç»™å­¦ç”Ÿã€‚
