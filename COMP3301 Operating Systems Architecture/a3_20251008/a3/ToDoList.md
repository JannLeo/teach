### 1. **`fvd.c`**：

#### **需要修改的部分**：

- **`fvd_attach`函数**：
   这个函数需要在打开 `.fvd` 和 `.fvd.ref` 文件后，填充 `fvd_softc` 结构体中的 `sc_cylinders`、`sc_heads` 和 `sc_spt` 字段。
   这三个值是从FVD映像的元数据中获取的。

  - 需要修改标记为 `/* <YOUR CODE HERE> */` 的部分，填充这三个字段。
  - 这些值通常会在 `.fvd.ref` 文件里，它包含了磁盘的几何信息，比如柱面数、磁头数和每道扇区数。

- **`fvd_read_sect` 和 `fvd_write_sect` 函数**：
   这两个函数现在是占位符（返回 `ENOSYS`）。你需要实现读取和写入扇区的逻辑：

  - 对于 **读取**，要根据扇区号和记录的映射关系，从 `.fvd` 文件中读取数据。
  - 对于 **写入**，如果多个分支共享同一个扇区数据，你需要使用写时复制（COW）技术来创建一个新的副本。

  **操作步骤**：

  - 实现 **读取** 和 **写入** 扇区的逻辑。
  - 在修改扇区时，确保正确分配新记录或复制记录。

#### **需要修改的文件**：

- **`fvd.c`**：需要在 `fvd_attach` 函数中填充磁盘的几何信息，修改 `fvd_read_sect` 和 `fvd_write_sect` 函数来实现扇区的读写。

------

### 2. **`fvdvar.h`**：

这个文件定义了 FVD 设备和 IOCTL 操作的结构体。作业中大部分不需要修改它，但你要确保理解里面的结构，特别是 **`fvd_root_block`** 和 **`fvd_brch_desc`**，它们分别表示 FVD 的根记录和分支描述符。

------

### 3. **`fvdctl.c`**：

#### **需要修改的部分**：

- **`fvd_attach`**：
  - 这个函数处理设备的路径和分支参数，并通过 IOCTL `FVDIOC_ATTACH` 将 FVD 映像绑定到设备节点。
  - 确保路径、分支名等参数正确传递。
- **`fvd_detach`**：
  - 这个函数处理设备的卸载，正确调用 IOCTL `FVDIOC_DETACH` 来卸载 FVD 映像。
- **确保 `FVDIOC_FORK`、`FVDIOC_INFO` 和 `FVDIOC_CACHE_LIST` IOCTL** 正常工作，并能够与内核进行正确的交互。

